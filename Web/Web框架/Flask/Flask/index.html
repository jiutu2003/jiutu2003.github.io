<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>Flask | jiutu2003</title><meta name="author" content="jiutu2003"><meta name="copyright" content="jiutu2003"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1.简介Flask是目前十分流行的web框架，采用Python编程语言来实现相关功能。它被称为微框架(microframework)，“微”是指Flask旨在保持代码简洁且易于扩展，Flask框架的主要特征是核心构成比较简单，但具有很强的扩展性和兼容性。 Flask主要包括Werkzeug和Jinja2两个核心函数库，它们分别负责业务处理和安全方面的功能，这些基础函数为web项目开发过程提供了丰富">
<meta property="og:type" content="article">
<meta property="og:title" content="Flask">
<meta property="og:url" content="https://jiutu2003.github.io/Web/Web%E6%A1%86%E6%9E%B6/Flask/Flask/index.html">
<meta property="og:site_name" content="jiutu2003">
<meta property="og:description" content="1.简介Flask是目前十分流行的web框架，采用Python编程语言来实现相关功能。它被称为微框架(microframework)，“微”是指Flask旨在保持代码简洁且易于扩展，Flask框架的主要特征是核心构成比较简单，但具有很强的扩展性和兼容性。 Flask主要包括Werkzeug和Jinja2两个核心函数库，它们分别负责业务处理和安全方面的功能，这些基础函数为web项目开发过程提供了丰富">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/735eceff91f2a291064f8242242c831b.jpg">
<meta property="article:published_time" content="2023-02-24T06:07:33.630Z">
<meta property="article:modified_time" content="2023-02-24T06:15:46.284Z">
<meta property="article:author" content="jiutu2003">
<meta property="article:tag" content="Web框架">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/735eceff91f2a291064f8242242c831b.jpg"><link rel="shortcut icon" href="/img/242ae48778369e7a.jpg"><link rel="canonical" href="https://jiutu2003.github.io/Web/Web%E6%A1%86%E6%9E%B6/Flask/Flask/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Flask',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-02-24 14:15:46'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/242ae48778369e7a.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">9</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">8</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">13</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/735eceff91f2a291064f8242242c831b.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="jiutu2003"><span class="site-name">jiutu2003</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Flask</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-02-24T06:07:33.630Z" title="发表于 2023-02-24 14:07:33">2023-02-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-02-24T06:15:46.284Z" title="更新于 2023-02-24 14:15:46">2023-02-24</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Web/">Web</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Web/Web%E6%A1%86%E6%9E%B6/">Web框架</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Web/Web%E6%A1%86%E6%9E%B6/Flask/">Flask</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Flask"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h3 id="1-简介"><a href="#1-简介" class="headerlink" title="1.简介"></a><strong>1.简介</strong></h3><p>Flask是目前十分流行的web框架，采用Python编程语言来实现相关功能。它被称为微框架(microframework)，“微”是指Flask旨在保持代码简洁且易于扩展，Flask框架的主要特征是核心构成比较简单，但具有很强的扩展性和兼容性。</p>
<p>Flask主要包括<code>Werkzeug</code>和<code>Jinja2</code>两个核心函数库，它们分别负责业务处理和安全方面的功能，这些基础函数为web项目开发过程提供了丰富的基础组件。</p>
<h3 id="2-安装"><a href="#2-安装" class="headerlink" title="2.安装"></a><strong>2.安装</strong></h3><p>使用以下指令安装：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install flask</span><br></pre></td></tr></table></figure>

<p>进入python交互模式看下Flask的介绍和版本，输入指令查看版本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> flask</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(flask.__version__)</span><br><span class="line"><span class="number">2.2</span><span class="number">.2</span></span><br></pre></td></tr></table></figure>

<h3 id="3-从-Hello-World-开始"><a href="#3-从-Hello-World-开始" class="headerlink" title="3. 从 Hello World 开始"></a>3. 从 Hello World 开始</h3><p>本节主要内容：使用Flask写一个显示”Hello World!”的web程序，如何配置、调试Flask。</p>
<h4 id="3-1-Hello-World"><a href="#3-1-Hello-World" class="headerlink" title="3.1 Hello World"></a>3.1 Hello World</h4><p>建立Flask项目HelloWorld(用pycharm)，并创建python软件包<code>server.py</code></p>
<p>创建HelloWorld项目的时候，在HelloWorld文件夹下会自动创建<code>tatic</code>和<code>templates</code>目录</p>
<p><code>tatic</code>和<code>templates</code>目录是默认配置，其中<code>static</code>用来存放静态资源，例如图片、js、css文件等。<code>templates</code>存放模板文件。<br>我们的网站逻辑基本在<code>server.py</code>文件中，当然，也可以给这个文件起其他的名字。</p>
<p>在<code>server.py</code>中加入以下内容：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"> </span><br><span class="line">app = Flask(__name__)</span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World!&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>

<p>运行<code>server.py</code>：</p>
<p>pycharm下会提示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> * Serving Flask app &#x27;server&#x27;</span><br><span class="line"> * Debug mode: off</span><br><span class="line">WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.</span><br><span class="line"> * Running on http://127.0.0.1:5000</span><br></pre></td></tr></table></figure>

<p>意思是让我们在浏览器上运行</p>
<p>打开浏览器访问<code>http://127.0.0.1:5000/</code>，浏览页面上将出现<code>Hello World!</code>。</p>
<p>终端里会显示下面的信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 - - [10/Nov/2022 20:17:08] &quot;GET / HTTP/1.1&quot; 200 -</span><br></pre></td></tr></table></figure>

<p>变量app是一个Flask实例，通过下面的方式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World!&#x27;</span></span><br></pre></td></tr></table></figure>

<p>当客户端访问<code>/</code>时，将响应<code>hello_world()</code>函数返回的内容。注意，这不是返回<code>Hello World!</code>这么简单，<code>Hello World!</code>只是HTTP响应报文的实体部分，状态码等信息既可以由Flask自动处理，也可以通过编程来制定。</p>
<h4 id="3-2-修改Flask的配置"><a href="#3-2-修改Flask的配置" class="headerlink" title="3.2 修改Flask的配置"></a>3.2 修改Flask的配置</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app = Flask(__name__)</span><br></pre></td></tr></table></figure>

<p>上面的代码中，python内置变量<code>__name__</code>的值是字符串<code>__main__</code> 。Flask类将这个参数作为程序名称。当然这个是可以自定义的，比如<code>app = Flask(&quot;my-app&quot;)</code>。</p>
<p>Flask默认使用<code>static</code>目录存放静态资源，<code>templates</code>目录存放模板，这是可以通过设置参数更改的：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app = Flask(<span class="string">&quot;my-app&quot;</span>, static_folder=<span class="string">&quot;path1&quot;</span>, template_folder=<span class="string">&quot;path2&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>更多参数请参考<code>__doc__</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="built_in">print</span>(Flask.__doc__)</span><br></pre></td></tr></table></figure>

<h4 id="3-3-调试模式"><a href="#3-3-调试模式" class="headerlink" title="3.3 调试模式"></a>3.3 调试模式</h4><p>上面的server.py中以<code>app.run()</code>方式运行，这种方式下，如果服务器端出现错误是不会在客户端显示的。但是在开发环境中，显示错误信息是很有必要的，要显示错误信息，应该以下面的方式运行Flask：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>将<code>debug</code>设置为<code>True</code>的另一个好处是，程序启动后，会自动检测源码是否发生变化，若有变化则自动重启程序。这可以帮我们省下很多时间。</p>
<h4 id="3-4-绑定IP和端口"><a href="#3-4-绑定IP和端口" class="headerlink" title="3.4 绑定IP和端口"></a>3.4 绑定IP和端口</h4><p>默认情况下，Flask绑定IP为<code>127.0.0.1</code>，端口为<code>5000</code>。我们也可以通过下面的方式自定义：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">80</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p><code>0.0.0.0</code>代表电脑所有的IP。<code>80</code>是HTTP网站服务的默认端口。</p>
<h3 id="4-获取URL参数"><a href="#4-获取URL参数" class="headerlink" title="4.获取URL参数"></a>4.获取URL参数</h3><p>URL参数是出现在url中的键值对，例如<code>http://127.0.0.1:5000/?disp=3</code>中的url参数是<code>&#123;&#39;disp&#39;:3&#125;</code>。</p>
<h4 id="4-1-列出所有的url参数"><a href="#4-1-列出所有的url参数" class="headerlink" title="4.1 列出所有的url参数"></a>4.1 列出所有的url参数</h4><p>在server.py中添加以下内容：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"> </span><br><span class="line">app = Flask(__name__)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> request.args.__str__()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>在浏览器中访问<code>http://127.0.0.1:5000/?user=Flask&amp;time&amp;p=7&amp;p=8</code>，将显示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ImmutableMultiDict([(&#x27;user&#x27;, &#x27;Flask&#x27;), (&#x27;time&#x27;, &#x27;&#x27;), (&#x27;p&#x27;, &#x27;7&#x27;), (&#x27;p&#x27;, &#x27;8&#x27;)])</span><br></pre></td></tr></table></figure>

<p>较新的浏览器也支持直接在url中输入中文（最新的火狐浏览器内部会帮忙将中文转换成符合URL规范的数据），在浏览器中访问<code>http://127.0.0.1:5000/?info=这是爱，</code>，将显示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ImmutableMultiDict([(&#x27;info&#x27;, &#x27;这是爱，&#x27;)])</span><br></pre></td></tr></table></figure>

<p>浏览器传给我们的Flask服务的数据长什么样子呢？可以通过<code>request.full_path</code>和<code>request.path</code>来看一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"> </span><br><span class="line">app = Flask(__name__)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="built_in">print</span>(request.path)</span><br><span class="line">    <span class="built_in">print</span>(request.full_path)</span><br><span class="line">    <span class="keyword">return</span> request.args.__str__()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>浏览器访问<code>http://127.0.0.1:5000/?info=这是爱，</code>，运行<code>server.py</code>的终端会输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/</span><br><span class="line">/?info=%E8%BF%99%E6%98%AF%E7%88%B1%EF%BC%8C</span><br></pre></td></tr></table></figure>

<h4 id="4-3-获取某个指定的参数"><a href="#4-3-获取某个指定的参数" class="headerlink" title="4.3 获取某个指定的参数"></a>4.3 获取某个指定的参数</h4><p>例如，要获取键<code>info</code>对应的值，如下修改<code>server.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"> </span><br><span class="line">app = Flask(__name__)</span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> request.args.get(<span class="string">&#x27;info&#x27;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure>

<p>运行<code>server.py</code>，在浏览器中访问<code>http://127.0.0.1:5000/?info=hello</code>，浏览器将显示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hello</span><br></pre></td></tr></table></figure>

<p>不过，当我们访问<code>http://127.0.0.1:5000/</code>时候却出现了500错误</p>
<p>这是因为没有在URL参数中找到<code>info</code>。所以<code>request.args.get(&#39;info&#39;)</code>返回Python内置的None，而Flask不允许返回None。</p>
<p>解决方法很简单，我们先判断下它是不是None：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"> </span><br><span class="line">app = Flask(__name__)</span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    r = request.args.get(<span class="string">&#x27;info&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> r==<span class="literal">None</span>:</span><br><span class="line">        <span class="comment"># do something</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>另外一个方法是，设置默认值，也就是取不到数据时用这个值：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"> </span><br><span class="line">app = Flask(__name__)</span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    r = request.args.get(<span class="string">&#x27;info&#x27;</span>, <span class="string">&#x27;hi&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>函数<code>request.args.get</code>的第二个参数用来设置默认值。此时在浏览器访问<code>http://127.0.0.1:5000/</code>，将显示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hi</span><br></pre></td></tr></table></figure>

<h4 id="4-4-如何处理多值"><a href="#4-4-如何处理多值" class="headerlink" title="4.4 如何处理多值"></a>4.4 如何处理多值</h4><p>还记得上面有一次请求是这样的吗？ <code>http://127.0.0.1:5000/?user=Flask&amp;time&amp;p=7&amp;p=8</code>，仔细看下，<code>p</code>有两个值。</p>
<p>如果我们的代码是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"> </span><br><span class="line">app = Flask(__name__)</span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    r = request.args.get(<span class="string">&#x27;p&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>在浏览器中请求时，我们只会看到<code>7</code>。如果我们需要把<code>p</code>的所有值都获取到，该怎么办？</p>
<p>不用<code>get</code>，用<code>getlist</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"> </span><br><span class="line">app = Flask(__name__)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    r = request.args.getlist(<span class="string">&#x27;p&#x27;</span>)  <span class="comment"># 返回一个list</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(r)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>浏览器输入 <code>http://127.0.0.1:5000/?user=Flask&amp;time&amp;p=7&amp;p=8</code>，我们会看到<code>[&#39;7&#39;, &#39;8&#39;]</code>。</p>
<h3 id="5-获取POST方法传送的数据"><a href="#5-获取POST方法传送的数据" class="headerlink" title="5. 获取POST方法传送的数据"></a>5. 获取POST方法传送的数据</h3><p>POST作为一种HTTP请求方法，用于向指定的资源提交要被处理的数据。</p>
<p>文章数据太多，浏览器不一定支持太长长度的URL。这时，一般使用POST方法。</p>
<p>本文使用python的requests库模拟浏览器</p>
<p>安装方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install requests</span><br></pre></td></tr></table></figure>

<h4 id="5-1-建立Flask项目"><a href="#5-1-建立Flask项目" class="headerlink" title="5.1 建立Flask项目"></a>5.1 建立Flask项目</h4><p>建立Flask项目HelloWorld</p>
<h4 id="5-2-查看POST数据内容"><a href="#5-2-查看POST数据内容" class="headerlink" title="5.2 查看POST数据内容"></a>5.2 查看POST数据内容</h4><p>以用户注册为例子，我们需要向服务器<code>/register</code>传送用户名<code>name</code>和密码<code>password</code>。如下编写<code>HelloWorld/server.py</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"> </span><br><span class="line">app = Flask(__name__)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="built_in">print</span>(request.headers)</span><br><span class="line">    <span class="built_in">print</span>(request.stream.read())</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;welcome&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>@app.route(‘&#x2F;register’, methods&#x3D;[‘POST’])是指url&#x2F;register只接受POST方法。可以根据需要修改methods参数，例如如果想要让它同时支持GET和POST，这样写：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>) </span></span><br></pre></td></tr></table></figure>

<p>浏览器模拟工具<code>client.py</code>内容如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"> </span><br><span class="line">user_info = &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;jiutu&#x27;</span>, <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;123&#x27;</span>&#125;</span><br><span class="line">r = requests.post(<span class="string">&quot;http://127.0.0.1:5000/register&quot;</span>, data=user_info)</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure>

<p>运行<code>HelloWorld/server.py</code>，然后运行<code>client.py</code>。<code>client.py</code>将输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">welcome</span><br></pre></td></tr></table></figure>

<p>而<code>HelloWorld/server.py</code>在终端中输出以下调试信息（通过<code>print</code>输出）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Host: 127.0.0.1:5000</span><br><span class="line">User-Agent: python-requests/2.28.1</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept: */*</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Content-Length: 23</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">b&#x27;name=jiutu&amp;password=123&#x27;</span><br></pre></td></tr></table></figure>

<p>前6行是client.py生成的HTTP请求头，由<code>print(request.headers)</code>输出。</p>
<p>请求体的数据，我们通过<code>print(request.stream.read())</code>输出，结果是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b&#x27;name=jiutu&amp;password=123&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="5-3-解析POST数据"><a href="#5-3-解析POST数据" class="headerlink" title="5.3 解析POST数据"></a>5.3 解析POST数据</h4><p>上面，我们看到post的数据内容是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b&#x27;name=jiutu&amp;password=123&#x27;</span><br></pre></td></tr></table></figure>

<p>我们要想办法把我们要的name、password提取出来。Flask已经内置了解析器<code>request.form</code>。</p>
<p>我们将服务代码改成：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"> </span><br><span class="line">app = Flask(__name__)</span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="built_in">print</span>(request.headers)</span><br><span class="line">    <span class="comment"># print(request.stream.read()) # 不要用，否则下面的form取不到数据</span></span><br><span class="line">    <span class="built_in">print</span>(request.form)</span><br><span class="line">    <span class="built_in">print</span>(request.form[<span class="string">&#x27;name&#x27;</span>])</span><br><span class="line">    <span class="built_in">print</span>(request.form.get(<span class="string">&#x27;name&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(request.form.getlist(<span class="string">&#x27;name&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(request.form.get(<span class="string">&#x27;nickname&#x27;</span>, default=<span class="string">&#x27;little apple&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;welcome&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>执行<code>client.py</code>请求数据，服务器代码会在终端输出：、</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ImmutableMultiDict([(&#x27;name&#x27;, &#x27;jiutu&#x27;), (&#x27;password&#x27;, &#x27;123&#x27;)])</span><br><span class="line">jiutu</span><br><span class="line">jiutu</span><br><span class="line">[&#x27;jiutu&#x27;]</span><br><span class="line">little apple</span><br></pre></td></tr></table></figure>

<p><code>request.form</code>会自动解析数据。</p>
<p><code>request.form[&#39;name&#39;]</code>和<code>request.form.get(&#39;name&#39;)</code>都可以获取<code>name</code>对应的值。对于<code>request.form.get()</code>可以为参数<code>default</code>指定值以作为默认值。所以：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(request.form.get(<span class="string">&#x27;nickname&#x27;</span>, default=<span class="string">&#x27;little apple&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p>输出的是默认值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">little apple</span><br></pre></td></tr></table></figure>

<p>如果<code>name</code>有多个值，可以使用<code>request.form.getlist(&#39;name&#39;)</code>，该方法将返回一个列表。我们将client.py改一下：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">user_info = &#123;<span class="string">&#x27;name&#x27;</span>: [<span class="string">&#x27;letian&#x27;</span>, <span class="string">&#x27;letian2&#x27;</span>], <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;123&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">r = requests.post(<span class="string">&quot;http://127.0.0.1:5000/register&quot;</span>, data=user_info)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure>

<p>此时运行<code>client.py</code>，<code>print(request.form.getlist(&#39;name&#39;))</code>将输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[u&#x27;letian&#x27;, u&#x27;letian2&#x27;]</span><br></pre></td></tr></table></figure>

<h3 id="6-处理和响应JSON数据"><a href="#6-处理和响应JSON数据" class="headerlink" title="6. 处理和响应JSON数据"></a>6. 处理和响应JSON数据</h3><p>使用 HTTP POST 方法传到网站服务器的数据格式可以有很多种，比如「5. 获取POST方法传送的数据」讲到的<code>name=letian&amp;password=123</code>这种用过<code>&amp;</code>符号分割的key-value键值对格式。我们也可以用JSON格式、XML格式。相比XML的重量、规范繁琐，JSON显得非常小巧和易用。</p>
<h4 id="6-1-建立Flask项目"><a href="#6-1-建立Flask项目" class="headerlink" title="6.1 建立Flask项目"></a>6.1 建立Flask项目</h4><p>建立Flask项目HelloWorld</p>
<h4 id="6-2-处理JSON格式的请求数据"><a href="#6-2-处理JSON格式的请求数据" class="headerlink" title="6.2 处理JSON格式的请求数据"></a>6.2 处理JSON格式的请求数据</h4><p>如果POST的数据是JSON格式，<code>request.json</code>会自动将json数据转换成Python类型（字典或者列表）。</p>
<p>编写<code>server.py</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"> </span><br><span class="line">app = Flask(<span class="string">&quot;my-app&quot;</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World!&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/add&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>():</span><br><span class="line">    <span class="built_in">print</span>(request.headers)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(request.json))</span><br><span class="line">    <span class="built_in">print</span>(request.json)</span><br><span class="line">    result = request.json[<span class="string">&#x27;a&#x27;</span>] + request.json[<span class="string">&#x27;b&#x27;</span>]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(result)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;127.0.0.1&#x27;</span>, port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>编写<code>client.py</code>模拟浏览器请求：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">json_data = &#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">2</span>&#125;</span><br><span class="line">r = requests.post(<span class="string">&quot;http://127.0.0.1:5000/add&quot;</span>, json=json_data)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure>

<p>运行<code>server.py</code>，然后运行<code>client.py</code>，<code>client.py</code> 会在终端输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3</span><br></pre></td></tr></table></figure>

<p><code>server.py</code> 会在终端输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Host: 127.0.0.1:5000</span><br><span class="line">User-Agent: python-requests/2.19.1</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept: */*</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Content-Length: 16</span><br><span class="line">Content-Type: application/json</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">&lt;class &#x27;dict&#x27;&gt;</span><br><span class="line">&#123;&#x27;a&#x27;: 1, &#x27;b&#x27;: 2&#125;</span><br></pre></td></tr></table></figure>

<p>注意，请求头中<code>Content-Type</code>的值是<code>application/json</code>。</p>
<h4 id="6-3-响应JSON-方案1"><a href="#6-3-响应JSON-方案1" class="headerlink" title="6.3 响应JSON-方案1"></a>6.3 响应JSON-方案1</h4><p>响应JSON时，除了要把响应体改成JSON格式，响应头的<code>Content-Type</code>也要设置为<code>application/json</code>。</p>
<p>编写<code>server2.py</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, Response</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"> </span><br><span class="line">app = Flask(<span class="string">&quot;my-app&quot;</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World!&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/add&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>():</span><br><span class="line">    result = &#123;<span class="string">&#x27;sum&#x27;</span>: request.json[<span class="string">&#x27;a&#x27;</span>] + request.json[<span class="string">&#x27;b&#x27;</span>]&#125;</span><br><span class="line">    <span class="keyword">return</span> Response(json.dumps(result),  mimetype=<span class="string">&#x27;application/json&#x27;</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;127.0.0.1&#x27;</span>, port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>运行。</p>
<p>编写<code>client2.py</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"> </span><br><span class="line">json_data = &#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">2</span>&#125;</span><br><span class="line"> </span><br><span class="line">r = requests.post(<span class="string">&quot;http://127.0.0.1:5000/add&quot;</span>, json=json_data)</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(r.headers)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure>

<p>运行<code>client.py</code>，将显示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;Server&#x27;: &#x27;Werkzeug/2.2.2 Python/3.10.6&#x27;, &#x27;Date&#x27;: &#x27;Thu, 10 Nov 2022 13:37:59 GMT&#x27;, &#x27;Content-Type&#x27;: &#x27;application/json&#x27;, &#x27;Content-Length&#x27;: &#x27;10&#x27;, &#x27;Connection&#x27;: &#x27;close&#x27;&#125;</span><br><span class="line">&#123;&quot;sum&quot;: 3&#125;</span><br></pre></td></tr></table></figure>

<p>上面第一段内容是服务器的响应头，第二段内容是响应体，也就是服务器返回的JSON格式数据</p>
<p>另外，如果需要服务器的HTTP响应头具有更好的可定制性，比如自定义<code>Server</code>，可以如下修改<code>add()</code>函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@app.route(&#x27;/add&#x27;, methods=[&#x27;POST&#x27;])</span><br><span class="line">def add():</span><br><span class="line">    result = &#123;&#x27;sum&#x27;: request.json[&#x27;a&#x27;] + request.json[&#x27;b&#x27;]&#125;</span><br><span class="line">    resp = Response(json.dumps(result),  mimetype=&#x27;application/json&#x27;)</span><br><span class="line">    resp.headers.add(&#x27;Server&#x27;, &#x27;python flask&#x27;)</span><br><span class="line">    return resp</span><br></pre></td></tr></table></figure>

<p><code>client2.py</code>运行后会输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;Server&#x27;: &#x27;Werkzeug/2.2.2 Python/3.10.6, python flask&#x27;, &#x27;Date&#x27;: &#x27;Thu, 10 Nov 2022 13:44:44 GMT&#x27;, &#x27;Content-Type&#x27;: &#x27;application/json&#x27;, &#x27;Content-Length&#x27;: &#x27;10&#x27;, &#x27;Connection&#x27;: &#x27;close&#x27;&#125;</span><br><span class="line">&#123;&quot;sum&quot;: 3&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-4-响应JSON-方案2"><a href="#6-4-响应JSON-方案2" class="headerlink" title="6.4 响应JSON-方案2"></a>6.4 响应JSON-方案2</h4><p>使用 jsonify 工具函数即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify</span><br><span class="line"> </span><br><span class="line">app = Flask(<span class="string">&quot;my-app&quot;</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World!&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/add&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>():</span><br><span class="line">    result = &#123;<span class="string">&#x27;sum&#x27;</span>: request.json[<span class="string">&#x27;a&#x27;</span>] + request.json[<span class="string">&#x27;b&#x27;</span>]&#125;</span><br><span class="line">    <span class="keyword">return</span> jsonify(result)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;127.0.0.1&#x27;</span>, port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>



<h3 id="7-上传文件"><a href="#7-上传文件" class="headerlink" title="7. 上传文件"></a>7. 上传文件</h3><p>上传文件，一般也是用POST方法。</p>
<h4 id="7-1-建立Flask项目"><a href="#7-1-建立Flask项目" class="headerlink" title="7.1 建立Flask项目"></a>7.1 建立Flask项目</h4><p>建立Flask项目HelloWorld</p>
<h4 id="7-2-上传文件"><a href="#7-2-上传文件" class="headerlink" title="7.2 上传文件"></a>7.2 上传文件</h4><p>假设将上传的图片只允许’png’、’jpg’、’jpeg’、’gif’这四种格式，通过url<code>/upload</code>使用POST上传，上传的图片存放在服务器端的<code>static/uploads</code>目录下。</p>
<p>werkzeug库可以判断文件名是否安全，例如防止文件名是..&#x2F;..&#x2F;..&#x2F;a.png</p>
<p><code>server.py</code>代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"> </span><br><span class="line"><span class="keyword">from</span> werkzeug.utils <span class="keyword">import</span> secure_filename</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"> </span><br><span class="line">app = Flask(__name__)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 文件上传目录</span></span><br><span class="line">app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>] = <span class="string">&#x27;static/uploads/&#x27;</span></span><br><span class="line"><span class="comment"># 支持的文件格式</span></span><br><span class="line">app.config[<span class="string">&#x27;ALLOWED_EXTENSIONS&#x27;</span>] = &#123;<span class="string">&#x27;png&#x27;</span>, <span class="string">&#x27;jpg&#x27;</span>, <span class="string">&#x27;jpeg&#x27;</span>, <span class="string">&#x27;gif&#x27;</span>&#125;  <span class="comment"># 集合类型</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># 判断文件名是否是我们支持的格式</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">allowed_file</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;.&#x27;</span> <span class="keyword">in</span> filename <span class="keyword">and</span> \</span><br><span class="line">           filename.rsplit(<span class="string">&#x27;.&#x27;</span>, <span class="number">1</span>)[<span class="number">1</span>] <span class="keyword">in</span> app.config[<span class="string">&#x27;ALLOWED_EXTENSIONS&#x27;</span>]</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/upload&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">upload</span>():</span><br><span class="line">    upload_file = request.files[<span class="string">&#x27;image&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> upload_file <span class="keyword">and</span> allowed_file(upload_file.filename):</span><br><span class="line">        filename = secure_filename(upload_file.filename)</span><br><span class="line">        <span class="comment"># 将文件保存到 static/uploads 目录，文件名同上传时使用的文件名</span></span><br><span class="line">        upload_file.save(os.path.join(app.root_path, app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], filename))</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;info is &#x27;</span>+request.form.get(<span class="string">&#x27;info&#x27;</span>, <span class="string">&#x27;&#x27;</span>)+<span class="string">&#x27;. success&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;failed&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p><code>app.config</code>中的config是字典的子类，可以用来设置自有的配置信息，也可以设置自己的配置信息。函数<code>allowed_file(filename)</code>用来判断<code>filename</code>是否有后缀以及后缀是否在<code>app.config[&#39;ALLOWED_EXTENSIONS&#39;]</code>中。</p>
<p>客户端上传的图片必须以<code>image01</code>标识。<code>upload_file</code>是上传文件对应的对象。<code>app.root_path</code>获取<code>server.py</code>所在目录在文件系统中的绝对路径。<code>upload_file.save(path)</code>用来将<code>upload_file</code>保存在服务器的文件系统中，参数最好是绝对路径，否则会报错（网上很多代码都是使用相对路径，但是笔者在使用相对路径时总是报错，说找不到路径）。函数<code>os.path.join()</code>用来将使用合适的路径分隔符将路径组合起来。</p>
<p>定制客户端<code>client.py</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"> </span><br><span class="line">file_data = &#123;<span class="string">&#x27;image&#x27;</span>: <span class="built_in">open</span>(<span class="string">&#x27;jiutu.jpg&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>)&#125;</span><br><span class="line"> </span><br><span class="line">user_info = &#123;<span class="string">&#x27;info&#x27;</span>: <span class="string">&#x27;Lenna&#x27;</span>&#125;</span><br><span class="line"> </span><br><span class="line">r = requests.post(<span class="string">&quot;http://127.0.0.1:5000/upload&quot;</span>, data=user_info, files=file_data)</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure>

<p>运行<code>client.py</code>，当前目录下的<code>Lenna.jpg</code>将上传到服务器。</p>
<p>然后，我们可以在<code>static/uploads</code>中看到文件<code>Lenna.jpg</code>。</p>
<p>要控制上产文件的大小，可以设置请求实体的大小，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.config[&#x27;MAX_CONTENT_LENGTH&#x27;] = 16 * 1024 * 1024 #16MB</span><br></pre></td></tr></table></figure>

<p>不过，在处理上传文件时候，需要使用<code>try:...except:...</code>。</p>
<p>如果要获取上传文件的内容可以：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file_content = request.files[&#x27;image&#x27;].stream.read()</span><br></pre></td></tr></table></figure>

<p>client.py返回的结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html lang=en&gt;</span><br><span class="line">&lt;title&gt;404 Not Found&lt;/title&gt;</span><br><span class="line">&lt;h1&gt;Not Found&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.&lt;/p&gt;</span><br></pre></td></tr></table></figure>

<h3 id="8-Restful-URL"><a href="#8-Restful-URL" class="headerlink" title="8. Restful URL"></a>8. Restful URL</h3><p>简单来说，Restful URL可以看做是对 URL 参数的替代</p>
<h4 id="8-1-建立Flask项目"><a href="#8-1-建立Flask项目" class="headerlink" title="8.1 建立Flask项目"></a>8.1 建立Flask项目</h4><p>建立Flask项目HelloWorld</p>
<h4 id="8-2-编写代码"><a href="#8-2-编写代码" class="headerlink" title="8.2 编写代码"></a>8.2 编写代码</h4><p>编辑server.py：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"> </span><br><span class="line">app = Flask(__name__)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/user/&lt;username&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">user</span>(<span class="params">username</span>):</span><br><span class="line">    <span class="built_in">print</span>(username)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(username))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello &#x27;</span> + username</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/user/&lt;username&gt;/friends&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">user_friends</span>(<span class="params">username</span>):</span><br><span class="line">    <span class="built_in">print</span>(username)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(username))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello &#x27;</span> + username</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>运行<code>HelloWorld/server.py</code>。使用浏览器访问<code>http://127.0.0.1:5000/user/letian</code>，HelloWorld&#x2F;server.py将输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">letian</span><br><span class="line">&lt;class &#x27;str&#x27;&gt;</span><br></pre></td></tr></table></figure>

<p>而访问<code>http://127.0.0.1:5000/user/letian/</code>，响应为404 Not Found。</p>
<p>浏览器访问<code>http://127.0.0.1:5000/user/letian/friends</code>，可以看到：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello letian. They are your friends.</span><br></pre></td></tr></table></figure>

<p><code>HelloWorld/server.py</code>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">letian</span><br><span class="line">&lt;class &#x27;str&#x27;&gt;</span><br></pre></td></tr></table></figure>

<h4 id="8-3-转换类型"><a href="#8-3-转换类型" class="headerlink" title="8.3 转换类型"></a>8.3 转换类型</h4><p>由上面的示例可以看出，使用 Restful URL 得到的变量默认为str对象。如果我们需要通过分页显示查询结果，那么需要在url中有数字来指定页数。按照上面方法，可以在获取str类型页数变量后，将其转换为int类型。不过，还有更方便的方法，就是用flask内置的转换机制，即在route中指定该如何转换。</p>
<p>新的服务器代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"> </span><br><span class="line">app = Flask(__name__)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/page/&lt;int:num&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">page</span>(<span class="params">num</span>):</span><br><span class="line">    <span class="built_in">print</span>(num)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(num))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>@app.route)(‘&#x2F;page&#x2F;int:num‘) 会将num变量自动转换成int类型。</p>
<p>运行上面的程序，在浏览器中访问<code>http://127.0.0.1:5000/page/1</code>，HelloWorld&#x2F;server.py将输出如下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">&lt;class &#x27;int&#x27;&gt;</span><br></pre></td></tr></table></figure>

<p>如果访问的是<code>http://127.0.0.1:5000/page/asd</code>，我们会得到404响应。</p>
<p>在官方资料中，说是有3个默认的转换器：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span>     accepts integers</span><br><span class="line"><span class="built_in">float</span>     like <span class="built_in">int</span> but <span class="keyword">for</span> floating point values</span><br><span class="line">path     like the default but also accepts slashes</span><br></pre></td></tr></table></figure>

<h4 id="8-4-一个有趣的用法"><a href="#8-4-一个有趣的用法" class="headerlink" title="8.4 一个有趣的用法"></a>8.4 一个有趣的用法</h4><p>如下编写服务器代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"> </span><br><span class="line">app = Flask(__name__)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/page/&lt;int:num1&gt;-&lt;int:num2&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">page</span>(<span class="params">num1, num2</span>):</span><br><span class="line">    <span class="built_in">print</span>(num1)</span><br><span class="line">    <span class="built_in">print</span>(num2)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>在浏览器中访问<code>http://127.0.0.1:5000/page/11-22</code>，<code>HelloWorld/server.py</code>会输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">11</span><br><span class="line">22</span><br></pre></td></tr></table></figure>

<h4 id="8-5-编写转换器"><a href="#8-5-编写转换器" class="headerlink" title="8.5 编写转换器"></a>8.5 编写转换器</h4><p>自定义的转换器是一个继承<code>werkzeug.routing.BaseConverter</code>的类，修改<code>to_python</code>和<code>to_url</code>方法即可。<code>to_python</code>方法用于将url中的变量转换后供被[<code>@app.route](mailto:</code>@app.route)<code>包装的函数使用，</code>to_url<code>方法用于</code>flask.url_for&#96;中的参数转换。</p>
<p>下面是一个示例，将<code>HelloWorld/server.py</code>修改如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, url_for</span><br><span class="line"> </span><br><span class="line"><span class="keyword">from</span> werkzeug.routing <span class="keyword">import</span> BaseConverter</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyIntConverter</span>(<span class="title class_ inherited__">BaseConverter</span>):</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, url_map</span>):</span><br><span class="line">        <span class="built_in">super</span>(MyIntConverter, self).__init__(url_map)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">to_python</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(value)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">to_url</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="keyword">return</span> value * <span class="number">2</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.url_map.converters[<span class="string">&#x27;my_int&#x27;</span>] = MyIntConverter</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/page/&lt;my_int:num&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">page</span>(<span class="params">num</span>):</span><br><span class="line">    <span class="built_in">print</span>(num)</span><br><span class="line">    <span class="built_in">print</span>(url_for(<span class="string">&#x27;page&#x27;</span>, num=<span class="number">123</span>))   <span class="comment"># page 对应的是 page函数 ，num 对应对应`/page/&lt;my_int:num&gt;`中的num，必须是str</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>浏览器访问<code>http://127.0.0.1:5000/page/123</code>后，<code>HelloWorld/server.py</code>的输出信息是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">123</span></span><br><span class="line">/page/<span class="number">123123</span></span><br></pre></td></tr></table></figure>

<h4 id="9-使用url-for生成链接"><a href="#9-使用url-for生成链接" class="headerlink" title="9. 使用url_for生成链接"></a>9. 使用<code>url_for</code>生成链接</h4><p>工具函数<code>url_for</code>可以让你以软编码的形式生成url，提供开发效率。</p>
<h4 id="9-1-建立Flask项目"><a href="#9-1-建立Flask项目" class="headerlink" title="9.1 建立Flask项目"></a>9.1 建立Flask项目</h4><p>建立Flask项目HelloWorld</p>
<h4 id="9-2-编写代码"><a href="#9-2-编写代码" class="headerlink" title="9.2 编写代码"></a>9.2 编写代码</h4><p>编辑<code>HelloWorld/server.py</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, url_for</span><br><span class="line"> </span><br><span class="line">app = Flask(__name__)</span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/user/&lt;name&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">user</span>(<span class="params">name</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/page/&lt;int:num&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">page</span>(<span class="params">num</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/test&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>():</span><br><span class="line">    <span class="built_in">print</span>(url_for(<span class="string">&#x27;hello_world&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(url_for(<span class="string">&#x27;user&#x27;</span>, name=<span class="string">&#x27;letian&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(url_for(<span class="string">&#x27;page&#x27;</span>, num=<span class="number">1</span>, q=<span class="string">&#x27;hadoop mapreduce 10%3&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(url_for(<span class="string">&#x27;static&#x27;</span>, filename=<span class="string">&#x27;uploads/01.jpg&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>运行<code>HelloWorld/server.py</code>。然后在浏览器中访问<code>http://127.0.0.1:5000/test</code>，<code>HelloWorld/server.py</code>将输出以下信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/</span><br><span class="line">/user/letian</span><br><span class="line">/page/1?q=hadoop+mapreduce+10%253</span><br><span class="line">/static/uploads/01.jpg</span><br></pre></td></tr></table></figure>

<h3 id="10-使用redirect重定向网址"><a href="#10-使用redirect重定向网址" class="headerlink" title="10. 使用redirect重定向网址"></a>10. 使用redirect重定向网址</h3><p><code>redirect</code>函数用于重定向，实现机制很简单，就是向客户端（浏览器）发送一个重定向的HTTP报文，浏览器会去访问报文中指定的url。</p>
<h4 id="10-1-建立Flask项目"><a href="#10-1-建立Flask项目" class="headerlink" title="10.1 建立Flask项目"></a>10.1 建立Flask项目</h4><p>建立Flask项目HelloWorld:</p>
<p>使用<code>redirect</code>时，给它一个字符串类型的参数就行了。</p>
<p>编辑<code>HelloWorld/server.py</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, url_for, redirect</span><br><span class="line"> </span><br><span class="line">app = Flask(__name__)</span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/test1&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test1</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;this is test1&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;test2&#x27;</span>))</span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/test2&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test2</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;this is test2&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;this is test2&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>运行<code>HelloWorld/server.py</code>，在浏览器中访问<code>http://127.0.0.1:5000/test1</code>，浏览器的url会变成<code>http://127.0.0.1:5000/test2</code>，并显示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">this is test1</span><br><span class="line">this is test2</span><br></pre></td></tr></table></figure>

<h3 id="11-使用Jinja2模板引擎"><a href="#11-使用Jinja2模板引擎" class="headerlink" title="11. 使用Jinja2模板引擎"></a>11. 使用Jinja2模板引擎</h3><p>模板引擎负责MVC中的V（view，视图）这一部分。Flask默认使用Jinja2模板引擎。</p>
<p>Flask与模板相关的函数有：</p>
<ul>
<li>flask.render_template(template_name_or_list, **context)<br>Renders a template from the template folder with the given context.</li>
<li>flask.render_template_string(source, **context)<br>Renders a template from the given template source string with the given context.</li>
<li>flask.get_template_attribute(template_name, attribute)<br>Loads a macro (or variable) a template exports. This can be used to invoke a macro from within Python code.</li>
</ul>
<p>这其中常用的就是前两个函数。</p>
<p>这个实例中使用了模板继承、if判断、for循环。</p>
<h4 id="11-1-建立Flask项目"><a href="#11-1-建立Flask项目" class="headerlink" title="11.1 建立Flask项目"></a>11.1 建立Flask项目</h4><p>建立Flask项目HelloWorld:</p>
<h4 id="11-2-创建并编辑HelloWorld-x2F-templates-x2F-default-html"><a href="#11-2-创建并编辑HelloWorld-x2F-templates-x2F-default-html" class="headerlink" title="11.2 创建并编辑HelloWorld&#x2F;templates&#x2F;default.html"></a>11.2 创建并编辑HelloWorld&#x2F;templates&#x2F;default.html</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span></span><br><span class="line">        &#123;% if page_title %&#125;</span><br><span class="line">            &#123;&#123; page_title &#125;&#125;</span><br><span class="line">        &#123;% endif %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    &#123;% block body %&#125;&#123;% endblock %&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">```</span><br><span class="line"> </span><br><span class="line">可以看到，在``标签中使用了if判断，如果给模板传递了`page_title`变量，显示之，否则，不显示。</span><br><span class="line"> </span><br><span class="line">``标签中定义了一个名为`body`的block，用来被其他模板文件继承。</span><br></pre></td></tr></table></figure>

<h4 id="11-3-创建并编辑HelloWorld-x2F-templates-x2F-user-info-html"><a href="#11-3-创建并编辑HelloWorld-x2F-templates-x2F-user-info-html" class="headerlink" title="11.3 创建并编辑HelloWorld&#x2F;templates&#x2F;user_info.html"></a>11.3 创建并编辑HelloWorld&#x2F;templates&#x2F;user_info.html</h4><p>内容如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#在上一部分body中补充</span><br><span class="line">&#123;% extends &quot;default.html&quot; %&#125;</span><br><span class="line"> </span><br><span class="line">&#123;% block body %&#125;</span><br><span class="line">    &#123;% for key in user_info %&#125;</span><br><span class="line"> </span><br><span class="line">        &#123;&#123; key &#125;&#125;: &#123;&#123; user_info[key] &#125;&#125; </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<p>变量<code>user_info</code>应该是一个字典，for循环用来循环输出键值对。</p>
<h4 id="11-4-编辑HelloWorld-x2F-server-py"><a href="#11-4-编辑HelloWorld-x2F-server-py" class="headerlink" title="11.4 编辑HelloWorld&#x2F;server.py"></a>11.4 编辑HelloWorld&#x2F;server.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template</span><br><span class="line"> </span><br><span class="line">app = Flask(__name__)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/user&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">user</span>():</span><br><span class="line">    user_info = &#123;</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;letian&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;email&#x27;</span>: <span class="string">&#x27;123@aa.com&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;age&#x27;</span>:<span class="number">0</span>,</span><br><span class="line">        <span class="string">&#x27;github&#x27;</span>: <span class="string">&#x27;https://github.com/letiantian&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;user_info.html&#x27;</span>, page_title=<span class="string">&#x27;letian\&#x27;s info&#x27;</span>, user_info=user_info)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p><code>render_template()</code>函数的第一个参数指定模板文件，后面的参数是要传递的数据。</p>
<h4 id="11-5-运行与测试"><a href="#11-5-运行与测试" class="headerlink" title="11.5 运行与测试"></a>11.5 运行与测试</h4><p>运行HelloWorld&#x2F;server.py：</p>
<p>在浏览器中访问<code>http://127.0.0.1:5000/user</code>，效果图如下：</p>
<p>查看网页源码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span></span><br><span class="line">            letian<span class="symbol">&amp;#39;</span>s info</span><br><span class="line">    <span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        name: letian <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        email: 123@aa.com <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        age: 0 <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        github: https://github.com/letiantian <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="12-自定义404等错误的响应"><a href="#12-自定义404等错误的响应" class="headerlink" title="12. 自定义404等错误的响应"></a>12. 自定义404等错误的响应</h3><p>要处理HTTP错误，可以使用<code>flask.abort</code>函数。</p>
<h4 id="12-1-简单入门"><a href="#12-1-简单入门" class="headerlink" title="12.1 简单入门"></a>12.1 简单入门</h4><p>建立Flask项目</p>
<p>编辑<code>HelloWorld/server.py</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template_string, abort</span><br><span class="line"> </span><br><span class="line">app = Flask(__name__)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/user&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">user</span>():</span><br><span class="line">    abort(<span class="number">401</span>)  <span class="comment"># Unauthorized 未授权</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Unauthorized, 请先登录&#x27;</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>运行<code>HelloWorld/server.py</code>，浏览器访问<code>http://127.0.0.1:5000/user</code>，效果如下：</p>
<p>要注意的是，<code>HelloWorld/server.py</code>中<code>abort(401)</code>后的<code>print</code>并没有执行。</p>
<h4 id="12-2-自定义错误页面"><a href="#12-2-自定义错误页面" class="headerlink" title="12.2 自定义错误页面"></a>12.2 自定义错误页面</h4><p>将服务器代码改为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template_string, abort</span><br><span class="line"> </span><br><span class="line">app = Flask(__name__)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/user&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">user</span>():</span><br><span class="line">    abort(<span class="number">401</span>)  <span class="comment"># Unauthorized</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.errorhandler(<span class="params"><span class="number">401</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">page_unauthorized</span>(<span class="params">error</span>):</span><br><span class="line">    <span class="keyword">return</span> render_template_string(<span class="string">&#x27;&lt;h1&gt; Unauthorized &lt;/h1&gt;&lt;h2&gt;&#123;&#123; error_info &#125;&#125;&lt;/h2&gt;&#x27;</span>, error_info=error), <span class="number">401</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p><code>page_unauthorized</code>函数返回的是一个元组，401 代表HTTP 响应状态码。如果省略401，则响应状态码会变成默认的 200。</p>
<p>运行<code>HelloWorld/server.py</code>，浏览器访问<code>http://127.0.0.1:5000/user</code>，效果如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Unauthorized</span><br><span class="line">401 Unauthorized: The server could not verify that you are authorized to access the URL requested. You either supplied the wrong credentials (e.g. a bad password), or your browser doesn&#x27;t understand how to supply the credentials required.</span><br></pre></td></tr></table></figure>

<h3 id="13-用户会话"><a href="#13-用户会话" class="headerlink" title="13. 用户会话"></a>13. 用户会话</h3><p>session用来记录用户的登录状态，一般基于cookie实现。</p>
<h4 id="13-1-建立Flask项目"><a href="#13-1-建立Flask项目" class="headerlink" title="13.1 建立Flask项目"></a>13.1 建立Flask项目</h4><p>建立Flask项目HelloWorld:</p>
<h4 id="13-2-编辑HelloWorld-server-py"><a href="#13-2-编辑HelloWorld-server-py" class="headerlink" title="13.2 编辑HelloWorld/server.py"></a>13.2 编辑<code>HelloWorld/server.py</code></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template_string, \</span><br><span class="line">    session, request, redirect, url_for</span><br><span class="line"> </span><br><span class="line">app = Flask(__name__)</span><br><span class="line"> </span><br><span class="line">app.secret_key = <span class="string">&#x27;F12Zr47j\3yX R~X@H!jLwf/T&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    page = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    &lt;form action=&quot;&#123;&#123; url_for(&#x27;do_login&#x27;) &#125;&#125;&quot; method=&quot;post&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;name: &lt;input type=&quot;text&quot; name=&quot;user_name&quot; /&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">        &lt;input type=&quot;submit&quot; value=&quot;Submit&quot; /&gt;</span></span><br><span class="line"><span class="string">    &lt;/form&gt;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> render_template_string(page)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/do_login&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">do_login</span>():</span><br><span class="line">    name = request.form.get(<span class="string">&#x27;user_name&#x27;</span>)</span><br><span class="line">    session[<span class="string">&#x27;user_name&#x27;</span>] = name</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;success&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/show&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>():</span><br><span class="line">    <span class="keyword">return</span> session[<span class="string">&#x27;user_name&#x27;</span>]</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/logout&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logout</span>():</span><br><span class="line">    session.pop(<span class="string">&#x27;user_name&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<h4 id="13-3-代码的含义"><a href="#13-3-代码的含义" class="headerlink" title="13.3 代码的含义"></a>13.3 代码的含义</h4><p><code>app.secret_key</code>用于给session加密。</p>
<p>在<code>/login</code>中将向用户展示一个表单，要求输入一个名字，submit后将数据以post的方式传递给<code>/do_login</code>，<code>/do_login</code>将名字存放在session中。</p>
<p>如果用户成功登录，访问<code>/show</code>时会显示用户的名字。此时，打开firebug等调试工具，选择session面板，会看到有一个cookie的名称为<code>session</code>。</p>
<p><code>/logout</code>用于登出，通过将<code>session</code>中的<code>user_name</code>字段pop即可。Flask中的session基于字典类型实现，调用pop方法时会返回pop的键对应的值；如果pop的键并不存在，那么返回值是<code>pop()</code>的第二个参数。</p>
<p>另外，使用<code>redirect()</code>重定向时，一定要在前面加上<code>return</code>。</p>
<h4 id="13-4-效果"><a href="#13-4-效果" class="headerlink" title="13.4 效果"></a>13.4 效果</h4><p>进入<code>http://127.0.0.1:5000/login</code>，输入jiutu，点击submit：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">success</span><br></pre></td></tr></table></figure>

<p>进入<code>http://127.0.0.1:5000/show</code>查看session中存储的name：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jiutu</span><br></pre></td></tr></table></figure>

<h4 id="13-5-设置sessin的有效时间"><a href="#13-5-设置sessin的有效时间" class="headerlink" title="13.5 设置sessin的有效时间"></a>13.5 设置sessin的有效时间</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> timedelta</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> session, app</span><br><span class="line"> </span><br><span class="line">session.permanent = <span class="literal">True</span></span><br><span class="line">app.permanent_session_lifetime = timedelta(minutes=<span class="number">5</span>)</span><br></pre></td></tr></table></figure>

<p>这段代码将session的有效时间设置为5分钟</p>
<h3 id="14-使用Cookie"><a href="#14-使用Cookie" class="headerlink" title="14. 使用Cookie"></a>14. 使用Cookie</h3><p>cookie是存储在客户端的记录访问者状态的数据。常用的用于记录用户登录状态的session大多是基于cookie实现的。</p>
<p>cookie可以借助<code>flask.Response</code>来实现</p>
<h4 id="14-1-建立Flask项目"><a href="#14-1-建立Flask项目" class="headerlink" title="14.1 建立Flask项目"></a>14.1 建立Flask项目</h4><p>建立Flask项目HelloWorld:</p>
<h4 id="14-2-代码"><a href="#14-2-代码" class="headerlink" title="14.2 代码"></a>14.2 代码</h4><p>修改<code>HelloWorld/server.py</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, Response, make_response</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"> </span><br><span class="line">app = Flask(__name__)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hello_world</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello world&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/add&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    res = Response(<span class="string">&#x27;add cookies&#x27;</span>)</span><br><span class="line">    res.set_cookie(key=<span class="string">&#x27;name&#x27;</span>, value=<span class="string">&#x27;letian&#x27;</span>, expires=time.time()+<span class="number">6</span>*<span class="number">60</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/show&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>():</span><br><span class="line">    <span class="keyword">return</span> request.cookies.__str__()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/del&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">del_cookie</span>():</span><br><span class="line">    res = Response(<span class="string">&#x27;delete cookies&#x27;</span>)</span><br><span class="line">    res.set_cookie(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;&#x27;</span>, expires=<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>由上可以看到，可以使用<code>Response.set_cookie</code>添加和删除cookie。<code>expires</code>参数用来设置cookie有效时间，它的值可以是<code>datetime</code>对象或者unix时间戳</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.set_cookie(key=&#x27;name&#x27;, value=&#x27;letian&#x27;, expires=time.time()+6*60)</span><br></pre></td></tr></table></figure>

<p>上面的expire参数的值表示cookie在从现在开始的6分钟内都是有效的。</p>
<p>要删除cookie，将expire参数的值设为0即可：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.set_cookie(&#x27;name&#x27;, &#x27;&#x27;, expires=0)</span><br></pre></td></tr></table></figure>

<p><code>set_cookie()</code>函数的原型如下：</p>
<blockquote>
<p>set_cookie(key, value&#x3D;’’, max_age&#x3D;None, expires&#x3D;None, path&#x3D;’&#x2F;‘, domain&#x3D;None, secure&#x3D;None, httponly&#x3D;False)</p>
</blockquote>
<blockquote>
<p>Sets a cookie. The parameters are the same as in the cookie Morsel object in the Python standard library but it accepts unicode data, too.<br>Parameters:</p>
</blockquote>
<blockquote>
<p>   key – the key (name) of the cookie to be set.<br>   value – the value of the cookie.<br>   max_age – should be a number of seconds, or None (default) if the cookie should last only as long as the client’s browser session.</p>
</blockquote>
<blockquote>
<p>   expires – should be a datetime object or UNIX timestamp.</p>
</blockquote>
<blockquote>
<p>   domain – if you want to set a cross-domain cookie. For example, domain&#x3D;”.example.com” will set a cookie that is readable by the domain <a target="_blank" rel="noopener" href="http://www.example.com/">www.example.com</a>, foo.example.com etc. Otherwise, a cookie will only be readable by the domain that set it.</p>
</blockquote>
<blockquote>
<p>   path – limits the cookie to a given path, per default it will span the whole domain.</p>
</blockquote>
<h4 id="14-3-运行与测试"><a href="#14-3-运行与测试" class="headerlink" title="14.3 运行与测试"></a>14.3 运行与测试</h4><p>运行<code>HelloWorld/server.py</code>：</p>
<p>使用浏览器打开<code>http://127.0.0.1:5000/add</code>，浏览器界面会显示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add cookies</span><br></pre></td></tr></table></figure>

<p>下面查看一下cookie，如果使用firefox浏览器，可以用firebug插件查看。打开firebug，选择<code>Cookies</code>选项，刷新页面，可以看到名为<code>name</code>的cookie，其值为<code>letian</code>。</p>
<p>在“网络”选项中，可以查看响应头中类似下面内容的设置cookie的HTTP指令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: name=letian; Expires=Sun, 29-Jun-2014 05:16:27 GMT; Path=/</span><br></pre></td></tr></table></figure>

<p>在cookie有效期间，使用浏览器访问<code>http://127.0.0.1:5000/show</code>，可以看到：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#x27;name&#x27;: &#x27;letian&#x27;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="15-闪存系统-flashing-system"><a href="#15-闪存系统-flashing-system" class="headerlink" title="15. 闪存系统 flashing system"></a>15. 闪存系统 flashing system</h3><p>Flask的闪存系统（flashing system）用于向用户提供反馈信息，这些反馈信息一般是对用户上一次操作的反馈。反馈信息是存储在服务器端的，当服务器向客户端返回反馈信息后，这些反馈信息会被服务器端删除。</p>
<h4 id="15-1-建立Flask项目"><a href="#15-1-建立Flask项目" class="headerlink" title="15.1 建立Flask项目"></a>15.1 建立Flask项目</h4><p>建立Flask项目HelloWorld:</p>
<h4 id="15-2-编写HelloWorld-x2F-server-py"><a href="#15-2-编写HelloWorld-x2F-server-py" class="headerlink" title="15.2 编写HelloWorld&#x2F;server.py"></a>15.2 编写HelloWorld&#x2F;server.py</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, flash, get_flashed_messages</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"> </span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = <span class="string">&#x27;some_secret&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hi&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/gen&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen</span>():</span><br><span class="line">    info = <span class="string">&#x27;access at &#x27;</span>+ time.time().__str__()</span><br><span class="line">    flash(info)</span><br><span class="line">    <span class="keyword">return</span> info</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/show1&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show1</span>():</span><br><span class="line">    <span class="keyword">return</span> get_flashed_messages().__str__()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/show2&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show2</span>():</span><br><span class="line">    <span class="keyword">return</span> get_flashed_messages().__str__()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<h4 id="15-3-效果"><a href="#15-3-效果" class="headerlink" title="15.3 效果"></a>15.3 效果</h4><p>运行服务器：</p>
<p>打开浏览器，访问<code>http://127.0.0.1:5000/gen</code>，浏览器界面显示（注意，时间戳是动态生成的，每次都会不一样，除非并行访问）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">access at 1404020982.83</span><br></pre></td></tr></table></figure>

<p>查看浏览器的cookie，可以看到<code>session</code>，其对应的内容是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.eJyrVopPy0kszkgtVrKKrlZSKIFQSUpWSknhYVXJRm55UYG2tkq1OlDRyHC_rKgIvypPdzcDTxdXA1-XwHLfLEdTfxfPUn8XX6DKWCAEAJKBGq8.BpE6dg.F1VURZa7VqU9bvbC4XIBO9-3Y4Y</span><br></pre></td></tr></table></figure>

<p>再一次访问<code>http://127.0.0.1:5000/gen</code>，浏览器界面显示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">access at 1404021130.32</span><br></pre></td></tr></table></figure>

<p>cookie中<code>session</code>发生了变化，新的内容是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.eJyrVopPy0kszkgtVrKKrlZSKIFQSUpWSknhYVXJRm55UYG2tkq1OlDRyHC_rKgIvypPdzcDTxdXA1-XwHLfLEdTfxfPUn8XX6DKWLBaMg1yrfCtciz1rfIEGxRbCwAhGjC5.BpE7Cg.Cb_B_k2otqczhknGnpNjQ5u4dqw</span><br></pre></td></tr></table></figure>

<p>然后使用浏览器访问<code>http://127.0.0.1:5000/show1</code>，浏览器界面显示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#x27;access at 1404020982.83&#x27;, &#x27;access at 1404021130.32&#x27;]</span><br></pre></td></tr></table></figure>

<p>这个列表中的内容也就是上面的两次访问<code>http://127.0.0.1:5000/gen</code>得到的内容。此时，cookie中已经没有<code>session</code>了。</p>
<p>如果使用浏览器访问<code>http://127.0.0.1:5000/show1</code>或者<code>http://127.0.0.1:5000/show2</code>，只会得到：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[]</span><br></pre></td></tr></table></figure>

<h4 id="15-4-高级用法"><a href="#15-4-高级用法" class="headerlink" title="15.4 高级用法"></a>15.4 高级用法</h4><p>flash系统也支持对flash的内容进行分类。修改<code>HelloWorld/server.py</code>内容：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, flash, get_flashed_messages</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"> </span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = <span class="string">&#x27;some_secret&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hi&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/gen&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen</span>():</span><br><span class="line">    info = <span class="string">&#x27;access at &#x27;</span>+ time.time().__str__()</span><br><span class="line">    flash(<span class="string">&#x27;show1 &#x27;</span>+info, category=<span class="string">&#x27;show1&#x27;</span>)</span><br><span class="line">    flash(<span class="string">&#x27;show2 &#x27;</span>+info, category=<span class="string">&#x27;show2&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> info</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/show1&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show1</span>():</span><br><span class="line">    <span class="keyword">return</span> get_flashed_messages(category_filter=<span class="string">&#x27;show1&#x27;</span>).__str__()</span><br><span class="line"> </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/show2&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show2</span>():</span><br><span class="line">    <span class="keyword">return</span> get_flashed_messages(category_filter=<span class="string">&#x27;show2&#x27;</span>).__str__()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(port=<span class="number">5000</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>某一时刻，浏览器访问<code>http://127.0.0.1:5000/gen</code>，浏览器界面显示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">access at 1404022326.39</span><br></pre></td></tr></table></figure>

<p>不过，由上面的代码可以知道，此时生成了两个flash信息，但分类(category)不同。</p>
<p>使用浏览器访问<code>http://127.0.0.1:5000/show1</code>，得到如下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#x27;1 access at 1404022326.39&#x27;]</span><br></pre></td></tr></table></figure>

<p>而继续访问<code>http://127.0.0.1:5000/show2</code>，得到的内容为空：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[]</span><br></pre></td></tr></table></figure>

<h4 id="15-5-在模板文件中获取flash的内容"><a href="#15-5-在模板文件中获取flash的内容" class="headerlink" title="15.5 在模板文件中获取flash的内容"></a>15.5 在模板文件中获取flash的内容</h4><p>在Flask中，<code>get_flashed_messages()</code>默认已经集成到<code>Jinja2</code>模板引擎中，易用性很强。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://jiutu2003.github.io">jiutu2003</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://jiutu2003.github.io/Web/Web%E6%A1%86%E6%9E%B6/Flask/Flask/">https://jiutu2003.github.io/Web/Web%E6%A1%86%E6%9E%B6/Flask/Flask/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://jiutu2003.github.io" target="_blank">jiutu2003</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Web%E6%A1%86%E6%9E%B6/">Web框架</a></div><div class="post_share"><div class="social-share" data-image="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/735eceff91f2a291064f8242242c831b.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/SQL/MySQL/MySQL/" title="MySQL"><img class="cover" src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/96c8e6960161ed14043fb9ef07cf8f30.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">MySQL</div></div></a></div><div class="next-post pull-right"><a href="/%E5%AE%9E%E6%88%98/Bugku/Bugku/" title="Bugku"><img class="cover" src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/cc46eeaae3adc0aca17c8d27fcfd2645.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Bugku</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/242ae48778369e7a.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">jiutu2003</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">9</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">8</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">13</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">1.简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%AE%89%E8%A3%85"><span class="toc-number">2.</span> <span class="toc-text">2.安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%BB%8E-Hello-World-%E5%BC%80%E5%A7%8B"><span class="toc-number">3.</span> <span class="toc-text">3. 从 Hello World 开始</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-Hello-World"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 Hello World</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E4%BF%AE%E6%94%B9Flask%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 修改Flask的配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E8%B0%83%E8%AF%95%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 调试模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-%E7%BB%91%E5%AE%9AIP%E5%92%8C%E7%AB%AF%E5%8F%A3"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 绑定IP和端口</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E8%8E%B7%E5%8F%96URL%E5%8F%82%E6%95%B0"><span class="toc-number">4.</span> <span class="toc-text">4.获取URL参数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E5%88%97%E5%87%BA%E6%89%80%E6%9C%89%E7%9A%84url%E5%8F%82%E6%95%B0"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 列出所有的url参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-%E8%8E%B7%E5%8F%96%E6%9F%90%E4%B8%AA%E6%8C%87%E5%AE%9A%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-number">4.2.</span> <span class="toc-text">4.3 获取某个指定的参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E5%A4%9A%E5%80%BC"><span class="toc-number">4.3.</span> <span class="toc-text">4.4 如何处理多值</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E8%8E%B7%E5%8F%96POST%E6%96%B9%E6%B3%95%E4%BC%A0%E9%80%81%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-number">5.</span> <span class="toc-text">5. 获取POST方法传送的数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-%E5%BB%BA%E7%AB%8BFlask%E9%A1%B9%E7%9B%AE"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 建立Flask项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-%E6%9F%A5%E7%9C%8BPOST%E6%95%B0%E6%8D%AE%E5%86%85%E5%AE%B9"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 查看POST数据内容</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-%E8%A7%A3%E6%9E%90POST%E6%95%B0%E6%8D%AE"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 解析POST数据</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%A4%84%E7%90%86%E5%92%8C%E5%93%8D%E5%BA%94JSON%E6%95%B0%E6%8D%AE"><span class="toc-number">6.</span> <span class="toc-text">6. 处理和响应JSON数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-%E5%BB%BA%E7%AB%8BFlask%E9%A1%B9%E7%9B%AE"><span class="toc-number">6.1.</span> <span class="toc-text">6.1 建立Flask项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-%E5%A4%84%E7%90%86JSON%E6%A0%BC%E5%BC%8F%E7%9A%84%E8%AF%B7%E6%B1%82%E6%95%B0%E6%8D%AE"><span class="toc-number">6.2.</span> <span class="toc-text">6.2 处理JSON格式的请求数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-%E5%93%8D%E5%BA%94JSON-%E6%96%B9%E6%A1%881"><span class="toc-number">6.3.</span> <span class="toc-text">6.3 响应JSON-方案1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-%E5%93%8D%E5%BA%94JSON-%E6%96%B9%E6%A1%882"><span class="toc-number">6.4.</span> <span class="toc-text">6.4 响应JSON-方案2</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6"><span class="toc-number">7.</span> <span class="toc-text">7. 上传文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-%E5%BB%BA%E7%AB%8BFlask%E9%A1%B9%E7%9B%AE"><span class="toc-number">7.1.</span> <span class="toc-text">7.1 建立Flask项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6"><span class="toc-number">7.2.</span> <span class="toc-text">7.2 上传文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-Restful-URL"><span class="toc-number">8.</span> <span class="toc-text">8. Restful URL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-%E5%BB%BA%E7%AB%8BFlask%E9%A1%B9%E7%9B%AE"><span class="toc-number">8.1.</span> <span class="toc-text">8.1 建立Flask项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-%E7%BC%96%E5%86%99%E4%BB%A3%E7%A0%81"><span class="toc-number">8.2.</span> <span class="toc-text">8.2 编写代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-%E8%BD%AC%E6%8D%A2%E7%B1%BB%E5%9E%8B"><span class="toc-number">8.3.</span> <span class="toc-text">8.3 转换类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-4-%E4%B8%80%E4%B8%AA%E6%9C%89%E8%B6%A3%E7%9A%84%E7%94%A8%E6%B3%95"><span class="toc-number">8.4.</span> <span class="toc-text">8.4 一个有趣的用法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-5-%E7%BC%96%E5%86%99%E8%BD%AC%E6%8D%A2%E5%99%A8"><span class="toc-number">8.5.</span> <span class="toc-text">8.5 编写转换器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-%E4%BD%BF%E7%94%A8url-for%E7%94%9F%E6%88%90%E9%93%BE%E6%8E%A5"><span class="toc-number">8.6.</span> <span class="toc-text">9. 使用url_for生成链接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-1-%E5%BB%BA%E7%AB%8BFlask%E9%A1%B9%E7%9B%AE"><span class="toc-number">8.7.</span> <span class="toc-text">9.1 建立Flask项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2-%E7%BC%96%E5%86%99%E4%BB%A3%E7%A0%81"><span class="toc-number">8.8.</span> <span class="toc-text">9.2 编写代码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-%E4%BD%BF%E7%94%A8redirect%E9%87%8D%E5%AE%9A%E5%90%91%E7%BD%91%E5%9D%80"><span class="toc-number">9.</span> <span class="toc-text">10. 使用redirect重定向网址</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-1-%E5%BB%BA%E7%AB%8BFlask%E9%A1%B9%E7%9B%AE"><span class="toc-number">9.1.</span> <span class="toc-text">10.1 建立Flask项目</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-%E4%BD%BF%E7%94%A8Jinja2%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="toc-number">10.</span> <span class="toc-text">11. 使用Jinja2模板引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#11-1-%E5%BB%BA%E7%AB%8BFlask%E9%A1%B9%E7%9B%AE"><span class="toc-number">10.1.</span> <span class="toc-text">11.1 建立Flask项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-2-%E5%88%9B%E5%BB%BA%E5%B9%B6%E7%BC%96%E8%BE%91HelloWorld-x2F-templates-x2F-default-html"><span class="toc-number">10.2.</span> <span class="toc-text">11.2 创建并编辑HelloWorld&#x2F;templates&#x2F;default.html</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-3-%E5%88%9B%E5%BB%BA%E5%B9%B6%E7%BC%96%E8%BE%91HelloWorld-x2F-templates-x2F-user-info-html"><span class="toc-number">10.3.</span> <span class="toc-text">11.3 创建并编辑HelloWorld&#x2F;templates&#x2F;user_info.html</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-4-%E7%BC%96%E8%BE%91HelloWorld-x2F-server-py"><span class="toc-number">10.4.</span> <span class="toc-text">11.4 编辑HelloWorld&#x2F;server.py</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-5-%E8%BF%90%E8%A1%8C%E4%B8%8E%E6%B5%8B%E8%AF%95"><span class="toc-number">10.5.</span> <span class="toc-text">11.5 运行与测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-%E8%87%AA%E5%AE%9A%E4%B9%89404%E7%AD%89%E9%94%99%E8%AF%AF%E7%9A%84%E5%93%8D%E5%BA%94"><span class="toc-number">11.</span> <span class="toc-text">12. 自定义404等错误的响应</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#12-1-%E7%AE%80%E5%8D%95%E5%85%A5%E9%97%A8"><span class="toc-number">11.1.</span> <span class="toc-text">12.1 简单入门</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-2-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%94%99%E8%AF%AF%E9%A1%B5%E9%9D%A2"><span class="toc-number">11.2.</span> <span class="toc-text">12.2 自定义错误页面</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-%E7%94%A8%E6%88%B7%E4%BC%9A%E8%AF%9D"><span class="toc-number">12.</span> <span class="toc-text">13. 用户会话</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#13-1-%E5%BB%BA%E7%AB%8BFlask%E9%A1%B9%E7%9B%AE"><span class="toc-number">12.1.</span> <span class="toc-text">13.1 建立Flask项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#13-2-%E7%BC%96%E8%BE%91HelloWorld-server-py"><span class="toc-number">12.2.</span> <span class="toc-text">13.2 编辑HelloWorld&#x2F;server.py</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#13-3-%E4%BB%A3%E7%A0%81%E7%9A%84%E5%90%AB%E4%B9%89"><span class="toc-number">12.3.</span> <span class="toc-text">13.3 代码的含义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#13-4-%E6%95%88%E6%9E%9C"><span class="toc-number">12.4.</span> <span class="toc-text">13.4 效果</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#13-5-%E8%AE%BE%E7%BD%AEsessin%E7%9A%84%E6%9C%89%E6%95%88%E6%97%B6%E9%97%B4"><span class="toc-number">12.5.</span> <span class="toc-text">13.5 设置sessin的有效时间</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-%E4%BD%BF%E7%94%A8Cookie"><span class="toc-number">13.</span> <span class="toc-text">14. 使用Cookie</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#14-1-%E5%BB%BA%E7%AB%8BFlask%E9%A1%B9%E7%9B%AE"><span class="toc-number">13.1.</span> <span class="toc-text">14.1 建立Flask项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#14-2-%E4%BB%A3%E7%A0%81"><span class="toc-number">13.2.</span> <span class="toc-text">14.2 代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#14-3-%E8%BF%90%E8%A1%8C%E4%B8%8E%E6%B5%8B%E8%AF%95"><span class="toc-number">13.3.</span> <span class="toc-text">14.3 运行与测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-%E9%97%AA%E5%AD%98%E7%B3%BB%E7%BB%9F-flashing-system"><span class="toc-number">14.</span> <span class="toc-text">15. 闪存系统 flashing system</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#15-1-%E5%BB%BA%E7%AB%8BFlask%E9%A1%B9%E7%9B%AE"><span class="toc-number">14.1.</span> <span class="toc-text">15.1 建立Flask项目</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#15-2-%E7%BC%96%E5%86%99HelloWorld-x2F-server-py"><span class="toc-number">14.2.</span> <span class="toc-text">15.2 编写HelloWorld&#x2F;server.py</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#15-3-%E6%95%88%E6%9E%9C"><span class="toc-number">14.3.</span> <span class="toc-text">15.3 效果</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#15-4-%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95"><span class="toc-number">14.4.</span> <span class="toc-text">15.4 高级用法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#15-5-%E5%9C%A8%E6%A8%A1%E6%9D%BF%E6%96%87%E4%BB%B6%E4%B8%AD%E8%8E%B7%E5%8F%96flash%E7%9A%84%E5%86%85%E5%AE%B9"><span class="toc-number">14.5.</span> <span class="toc-text">15.5 在模板文件中获取flash的内容</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/Web/%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90/%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90/" title="域名解析"><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/bd1d78eb10e9f0020b63be426cb0920b.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="域名解析"/></a><div class="content"><a class="title" href="/Web/%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90/%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90/" title="域名解析">域名解析</a><time datetime="2023-02-24T06:22:42.336Z" title="发表于 2023-02-24 14:22:42">2023-02-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Web/%E9%80%BB%E8%BE%91%E8%B6%8A%E6%9D%83/%E9%80%BB%E8%BE%91%E8%B6%8A%E6%9D%83/" title="逻辑越权"><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/e2e64442f954e1afe8fc5c0f52da114c.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="逻辑越权"/></a><div class="content"><a class="title" href="/Web/%E9%80%BB%E8%BE%91%E8%B6%8A%E6%9D%83/%E9%80%BB%E8%BE%91%E8%B6%8A%E6%9D%83/" title="逻辑越权">逻辑越权</a><time datetime="2023-02-24T06:19:01.558Z" title="发表于 2023-02-24 14:19:01">2023-02-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Web/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/" title="版本控制"><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/923cae9672a5ef484ac0ed42599510f0.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="版本控制"/></a><div class="content"><a class="title" href="/Web/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/" title="版本控制">版本控制</a><time datetime="2023-02-24T06:19:01.546Z" title="发表于 2023-02-24 14:19:01">2023-02-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Web/php%E6%8E%A2%E9%92%88/php%E6%8E%A2%E9%92%88/" title="php探针"><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/735eceff91f2a291064f8242242c831b.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="php探针"/></a><div class="content"><a class="title" href="/Web/php%E6%8E%A2%E9%92%88/php%E6%8E%A2%E9%92%88/" title="php探针">php探针</a><time datetime="2023-02-24T06:18:23.625Z" title="发表于 2023-02-24 14:18:23">2023-02-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/SQL/MySQL/MySQL/" title="MySQL"><img src="https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/96c8e6960161ed14043fb9ef07cf8f30.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySQL"/></a><div class="content"><a class="title" href="/SQL/MySQL/MySQL/" title="MySQL">MySQL</a><time datetime="2023-02-24T06:11:54.537Z" title="发表于 2023-02-24 14:11:54">2023-02-24</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://skyserver-1316983678.cos.ap-beijing.myqcloud.com/img/1676127097053.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By jiutu2003</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'pmfnQAIlGrKZuL3XuDvicCUP-gzGzoHsz',
      appKey: '88cFnty7M7cl67dTJrrrLyPB',
      avatar: 'monsterid',
      serverURLs: 'https://pmfnqail.lc-cn-n1-shared.com',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>